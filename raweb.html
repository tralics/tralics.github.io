

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tralics and the Raweb &mdash; Tralics 2.16.0pre documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/tweak.css?v=86cf1cd6" />
      <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" />
      <link rel="stylesheet" type="text/css" href="_static/katex-math.css?v=05624691" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=7f416c36"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="_static/katex.min.js?v=5cc8ed51"></script>
      <script src="_static/auto-render.min.js?v=af98beb9"></script>
      <script src="_static/katex_autorenderer.js?v=f1cc15a7"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RAWeb examples" href="raweb_examples.html" />
    <link rel="prev" title="XML source and translation of some math commands" href="laux.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Tralics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Using tralics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="options.html">Command-line options</a></li>
<li class="toctree-l1"><a class="reference internal" href="titlepage.html">Configuration files of Tralics: syntax and usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">All packages known by Tralics, alphabetic order</a></li>
<li class="toctree-l1"><a class="reference internal" href="array.html">Arrays in Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="chars.html">Characters in Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="err.html">Error recovery in Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="latex3.html">Implementation of the LaTeX3 Bundle in Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="loop.html">Example of the \loop command in Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="start.html">Documentation of Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="step.html">Getting started with Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="mml_ex.html">MathML Examples for Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="fp.html">Examples for the fp package.</a></li>
<li class="toctree-l1"><a class="reference internal" href="laux.html">XML source and translation of some math commands</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tralics and the Raweb</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-short-history">1.1 A short history</a></li>
<li class="toctree-l3"><a class="reference internal" href="#birth-of-tralics">1.2 Birth of Tralics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#overview-of-the-system">2. Overview of the system</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements-of-the-raweb">2.1 Requirements of the Raweb</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trivial-examples">2.2 Trivial examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-document">2.3 Main document</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-configuration-file">2.3.1 The Configuration File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interpreting-the-configuration-file">2.3.2 Interpreting the Configuration File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-main-document">2.3.3 The main document</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-header">2.3.4 The header</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-team-name-and-properties">2.3.5 The Team Name and Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-theme">2.3.6 The Theme</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-localisation">2.3.7 The Localisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-topics">2.3.8 The Topics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preprocessor-limitations">2.3.9 Preprocessor Limitations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#modules">2.4 Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-interface">2.5 Module Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-module">2.6 First Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#original-syntax">2.6.1 Original syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-2006-semantics">2.6.2 The 2006 semantics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-2007-changes">2.6.3 The 2007 changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-2008-changes">2.6.4 The 2008 changes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-2013-changes">2.6.5 The 2013 changes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#references">2.7 References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bibliography">2.8 Bibliography</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bibliography-the-raweb-case">2.8.1 Bibliography: the raweb case</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bibliography-the-general-case">2.8.2 Bibliography: the general case</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bibliography-extended-syntax">2.8.3 Bibliography: extended syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bibliography-more-hacks">2.8.4 Bibliography: more hacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bibliography-reducing-entropy">2.8.5 Bibliography: reducing entropy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-programs">3. Running the programs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#options-of-the-program">3.1 Options of the program</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-latex">3.2 Running latex</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tralics">3.3 Running Tralics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tralics-ps">3.4 Running Tralics -ps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-tralics-xml">3.5 Running Tralics -xml</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-auxiliary-perl-script">4. The auxiliary perl script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#postscript-mode">4.1 Postscript mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xml-mode">4.2 XML mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#evaluation-of-parameters">4.3 Evaluation of parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#end-of-rahandler-pl">4.4 End of rahandler.pl</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-raweb-cfg-sty-file">5. The raweb-cfg.sty file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#details">5.1 Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ampersands-in-url">5.2 Ampersands in URL</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mathml">5.3 MathML</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tables-in-mathml">5.4 Tables in MathML</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pictures">5.5 Pictures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tables">5.6 Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-labels-right">5.7 Getting labels right</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-title-page">5.8 The title page</a></li>
<li class="toctree-l3"><a class="reference internal" href="#math-and-images">5.9 Math and images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-fotex-cfg-file">5.10 The fotex.cfg file</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="raweb_examples.html">RAWeb examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="raweb_cfg.html">Parts of the raweb-cfg file</a></li>
<li class="toctree-l1"><a class="reference internal" href="auxdoc.html">Font test</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmds/index.html">All commands, alphabetic order</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="titlepage-conf.html">Configuration of the title page</a></li>
<li class="toctree-l1"><a class="reference internal" href="titlepage-ex1.html">Two examples for the Titlepage mechanism of Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="titlepage-ex2.html">Two examples for the Titlepage mechanism of Tralics</a></li>
<li class="toctree-l1"><a class="reference internal" href="titlepage-ex3.html">Examples of transcripts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Tralics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tralics and the Raweb</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tralics-and-the-raweb">
<h1>Tralics and the Raweb<a class="headerlink" href="#tralics-and-the-raweb" title="Link to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The contents of this page describe the use of <em>Tralics</em> to generate the
activity report of INRIA. As far as I am aware, it is not used for that
anymore, and the specific functionality involved should be considered to be
deprecated; it is likely to disappear in a future version of the program. The
page will remain here for historical reasons.</p>
</div>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<section id="a-short-history">
<h3>1.1 A short history<a class="headerlink" href="#a-short-history" title="Link to this heading"></a></h3>
<p>This file explains the link between <em>Tralics</em> and the Raweb.</p>
<p>A short history of the Raweb may be found on the Inria internal web site
<a class="reference external" href="http://www.inria.fr/interne/disc/apropos/chantiers/raweb-xml/histoire.html">Inria internal
website</a>.
The question concerns Inria’s Annual Activity Report, also known as
“Rapport d’activité”, or “Annexe technique” to the RA or “annexes
scientifiques” to the RA. This is a document, written by the research
teams, at the end of the year N (October, November), and published in
March of year N+1.</p>
<p>Until the 1993 edition (published in 1994), only a paper version
existed. A LaTeX model was used since 1987, designed by Jacques André
then Martin Jourdan. See the following paper, <a class="reference external" href="http://cahiers.gutenberg.eu.org/cg-bin/article/CG_1988___0_17_0.pdf">Une expérience
d’utilisation de LaTeX : le Rapport d’activité de
l’INRIA</a>
by Louarn in the first Cahiers Gutenberg.</p>
<p>In 1993, contacts were made with the Grif S.A. society, for the design
of a SGML DTD and a LaTeX-to-SGML converter. As a result, Philippe
Louarn was able to put on the web the <a class="reference external" href="http://www.inria.fr/rapportsactivite/RA94/RA94.html">RA (year
1994)</a> in its
HTML version. But this was judged too complicated, and for several
years, the HTML was directly produced from the LaTeX source, using
latex2html (example:
<a class="reference external" href="http://raweb.inria.fr/rapportsactivite/RA95/miaou/miaou.html">miaou95</a>).</p>
<p>In 1996, a working group (conducted by Albert Benveniste) gave new
specifications: independent modules, grouped into ten sections, etc. A
technical group was created, whose objective was to find a company that
could sell a software (maybe using XML as intermediate language). None
was found, but the design of modules (in LaTeX syntax) was well-defined
by Laurent Pierron and José Grimm. For the Ra98, a Perl script did some
preprocessing, splitting the LaTeX source into modules (one module per
HTML page) (example:
<a class="reference external" href="http://raweb.inria.fr/rapportsactivite/RA98/miaou/miaou.html">miaou98</a>).</p>
<p>In 1999, the Scientific Annexes to Inria’s Annual Report were renamed
RAWEB, to emphasize the role played by the Web (it is available as a
CD-Rom, but no more printed by Inria).</p>
<p>In 2001, the Perl scripts mentioned above evolved into a LaTeX-to-XML
converter (some ideas were borrowed from latex2html, which is also a
Perl script). The main trouble was conversion from XML to Pdf, and we
used tools from the TeX community (by S. Rahtz and D. Carlisle) and
PdfLaTeX. On the other hand, the images in the HTML files were converted
by LaTeX. Additional software (indexes, etc.) was written/used by
Marie-Pierre Durollet.</p>
<p>This gave a complicated object: a Perl script, that converts a LaTeX
file into XML (using Omega as a subprocess for the math) followed by
another Perl script that extracts the math, calls latex, then dvips,
then pstoimg (a Perl script that calls ppmquant, pncrop, and so forth,
whose job is to produce a png image for the math formula), and finally
an XSLT processor for the effective conversion. (example:
<a class="reference external" href="http://raweb.inria.fr/rapportsactivite/RA2001/miaou/miaou.html">miaou2001</a>).</p>
</section>
<section id="birth-of-tralics">
<h3>1.2 Birth of Tralics<a class="headerlink" href="#birth-of-tralics" title="Link to this heading"></a></h3>
<p>The big Perl script was rewritten as a C++ translator, renamed
<em>Tralics</em>, and got (for version 1.6) a first IDDN number in Dec. 2002.
This software was still able to produce a LaTeX preview of the Raweb:
The source is read, the syntax is tested, a LaTeX file is written for
each module, latex and bibtex are called, the resulting dvi is converted
to PostScript. But the same <em>Tralics</em> can be used in a different way:
the source is read, the syntax is tested, an XML file is created, an
XSLT processor is called to generate the XSL/FO, and PdfLaTeX generates
the Pdf (you can also generate an HTML version). (example:
<a class="reference external" href="http://raweb.inria.fr/rapportsactivite/RA2003/miaou/uid0.html">miaou2003</a>).</p>
<p>Note that in 2003, there were a few people writing their RA directly in
XML. As a consequence, the new <em>Tralics</em>, to be be used in 2004, does
only the bare minimum: it converts the LaTeX into XML. There is a Perl
script that does everything else (calling external programs like latex,
xsltproc, etc). A non-obvious point concerns conversion of math and
images into HTML. Currently, a Perl script extracts the math, uses LaTex
to produce a dvi file, which in converted to PostScript then png format.</p>
<p>Since 2005, the XML version of the Raweb is available on the web; its
DTD is different from what <em>Tralics</em> produces; the research report
<a class="reference external" href="http://hal.inria.fr/inria-00000777">inria-0000077</a> describes both
DTDs and the XSL style sheet that does the conversion.</p>
<p>Since 2008, a raweb file is like another file. The pre-processor (with
all its fatal errors) has been removed, as well as the postprocessor.
All commands, specific to the raweb like <code class="docutils literal notranslate"><span class="pre">\project</span></code> are now defined in
a style file (to be used via a class file), they may use some primitives
that extract data from a configuration file.</p>
</section>
</section>
<section id="overview-of-the-system">
<span id="overview"></span><h2>2. Overview of the system<a class="headerlink" href="#overview-of-the-system" title="Link to this heading"></a></h2>
<section id="requirements-of-the-raweb">
<span id="requi"></span><h3>2.1 Requirements of the Raweb<a class="headerlink" href="#requirements-of-the-raweb" title="Link to this heading"></a></h3>
<p>We give <a class="reference external" href="raweb1.html">here</a> an example of a real file. It is an
abridged version of the <a class="reference external" href="http://www.inria.fr/rapportsactivite/RA2003/miaou/uid0.html">Report of the MIAOU
project.</a>
The input to <em>Tralics</em> is: one TeX file (that can input other TeX
files), one, two or three bibliography files, and some image files.
These three bibliography files can be merged into a single one; and the
filecontents environment might be used to insert the bibliography in the
TeX source.</p>
<p>In the example, we have three bibliography files:
<a class="reference external" href="raweb1.html#miaou2003bib">miaou2003.bib</a>,
<a class="reference external" href="raweb1.html#miaoufootbib">miaou_foot2003.bib</a>, and
<a class="reference external" href="raweb1.html#miaoureferbib">miaou_refer2003.bib</a> and one
<a class="reference external" href="xml-route.png">image</a> (The image is extracted from a power-point
presentation, converted to PostScript, then Pdf; the image shown here is
the png version of the PostScript file obtained via convert; you can see
<a class="reference external" href="xml-route-ra.png">this on the web</a>, and notice a loss of quality.)
The image explains how <em>Tralics</em> is connected to the other processes.</p>
<p>When translating a file, <em>Tralics</em> can be in Raweb mode or not.
Differences between Raweb and non-raweb modes are tiny: they concern
essentially the bibliography (there are some tests that check if an item
is in the correct bibliography file). In Raweb mode, the input file
should be foo2004.tex, where foo matches the name of team, and the
document class should be ra2004 (replace 2004 by the current year).
Non-ascii characters, as well as uppercase letters are forbidden.</p>
</section>
<section id="trivial-examples">
<span id="triv-exp"></span><h3>2.2 Trivial examples<a class="headerlink" href="#trivial-examples" title="Link to this heading"></a></h3>
<p><strong>Example 1.</strong> An important point is that <em>Tralics</em> compiles only TeX
files, i.e. whose names end with .tex. If no extension is given, one is
added. The .xml extension is replaced by .tex.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics my_file.xml
This is tralics 2.13.0, a LaTeX to XML translator, running on medee
Copyright INRIA/MIAOU/APICS 2002-2008, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Fatal error: Cannot open input file my_file.tex
</pre></div>
</div>
</div>
<p><strong>Example 2.</strong> Earlier versions of <em>Tralics</em> refused to translate files
that are not in the current directory.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics /floppy/foo etc
This is tralics 2.8, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2006, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Fatal error
Absolute or relative pathnames not allowed: /floppy/foo
</pre></div>
</div>
</div>
<p><strong>Example 2bis.</strong> Since version 2.10.7 <em>Tralics</em> accepts to translate
files that are not in the current directory. By default, the XML result
and transcript files are put in the same directory as the input, but
this can be changed.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>maclaurin@grimm$  tralics ../Test/hello -outputdir=/tmp -logfile=x -silent
This is tralics 2.15.4, a LaTeX to XML translator, running on maclaurin
Copyright INRIA/MIAOU/APICS/MARELLE 2002-2015, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting translation of file ../Test/hello.tex.
Output written on /tmp/hello.xml (187 bytes).
No error found.
(For more information, see transcript file /tmp/x.log)
</pre></div>
</div>
</div>
<p><strong>Example 3.</strong> In the examples 3 to 6, we use the -silent switch to
reduce verbosity, and we translate a trivial TeX file. Here we
demontrate the -dir switch. This option has currrently no effect
anymore.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>maclaurin@grimm$ tralics hello -dir none -silent
This is tralics 2.15.4, a LaTeX to XML translator, running on maclaurin
Copyright INRIA/MIAOU/APICS/MARELLE 2002-2015, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting translation of file hello.tex.
Output written on hello.xml (187 bytes).
No error found.
(For more information, see transcript file hello.log)
</pre></div>
</div>
</div>
<p><strong>Example 4.</strong> Here we say that we do not want a configuration file.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics -noconfig hello -silent
This is tralics 2.8, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2006, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting xml processing for hello.
No configuration file.
Output written on hello.xml (171 bytes).
No error found.
(For more information, see transcript file hello.log)
</pre></div>
</div>
</div>
<p><strong>Example 5.</strong> In version 2.8, you could set the shell variable
<code class="docutils literal notranslate"><span class="pre">TRALICSDIR</span></code> to a directory containing the configuration file. This
has no effect any more, and the translation is the same as in example 3.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ TRALICSDIR=.. tralics hello -silent
This is tralics 2.13.0, a LaTeX to XML translator, running on medee
...
(For more information, see transcript file hello.log)
</pre></div>
</div>
</div>
<p><strong>Example 6.</strong> Here the configuration file is found via default rules.
Translation is the same as in example 3.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics hello -silent
...
(For more information, see transcript file hello.log)
</pre></div>
</div>
</div>
<p>In all these examples, the TeX file contains a single line
<code class="docutils literal notranslate"><span class="pre">Hello,</span> <span class="pre">world!</span></code>. The translation is</p>
<div class="xml-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&#39;1.0&#39; encoding=&#39;iso-8859-1&#39;?&gt;
&lt;!DOCTYPE unknown SYSTEM &#39;unknown.dtd&#39;&gt;
&lt;!-- translated from latex by tralics 2.8--&gt;
&lt;unknown&gt;
&lt;p&gt;Hello, world!
&lt;/p&gt;&lt;/unknown&gt;
</pre></div>
</div>
</div>
<p>There are some differences between version 2.8 and the current version.
For instance the compilation date has been added in the XML, thus making
it a bit larger (192 bytes instead of 171). The default encoding is now
UTF-8, this makes the file smaller; finally, the length of the version
number impacts the length of the XML result. The sentence “starting xml
processing for hello” has been replaced by “Starting translation of file
hello.tex”. If the -silent option is given, information about
configuration file is not printed on the terminal.</p>
<p><strong>Raweb mode</strong> is entered if the <em>type</em> is <code class="docutils literal notranslate"><span class="pre">ra</span></code>. The <em>type</em> can be
specified in the configuration file (the .tralics_rc file; we assume
that either no configurationn file, or the standard configuration one
will be used). If you call <em>Tralics</em> with option type=foo, then the
<em>type</em> will be <code class="docutils literal notranslate"><span class="pre">foo</span></code>. Otherwise, if you call <em>Tralics</em> with option
config=bar2005, and if bar2005.tcf exists, the <em>type</em> will be <code class="docutils literal notranslate"><span class="pre">bar</span></code>.
Otherwise, if the file has <code class="docutils literal notranslate"><span class="pre">\documentclass{gee2003}</span></code>, and gee2003.tcf
or gee.tcf exists, then the <em>type</em> will be <code class="docutils literal notranslate"><span class="pre">gee</span></code>; otherwise some
default type will be used. The tcf file will be loaded, if given or
deduced.</p>
<p>Let’s assume that we have a file containing two lines, the first one is
<code class="docutils literal notranslate"><span class="pre">\documentclass{ra2003}</span></code>, the second one is <code class="docutils literal notranslate"><span class="pre">Hello,</span>&#160;&#160;&#160;&#160; <span class="pre">world!</span></code> as
above. Assume that the file has three names xhello.tex, hello2003.tex
and hello2006.tex. All these files will be translated in Raweb mode. No
XML file will be produced unless the four digits that appear in the
document class are also in the file name, this is the case only for
hello2003.</p>
<p><strong>Example 7.</strong> We translate here file xhello.tex. Since the file name
has no digits in it, you will get an error of the form <em>Input file name
must be team name followed by 2008</em>. With version 2.8, the -verbose
switch produces a great number of lines, explaining what happens
(current version is less verbose).</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics xhello -verbose
This is tralics 2.8, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2006, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting xml processing for xhello.
Configuration file identification: standard $ Revision: 2.24 $
Read configuration file /user/grimm/home/cvs/tralics/.tralics_rc.
Configuration file has type \documentclass
Seen \documentclass ra2003
Potential type is ra2003
...
Configuration file identification: standard-ra $ Revision: 2.1 $
Read tcf file for type: ../confdir/ra.tcf
Using type ra
...
dtd is raweb from raweb3.dtd (mode RAWEB2006)
Fatal error: Please add 2006 in the name of the input file
Fatal_error for xhello
Say tralics --help to get some help
</pre></div>
</div>
</div>
<p><strong>Example 8.</strong> You can use the option -year=2008; this sets a variable
to be 2008; in Raweb mode, this can produce an error of the form <em>Option
-year=2008 incompatible with year in source file</em>, is ignored otherwise.
Even without this switch, the file will not compile, because of a
mismatch between the year of the file, and that of the document class.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics hello2006
This is tralics 2.13.0, a LaTeX to XML translator, running on medee
Copyright INRIA/MIAOU/APICS 2002-2008, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting translation of file hello2006.tex.
Configuration file identification: standard $ Revision: 2.24 $
Read configuration file ../confdir/.tralics_rc.
Configuration file identification: standard-ra $ Revision: 2.4 $
Read tcf file ../confdir/ra.tcf
Illegal document class ra2003 should be ra2006
</pre></div>
</div>
</div>
<p><strong>Example 9.</strong> Final test: we translate the file hello2003. <em>Tralics</em>
version 2.8 uses a preprocessor that complains in case of unbalanced
environments.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[2]grimm@medee$ tralics hello2003
This is tralics 2.8, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2006, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting xml processing for hello2003.
Configuration file identification: standard $ Revision: 2.24 $
Read configuration file /user/grimm/home/cvs/tralics/.tralics_rc.
Configuration file identification: standard-ra $ Revision: 2.1 $
Read tcf file for type: ../confdir/ra.tcf
Error signaled at line 3:
Missing \end{document}.
Fatal_error for hello2003
</pre></div>
</div>
</div>
<p><strong>Example 10.</strong> In version 2.10.7, the preprocessor is not called if the
year is 2007 or greater (this is indicated by the line <em>Simplified RA</em>).
Thus, we can copy hello2003 into hello2007, replacing 2003 by 2007 is
the document class. Compilation succeeds.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@macarthur$ tralics hello2007 -silent
This is tralics 2.10.7, a LaTeX to XML translator, running on macarthur
Copyright INRIA/MIAOU/APICS 2002-2007, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting translation of file hello2007.tex.
Read tcf file ../confdir/ra2007.tcf
Simplified RA
Translation done
Output written on hello.xml (249 bytes).
No error found.
(For more information, see transcript file hello2007.log)
rahandler.pl v2.15, (C) 2004 2006 INRIA, Jos\&#39;e Grimm, Team Apics
Postprocessor did nothing
</pre></div>
</div>
</div>
<p><strong>Example 11.</strong> In version 2.13, both the preprocessor and
postprocessors are removed. Note the following differences between
examples 10 and 11. The line <em>Simplified RA</em> has been removed, as well
as the two lines dealing with the postprocessor. There is a file
ra2007.tcf but no file ra2003.tcf (because ra.tcf can be used instead).
Finally, the class file ra2007.clt was added to the system after example
10 was run.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics hello2003
This is tralics 2.13.0, a LaTeX to XML translator, running on medee
Copyright INRIA/MIAOU/APICS 2002-2008, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting translation of file hello2003.tex.
Read tcf file ../confdir/ra.tcf
Document class: ra2003 2008/07/12 v1.0 Activity Report, Inria 2003
Output written on hello.xml (249 bytes).
No error found.
(For more information, see transcript file hello2003.log)
</pre></div>
</div>
</div>
<p>In Raweb mode, the magic line <code class="docutils literal notranslate"><span class="pre">\AtBeginDocument{\rawebstartdocument}</span></code>
is executed. The effect of this command is to translate the metadata
(name of the team, etc); it is defined by the class file. Our little
file compiles because there is no <code class="docutils literal notranslate"><span class="pre">\begin{document}</span></code>. Translation is</p>
<div class="xml-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&#39;1.0&#39; encoding=&#39;iso-8859-1&#39;?&gt;
&lt;!DOCTYPE raweb SYSTEM &#39;raweb7.dtd&#39;&gt;
&lt;!-- Translated from latex by tralics 2.10.7, date: 2007/11/03--&gt;
&lt;raweb language=&#39;english&#39; creator=&#39;Tralics version 2.10.7&#39; year=&#39;2007&#39;&gt;
&lt;p&gt;Hello, world!&lt;/p&gt;
&lt;/raweb&gt;
</pre></div>
</div>
</div>
<p><em>Tralics</em> version 2.15.4 however complains with <em>No module in section
composition</em> and four other errors; this is because the configuration
file imposes these sections to be non-empty (they are marked “special”
in the configuration file). On the other hand, there is no problem with
hello2007. Note: the year field in <code class="docutils literal notranslate"><span class="pre">raweb</span></code> element is the same as the
document class, and not the compilation date.</p>
</section>
<section id="main-document">
<span id="main-doc"></span><h3>2.3 Main document<a class="headerlink" href="#main-document" title="Link to this heading"></a></h3>
<p>We make here the following assumption: the document is named
foo2003.tex, the document class is ra2003 (same year), and a
configuration file specifying type RA is seen. In this case, RA mode is
entered. Before 2007, there was a preprocessor, that did some checks,
rearranged the code, etc. In what follows, we explain what happens with
the example of 2003 and what is new in 2007 or 2008.</p>
<p>A first difference in 2007 is that you will not see <em>fatal error,
missing \project</em> anymore (a normal error will be signaled instead when
translating the start of the document). A well-formed configuration file
is required. If you get a message like the following, please contact the
raweb team.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Read</span> <span class="n">tcf</span> <span class="n">file</span> <span class="n">ra2007</span><span class="o">.</span><span class="n">tcf</span>
<span class="n">The</span> <span class="n">configuration</span> <span class="n">file</span> <span class="k">for</span> <span class="n">the</span> <span class="n">RA</span> <span class="ow">is</span> <span class="n">ra2007</span><span class="o">.</span><span class="n">tcf</span> <span class="ow">or</span> <span class="n">ra</span><span class="o">.</span><span class="n">tcf</span>
<span class="n">It</span> <span class="n">must</span> <span class="n">define</span> <span class="n">a</span> <span class="n">value</span> <span class="k">for</span> <span class="n">the</span> <span class="n">parameter</span> <span class="n">ur_vals</span>
<span class="n">See</span> <span class="n">transcript</span> <span class="n">file</span> <span class="n">apics2007</span><span class="o">.</span><span class="n">log</span> <span class="k">for</span> <span class="n">details</span>
<span class="n">No</span> <span class="n">xml</span> <span class="n">file</span> <span class="n">generated</span>
<span class="n">Fatal_error</span> <span class="k">for</span> <span class="n">apics2007</span>
</pre></div>
</div>
</div>
<section id="the-configuration-file">
<span id="conffile"></span><h4>2.3.1 The Configuration File<a class="headerlink" href="#the-configuration-file" title="Link to this heading"></a></h4>
<p>The configuration file for the raweb is named ra.tcf (generic code) or
ra2008.tcf (this one is specific to the year 2008). Its content is
similar to what is described <a class="reference external" href="doc-step.html#fourth-doc">here</a>. The
generic ra.tcf configuration file has a block of commands, the specific
files have none (all commands specific to the raweb are now in the
ra.plt file, included by the <code class="docutils literal notranslate"><span class="pre">\documentclass</span></code> command). The file
starts with</p>
<div class="ltx-source docutils container" id="confspec8">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DocType</span> <span class="o">=</span> <span class="n">raweb</span> <span class="n">raweb7</span><span class="o">.</span><span class="n">dtd</span>
<span class="n">DocAttrib</span> <span class="o">=</span> <span class="n">year</span> \<span class="n">specialyear</span>
<span class="n">DocAttrib</span> <span class="o">=</span> <span class="n">creator</span> \<span class="n">tralics</span>
</pre></div>
</div>
</div>
<p>This has as effect to define the preamble of the XML result file (see
translation of example 10 above). There are lines of the following form:</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bibtex_fields</span> <span class="o">=</span> <span class="s2">&quot;x-editorial-board&quot;</span>
<span class="n">bibtex_fields</span> <span class="o">=</span> <span class="s2">&quot;+x-international-audience&quot;</span>
<span class="n">bibtex_fields</span> <span class="o">=</span> <span class="s2">&quot;+x-proceedings&quot;</span>
<span class="n">bibtex_fields</span> <span class="o">=</span> <span class="s2">&quot;+x-invited-conference&quot;</span>
<span class="n">bibtex_fields</span> <span class="o">=</span> <span class="s2">&quot;+x-scientific-popularization&quot;</span>
<span class="n">bibtex_fields</span> <span class="o">=</span> <span class="s2">&quot;+x-pays&quot;</span>
<span class="n">bibtex_fields</span> <span class="o">=</span> <span class="s2">&quot;+url-hal&quot;</span>
<span class="n">bibtex_extensions</span> <span class="o">=</span> <span class="s2">&quot;patent standard&quot;</span>
<span class="n">bibtex_extensions</span> <span class="o">=</span> <span class="s2">&quot;+hdrthesis&quot;</span>
</pre></div>
</div>
</div>
<p>The left hand side may be bibtex_extensions or bibtex_fields, the right
hand side is a space-separated list of items (you can insert line breaks
as in the case of fullsection_vals below). The list may start with a
plus sign; this means append to the previous value (default is overwrite
it). The meaning of these lines is the following: when <em>Tralics</em>
interprets the bibliography, it recognizes (for every entry type) the
fields x-editorial-board, x-international-audience, etc, including
url-hal; it also recognizes the entry types patent, standard and
hdrthesis. An element in the list may be preceded by a minus sign; in
which case, it will be ignored (ignoring entry types may provoke
undefined references). Assume for instance that the bibliography
contains</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@phdthesis</span><span class="p">{</span><span class="n">TEILR09</span><span class="p">,</span>
<span class="n">title</span> <span class="o">=</span> <span class="p">{</span><span class="n">TEI</span><span class="p">},</span>
<span class="n">author</span> <span class="o">=</span> <span class="p">{</span><span class="n">Laurent</span> <span class="n">Romary</span><span class="p">},</span>
<span class="n">school</span> <span class="o">=</span> <span class="p">{</span><span class="n">Humboldt</span><span class="o">-</span><span class="n">Universitat</span> <span class="n">zu</span> <span class="n">Berlin</span><span class="p">},</span>
<span class="n">url</span> <span class="o">=</span>  <span class="s2">&quot;http://www.hu-berlin.de/&quot;</span><span class="p">,</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2015</span><span class="p">,</span>
<span class="n">x</span><span class="o">-</span><span class="n">editorial</span><span class="o">-</span><span class="n">board</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
<span class="n">x</span><span class="o">-</span><span class="n">international</span><span class="o">-</span><span class="n">audience</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
<span class="n">x</span><span class="o">-</span><span class="n">proceedings</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span>
<span class="n">x</span><span class="o">-</span><span class="n">invited</span><span class="o">-</span><span class="n">conference</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
<span class="n">x</span><span class="o">-</span><span class="n">scientific</span><span class="o">-</span><span class="n">popularization</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
<span class="n">x</span><span class="o">-</span><span class="n">pays</span> <span class="o">=</span> <span class="p">{</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">}</span>  <span class="p">,</span>
<span class="n">x</span><span class="o">-</span><span class="n">other</span> <span class="o">=</span> <span class="s2">&quot;ignored&quot;</span> <span class="p">,</span>
<span class="n">url</span><span class="o">-</span><span class="n">hal</span> <span class="o">=</span><span class="s2">&quot;http://hal.inria.fr/&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="nd">@patent</span><span class="p">{</span><span class="n">Algo09</span><span class="p">,</span>
<span class="n">author</span> <span class="o">=</span> <span class="p">{</span><span class="n">Gaëtan</span> <span class="n">Bisson</span> <span class="ow">and</span> <span class="n">Răzvan</span> <span class="n">Bărbulescu</span><span class="p">},</span>
<span class="n">Title</span> <span class="o">=</span> <span class="p">{</span><span class="n">Algorithmes</span> <span class="n">unicode</span> <span class="n">pour</span> <span class="n">les</span> <span class="n">lettres</span> <span class="n">Ààéçœ</span> <span class="n">et</span> <span class="n">Ñ</span><span class="p">},</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2015</span><span class="p">,</span>
<span class="n">x</span><span class="o">-</span><span class="n">pays</span><span class="o">=</span> <span class="p">{</span><span class="n">CH</span><span class="p">,</span><span class="n">HK</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Assume moreover that the school field has to be omitted. The translation
is now</p>
<div class="xml-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">citation</span> <span class="n">from</span><span class="o">=</span><span class="s1">&#39;year&#39;</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;7&#39;</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;bid15&#39;</span> <span class="n">userid</span><span class="o">=</span><span class="s1">&#39;cite:TEILR09&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;phdthesis&#39;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">bauteurs</span><span class="o">&gt;&lt;</span><span class="n">bpers</span> <span class="n">prenom</span><span class="o">=</span><span class="s1">&#39;L.&#39;</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Romary&#39;</span> <span class="n">prenomcomplet</span><span class="o">=</span><span class="s1">&#39;Laurent&#39;</span><span class="o">/&gt;&lt;/</span><span class="n">bauteurs</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">btitle</span><span class="o">&gt;</span><span class="n">TEI</span><span class="o">&lt;/</span><span class="n">btitle</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">btype</span><span class="o">&gt;</span><span class="n">Ph</span><span class="o">.</span> <span class="n">D</span><span class="o">.</span> <span class="n">Thesis</span><span class="o">&lt;/</span><span class="n">btype</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">xref</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://www.hu-berlin.de/&#39;</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">allowbreak</span><span class="o">/&gt;</span><span class="n">www</span><span class="o">.&lt;</span><span class="n">allowbreak</span><span class="o">/&gt;</span><span class="n">hu</span><span class="o">-</span><span class="n">berlin</span><span class="o">.</span>
  <span class="o">&lt;</span><span class="n">allowbreak</span><span class="o">/&gt;</span><span class="n">de</span><span class="o">/&lt;/</span><span class="n">xref</span><span class="o">&gt;&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">editorial</span><span class="o">-</span><span class="n">board</span><span class="o">&gt;</span><span class="n">yes</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">editorial</span><span class="o">-</span><span class="n">board</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">international</span><span class="o">-</span><span class="n">audience</span><span class="o">&gt;</span><span class="n">yes</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">international</span><span class="o">-</span><span class="n">audience</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">proceedings</span><span class="o">&gt;</span><span class="n">no</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">proceedings</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">invited</span><span class="o">-</span><span class="n">conference</span><span class="o">&gt;</span><span class="n">yes</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">invited</span><span class="o">-</span><span class="n">conference</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">scientific</span><span class="o">-</span><span class="n">popularization</span><span class="o">&gt;</span><span class="n">yes</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">scientific</span><span class="o">-</span><span class="n">popularization</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">pays</span><span class="o">&gt;</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">pays</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">url</span><span class="o">-</span><span class="n">hal</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">hal</span><span class="o">.</span><span class="n">inria</span><span class="o">.</span><span class="n">fr</span><span class="o">/&lt;/</span><span class="n">url</span><span class="o">-</span><span class="n">hal</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">citation</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">citation</span> <span class="n">from</span><span class="o">=</span><span class="s1">&#39;year&#39;</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;15&#39;</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;bid2&#39;</span> <span class="n">userid</span><span class="o">=</span><span class="s1">&#39;cite:Algo09&#39;</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;patent&#39;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">bauteurs</span><span class="o">&gt;&lt;</span><span class="n">bpers</span> <span class="n">prenom</span><span class="o">=</span><span class="s1">&#39;G.&#39;</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bisson&#39;</span> <span class="n">prenomcomplet</span><span class="o">=</span><span class="s1">&#39;Gaëtan&#39;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">bpers</span> <span class="n">prenom</span><span class="o">=</span><span class="s1">&#39;R.&#39;</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bărbulescu&#39;</span> <span class="n">prenomcomplet</span><span class="o">=</span><span class="s1">&#39;Răzvan&#39;</span><span class="o">/&gt;&lt;/</span><span class="n">bauteurs</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">btitle</span><span class="o">&gt;</span><span class="n">Algorithmes</span> <span class="n">unicode</span> <span class="n">pour</span> <span class="n">les</span> <span class="n">lettres</span> <span class="n">Ààéçœ</span> <span class="n">et</span> <span class="n">Ñ</span><span class="o">&lt;/</span><span class="n">btitle</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">x</span><span class="o">-</span><span class="n">pays</span><span class="o">&gt;</span><span class="n">CH</span><span class="p">,</span><span class="n">HK</span><span class="o">&lt;/</span><span class="n">x</span><span class="o">-</span><span class="n">pays</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">citation</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>Finally, the ra2008.tcf file contains also the following lines that
defines five lists.</p>
<div class="ltx-source docutils container" id="confspec">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">section_vals</span> <span class="o">=</span> <span class="s2">&quot;composition*/presentation*/fondements/domaine/logiciels/&quot;</span>
<span class="n">section_vals</span> <span class="o">=</span> <span class="s2">&quot;+resultats/contrats*/international*/diffusion*/&quot;</span>
<span class="n">theme_vals</span> <span class="o">=</span> <span class="s2">&quot;Com Cog Num Sym Bio&quot;</span>
<span class="n">ur_vals</span> <span class="o">=</span> <span class="s2">&quot;Rocquencourt//Sophia/Sophia Antipolis/Rennes//Lorraine//&quot;</span><span class="p">;</span>
<span class="n">ur_vals</span> <span class="o">=</span> <span class="s2">&quot;+RhoneAlpes/Rh\^one-Alpes/Futurs//&quot;</span>
<span class="n">affiliation_vals</span> <span class="o">=</span><span class="s2">&quot;Inria//Cnrs//University//ForeignUniversity//&quot;</span>
<span class="n">affiliation_vals</span> <span class="o">=</span><span class="s2">&quot;+Public//Other//&quot;</span>
<span class="n">profession_vals</span> <span class="o">=</span> <span class="s2">&quot;Scientist//Assistant//Technical//PHD//&quot;</span>
<span class="n">profession_vals</span> <span class="o">=</span> <span class="s2">&quot;+PostDoc//StudentIntern//Other//&quot;</span>
</pre></div>
</div>
</div>
<p>The quantity theme_vals is a list of words, separated by spaces,
converted to lower case. The quantity section_vals is a list of words,
separated by slash characters (with possibly a star at the end; these
are called “special”). For all other variables of the form
something_vals, it is a list of pairs, name and value, separated by
slashes. If the value is empty, the name is used instead. An initial
plus sign means continuation. The final slash can be omitted; an initial
slash is ignored.</p>
<p>Since 2007, the English title associated to a (French) section name has
been moved to the configuration file; it is given by fullsection_vals
(that should be used instead of section_vals; with this syntax, there
are no “special” sections anymore). As the following demonstrates, you
can put a string on more than one line, provided that the last character
on the line is a backslash.</p>
<div class="ltx-source docutils container" id="confspec1">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fullsection_vals</span> <span class="o">=</span> <span class="s2">&quot;/composition/Team/presentation/Overall Objectives/</span><span class="se">\</span>
<span class="s2">   fondements/Scientific Foundations/domaine/Application Domains/</span><span class="se">\</span>
<span class="s2">   logiciels/Software/resultats/New Results/</span><span class="se">\</span>
<span class="s2">   contrats/Contracts and Grants with Industry/</span><span class="se">\</span>
<span class="s2">   international/Other Grants and Activities/diffusion/Dissemination&quot;</span>
<span class="n">xml_rasection</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span>
</pre></div>
</div>
</div>
<p>The translation of a section, for instance composition, is
<code class="docutils literal notranslate"><span class="pre">&lt;composition&gt;</span></code>. If the configuration file defines xml_rasection, this
will be the name of the element; the value extracted from
fullsection_vals becomes an attribute; example
<code class="docutils literal notranslate"><span class="pre">&lt;section</span> <span class="pre">titre='Team'&gt;</span></code>. Note that the start and end of a section is
determined by the modules it contains.</p>
<p>The transcript file contains some lines, showing how <em>Tralics</em>
interprets the configuration file. You might see the following lines.</p>
<div class="log-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">theme_vals</span><span class="o">=</span><span class="n">Com</span> <span class="n">Cog</span> <span class="n">Num</span> <span class="n">Sym</span> <span class="n">Bio</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">composition</span> <span class="o">-&gt;</span> <span class="n">Team</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">presentation</span> <span class="o">-&gt;</span> <span class="n">Overall</span> <span class="n">Objectives</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">fondements</span> <span class="o">-&gt;</span> <span class="n">Scientific</span> <span class="n">Foundations</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">domaine</span> <span class="o">-&gt;</span> <span class="n">Application</span> <span class="n">Domains</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">logiciels</span> <span class="o">-&gt;</span> <span class="n">Software</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">resultats</span> <span class="o">-&gt;</span> <span class="n">New</span> <span class="n">Results</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">contrats</span> <span class="o">-&gt;</span> <span class="n">Contracts</span> <span class="ow">and</span> <span class="n">Grants</span> <span class="k">with</span> <span class="n">Industry</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">international</span> <span class="o">-&gt;</span> <span class="n">Other</span> <span class="n">Grants</span> <span class="ow">and</span> <span class="n">Activities</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">diffusion</span> <span class="o">-&gt;</span> <span class="n">Dissemination</span>
<span class="n">UR</span><span class="p">:</span> <span class="n">Rocquencourt</span> <span class="o">-&gt;</span> <span class="n">Rocquencourt</span>
<span class="n">UR</span><span class="p">:</span> <span class="n">Sophia</span> <span class="o">-&gt;</span> <span class="n">Sophia</span> <span class="n">Antipolis</span>
<span class="n">UR</span><span class="p">:</span> <span class="n">Rennes</span> <span class="o">-&gt;</span> <span class="n">Rennes</span>
<span class="n">UR</span><span class="p">:</span> <span class="n">Lorraine</span> <span class="o">-&gt;</span> <span class="n">Lorraine</span>
<span class="o">+</span><span class="n">UR</span><span class="p">:</span> <span class="n">RhoneAlpes</span> <span class="o">-&gt;</span> <span class="n">Rh</span>\<span class="o">^</span><span class="n">one</span><span class="o">-</span><span class="n">Alpes</span>
<span class="n">UR</span><span class="p">:</span> <span class="n">Futurs</span> <span class="o">-&gt;</span> <span class="n">Futurs</span>
</pre></div>
</div>
</div>
</section>
<section id="interpreting-the-configuration-file">
<h4>2.3.2 Interpreting the Configuration File<a class="headerlink" href="#interpreting-the-configuration-file" title="Link to this heading"></a></h4>
<p><em>Tralics</em> has a command
<code class="docutils literal notranslate"><span class="pre">`\tralics&#64;get&#64;config{X}{Y}</span></code> &lt;doc-t.html#cmd-tralicsfindconfig&gt;`__
that returns a value Z, according to the following rules.</p>
<ul class="simple">
<li><p>It is an error if X is <code class="docutils literal notranslate"><span class="pre">foo</span></code>, and if the configuration file does
not specifies foo_vals, or if Y is not in the list.</p></li>
<li><p>The value associated to Y in the list is returned.</p></li>
<li><p>If X is <code class="docutils literal notranslate"><span class="pre">theme</span></code>, then Y is converted to lower case; this will be Z.</p></li>
<li><p>If you say
<code class="docutils literal notranslate"><span class="pre">`\tralics&#64;interpret&#64;rc{foo,bar}</span></code> &lt;doc-t.html#cmd-tralicsinterpretrc&gt;`__,
this checks that all arguments are in the list ur_vals and marks them
as possible locations. If a single item is given, it will be the
default location.</p></li>
<li><p>If X is <code class="docutils literal notranslate"><span class="pre">ur</span></code>, then Z is Y, if Y is a possible location. An initial
plus sign is discarded: if Y is correct, it becomes the default
location. If Y is empty, the default location will be used. An error
is signaled otherwise.</p></li>
<li><p>If X is <code class="docutils literal notranslate"><span class="pre">fullsection</span></code>, let k be the current section number, and K
the position of Y in the section list (this could be section_vals or
fullsection_vals). If Y is empty, an error is signaled if there is no
current section, otherwise K is k. An error is signaled if Y is not
in the list; an error is signaled if K is less than k ; an error also
is signaled if K=k and Y is <code class="docutils literal notranslate"><span class="pre">composition</span></code> (details are given
later). After that, K becomes the current section number. The value Z
is empty if K=k, the value associated to Y otherwise.</p></li>
<li><p>If X is <code class="docutils literal notranslate"><span class="pre">section</span></code>, then if the section number <em>k</em> (defined as
above) is “special”, then Z is empty. Otherwise Z is Y (or
<code class="docutils literal notranslate"><span class="pre">default</span></code> if Y is empty).</p></li>
</ul>
</section>
<section id="the-main-document">
<h4>2.3.3 The main document<a class="headerlink" href="#the-main-document" title="Link to this heading"></a></h4>
<p>The main Raweb document has the following structure</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">documentclass</span><span class="p">{</span><span class="n">ra2003</span><span class="p">}</span>         <span class="o">%</span><span class="mi">001</span>
<span class="o">&lt;</span><span class="n">Header</span><span class="o">&gt;</span>
\<span class="n">begin</span><span class="p">{</span><span class="n">document</span><span class="p">}</span>               <span class="o">%</span><span class="mi">016</span>
\<span class="n">maketitle</span>                     <span class="o">%</span><span class="mi">019</span>
<span class="o">&lt;</span><span class="n">Modules</span><span class="o">&gt;</span>
\<span class="n">loadbiblio</span>                    <span class="o">%</span><span class="mi">488</span>
\<span class="n">end</span><span class="p">{</span><span class="n">document</span><span class="p">}</span>                 <span class="o">%</span><span class="mi">489</span>
</pre></div>
</div>
</div>
<p>Here, and in the examples that follow, blue numbers are the line numbers
of the corresponding lines in the example file. Things like &lt;Modules&gt;
are explained below. The <code class="docutils literal notranslate"><span class="pre">\documentclass</span></code> should be <code class="docutils literal notranslate"><span class="pre">ra2006</span></code> for the
year 2006.</p>
<p><strong>Note.</strong> The two commands <code class="docutils literal notranslate"><span class="pre">\maketitle</span></code> and <code class="docutils literal notranslate"><span class="pre">\loadbiblio</span></code> are now
obsolete.</p>
</section>
<section id="the-header">
<h4>2.3.4 The header<a class="headerlink" href="#the-header" title="Link to this heading"></a></h4>
<p>The header of the file is everything before <code class="docutils literal notranslate"><span class="pre">\begin{document}</span></code>. It
should not produce any text. There is a free part and a required one,
they can be intermixed. The free part contains definitions and
<code class="docutils literal notranslate"><span class="pre">\usepackage</span></code> commands. We recommend to always use <code class="docutils literal notranslate"><span class="pre">\newcommand</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">\def</span></code> (do not follow the example). You should <em>not</em> load
packages like <code class="docutils literal notranslate"><span class="pre">french</span></code> or <code class="docutils literal notranslate"><span class="pre">babel</span></code>, because the current language of
the Raweb is English. For instance:</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">usepackage</span><span class="p">{</span><span class="n">amsfonts</span><span class="p">}</span>          <span class="o">%</span><span class="mi">002</span>
\<span class="n">usepackage</span><span class="p">{</span><span class="n">amsmath</span><span class="p">}</span>
\<span class="n">def</span>\<span class="n">CC</span><span class="p">{{</span>\<span class="n">mathbb</span> <span class="n">C</span><span class="p">}}</span>           <span class="o">%</span><span class="mi">009</span>
\<span class="n">newcommand</span><span class="p">{</span>\<span class="n">etc</span><span class="p">}{</span><span class="n">etc</span><span class="p">}</span>
\<span class="n">def</span>\<span class="n">corresp</span><span class="p">{</span><span class="n">manager</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>The required part of the header contains lines like the following</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">projet</span><span class="p">{</span><span class="n">MIAOU</span><span class="p">}{</span><span class="n">Miaou</span><span class="p">}{</span><span class="n">Mathématiques</span> <span class="n">et</span>
     <span class="n">Informatique</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;Automatique et de l&#39;</span><span class="n">Optimisation</span> <span class="n">pour</span>
  <span class="n">l</span><span class="s1">&#39;Utilisateur}               %006</span>
\<span class="n">theme</span><span class="p">{</span><span class="mi">4</span><span class="n">a</span><span class="p">}</span>                     <span class="o">%</span><span class="mi">004</span>
\<span class="n">isproject</span><span class="p">{</span><span class="n">YES</span><span class="p">}</span> <span class="o">%</span> \<span class="n">isproject</span><span class="p">{</span><span class="n">OUI</span><span class="p">}</span> <span class="n">works</span> <span class="n">also</span> <span class="o">%</span><span class="mi">005</span>
\<span class="n">UR</span><span class="p">{</span>\<span class="n">URSophia</span><span class="p">}</span>                 <span class="o">%</span><span class="mi">007</span>
</pre></div>
</div>
</div>
<p>See <a class="reference external" href="#fmodule7">Changes in 2007</a> and <a class="reference external" href="#fmodule8">Changes in 2008</a>
for some changes introduced for the RA2007 or RA2008. There are no fatal
errors any more.</p>
</section>
<section id="the-team-name-and-properties">
<h4>2.3.5 The Team Name and Properties<a class="headerlink" href="#the-team-name-and-properties" title="Link to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">\isproject</span></code> command take one argument that should be true if the
team is a Project-Team (according to local terminology). The current
version of the ra.plt package uses the xkeyval mechanism in order to
allow variants (équipes, actions transversales, whatever, see
instructions).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">\project</span></code> command (it can be spelled as <code class="docutils literal notranslate"><span class="pre">\projet</span></code>) takes three
arguments Uname, Sname and Lname. Here Sname is the short name of the
Team, and Lname its long name. The short name could be as complicated as
πr<sup>2</sup>. The long name is a bit more explicit and should be in
English.</p>
<p>The first argument Uname should match the file name, miaou2003.tex. The
code that follows uses <code class="docutils literal notranslate"><span class="pre">`\ra&#64;jobname</span></code> &lt;doc-r.html#cmd-rajobname&gt;`__,
this holds <code class="docutils literal notranslate"><span class="pre">miaou</span></code>. It is like <code class="docutils literal notranslate"><span class="pre">jobname</span></code>, except that the directory
part, and the year has been stripped; in particular, all characters have
category code 12 (except for space), so <code class="docutils literal notranslate"><span class="pre">detokenize</span></code> has to be used.
In earlier versions, Uname had to be all uppercase.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">edef</span>\<span class="n">tmpB</span><span class="p">{</span>\<span class="n">ra</span><span class="nd">@jobname</span><span class="p">}</span>
\<span class="n">def</span>\<span class="n">tmpA</span><span class="c1">##1{\lowercase{\xdef\tmpA{\detokenize{##1}}}}</span>
\<span class="n">expandafter</span>\<span class="n">tmpA</span>\<span class="n">expandafter</span><span class="p">{</span>\<span class="n">ra</span><span class="nd">@proj@a</span><span class="p">}</span>
\<span class="n">ifx</span>\<span class="n">tmpA</span>\<span class="n">tmpB</span> \<span class="k">else</span>\<span class="n">PackageError</span><span class="p">{</span><span class="n">Raweb</span><span class="p">}{</span><span class="n">Invalid</span> <span class="n">Team</span> <span class="n">name</span> \<span class="n">ra</span><span class="nd">@proj@a</span><span class="p">}{}</span>\<span class="n">fi</span>
</pre></div>
</div>
</div>
</section>
<section id="the-theme">
<h4>2.3.6 The Theme<a class="headerlink" href="#the-theme" title="Link to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">\theme</span></code> command takes as argument a Theme (Research Teams are
grouped into domains, split into themes). Between 1996 and 2003,
research themes were identified by a digit, between 1 and 4, followed by
a letter; giving <code class="docutils literal notranslate"><span class="pre">4a</span></code> as argument has as effect to insert in the HTML
a link to the <a class="reference external" href="http://www.inria.fr/recherche/equipes/listes/theme_4.en.html">theme
4</a>
(this link is probably broken now). In 2004, the list of domains/themes
changed, and checking become more complex. You can see errors of the
form <em>Invalid theme 4a, Valid themes are com cog num sym bio</em>, where the
list comes from the configuration file (converted to lower case). Here
COM stands for “Communicating systems”, one of its themes being
“Distributed systems and software architecture”). In 2009, the list
changed again: <em>apics</em> (successor of <em>miaou</em>) is in domain
“Mathématiques appliquées, calcul et simulation” (in English “Applied
Mathematics, Computation and Simulation”), and theme “Modeling,
Optimization, and Control of Dynamic Systems”. This information, as well
as a link to the correct URL, is now inserted into the HTML or Pdf
version of the RA by an xsl stylesheet, according to the value of the
team name. As a consequence, the argument of the <code class="docutils literal notranslate"><span class="pre">\theme</span></code> command is
now ignored.</p>
</section>
<section id="the-localisation">
<h4>2.3.7 The Localisation<a class="headerlink" href="#the-localisation" title="Link to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">\UR</span></code> command takes as argument a list of Research Units. The
default configuration file shown above gives the list of valid names. In
2007 they are <code class="docutils literal notranslate"><span class="pre">Rocquencourt</span></code>, <code class="docutils literal notranslate"><span class="pre">Sophia</span></code>, <code class="docutils literal notranslate"><span class="pre">Rennes</span></code>, <code class="docutils literal notranslate"><span class="pre">Lorraine</span></code>,
<code class="docutils literal notranslate"><span class="pre">RhoneAlpes</span></code> and <code class="docutils literal notranslate"><span class="pre">Futurs</span></code>. Since then <code class="docutils literal notranslate"><span class="pre">Futurs</span></code> has been replaced
by <code class="docutils literal notranslate"><span class="pre">Bordeaux</span></code>, <code class="docutils literal notranslate"><span class="pre">Lille</span></code> and <code class="docutils literal notranslate"><span class="pre">Saclay</span></code>. Before 2007, you had to say
<code class="docutils literal notranslate"><span class="pre">\UR{\URSophia}</span></code> (for a team in a single UR) or
<code class="docutils literal notranslate"><span class="pre">\UR{\URFuturs\URSophia}</span></code> for a team in two URs. This is still
accepted, but the recommended syntax is now <code class="docutils literal notranslate"><span class="pre">\UR{Sophia}</span></code> (for a team
in a single UR) or <code class="docutils literal notranslate"><span class="pre">\UR{Futurs,Sophia}</span></code> where the comma could be
replaced by a space. The list is interpreted by
<code class="docutils literal notranslate"><span class="pre">`\tralics&#64;interpret&#64;rc</span></code> &lt;doc-t.html#cmd-tralicsinterpretrc&gt;`__ that
can signal an error of the form:</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">signaled</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">22</span> <span class="n">of</span> <span class="n">file</span> <span class="n">exemple2006</span><span class="o">.</span><span class="n">tex</span><span class="p">:</span>
<span class="n">Illegal</span> <span class="n">localisation</span> <span class="n">value</span><span class="p">:</span> <span class="n">Saclay</span>
<span class="n">Use</span> <span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">of</span><span class="p">:</span> <span class="n">Rocquencourt</span> <span class="n">Sophia</span> <span class="n">Rennes</span> <span class="n">Lorraine</span> <span class="n">RhoneAlpes</span> <span class="n">Futurs</span><span class="o">.</span>
</pre></div>
</div>
</div>
</section>
<section id="the-topics">
<h4>2.3.8 The Topics<a class="headerlink" href="#the-topics" title="Link to this heading"></a></h4>
<p>The last part of the header is the Topic declaration. Example</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">declaretopic</span><span class="p">{</span><span class="n">abc</span><span class="p">}{</span><span class="n">Topic</span> <span class="n">abc</span><span class="p">}</span>  <span class="o">%</span><span class="mi">013</span>
\<span class="n">declaretopic</span><span class="p">{</span><span class="n">def</span><span class="p">}{</span><span class="n">Topic</span> <span class="n">def</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Topics are defined if the ra.plt package is called with option
<code class="docutils literal notranslate"><span class="pre">topic</span></code>. Otherwise the two lines above are ignored as well as the
optional argument of the module environment. Topics have been declared
obsolete in 2007, so they exist only for compatibility reason, and no
error is signaled anymore. Each topic has a name and a title. The name
can be an optional argument of <code class="docutils literal notranslate"><span class="pre">module</span></code> (see the example, lines
<a class="reference external" href="raweb1.html#079">79</a>, <a class="reference external" href="raweb1.html#207">207</a>
<a class="reference external" href="raweb1.html#212">212</a> and <a class="reference external" href="raweb1.html#322">322</a>.) Topics are
handled via a call to <code class="docutils literal notranslate"><span class="pre">\tralics&#64;get&#64;config{section}{XX}</span></code>. See for
instance the reports of <a class="reference external" href="http://www.inria.fr/rapportsactivite/RA2003/isa2003/isa_tf.html">isa
2003</a>,
<a class="reference external" href="http://www.inria.fr/rapportsactivite/RA2004/isa2004/isa_tf.html">isa
2004</a>
or <a class="reference external" href="http://www.inria.fr/rapportsactivite/RA2005/odyssee/odyssee_tf.html">odyssee
2005</a>.</p>
</section>
<section id="preprocessor-limitations">
<h4>2.3.9 Preprocessor Limitations<a class="headerlink" href="#preprocessor-limitations" title="Link to this heading"></a></h4>
<p>We list here some errors signaled by the preprocessor; this concerns
only the RA2006 and before.</p>
<p>Lines containing <code class="docutils literal notranslate"><span class="pre">\theme</span></code> etc, should not contain anything else after
the arguments. Replacing the % line 5 by a _ will give this message</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">signaled</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">5</span><span class="p">:</span>
<span class="n">Characters</span> <span class="n">ignored</span> <span class="n">at</span> <span class="n">end</span> <span class="n">of</span> <span class="n">line</span>
<span class="n">current</span> <span class="n">line</span> <span class="ow">is</span>  <span class="n">_</span> \<span class="n">isproject</span><span class="p">{</span><span class="n">OUI</span><span class="p">}</span> <span class="n">works</span> <span class="n">also</span>
<span class="n">error</span> <span class="ow">is</span> <span class="n">at</span> <span class="n">position</span> <span class="mi">1</span> <span class="n">at</span> <span class="n">character</span> <span class="n">_</span> <span class="p">(</span><span class="n">ascii</span> <span class="mi">95</span><span class="p">)</span><span class="o">.</span>
<span class="n">Fatal_error</span> <span class="k">for</span> <span class="n">miaou2003</span>
</pre></div>
</div>
</div>
<p>You cannot say <code class="docutils literal notranslate"><span class="pre">\def\foo{YES}\isproject\foo</span></code>, because the program
looks for explicit braces. Example:</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">signaled</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">5</span><span class="p">:</span>
<span class="n">Characters</span> <span class="n">ignored</span> <span class="n">before</span> <span class="nb">open</span> <span class="n">brace</span>
<span class="n">error</span> <span class="n">signaled</span> <span class="k">while</span> <span class="n">scanning</span> <span class="n">isproject</span>
<span class="n">current</span> <span class="n">line</span> <span class="ow">is</span> \<span class="n">foo</span> <span class="o">%</span> \<span class="n">isproject</span><span class="p">{</span><span class="n">OUI</span><span class="p">}</span> <span class="n">works</span> <span class="n">also</span>
<span class="n">error</span> <span class="ow">is</span> <span class="n">at</span> <span class="n">position</span> <span class="mi">0</span> <span class="n">at</span> <span class="n">character</span> \ <span class="p">(</span><span class="n">ascii</span> <span class="mi">92</span><span class="p">)</span><span class="o">.</span>
<span class="n">Fatal_error</span> <span class="k">for</span> <span class="n">miaou2003</span>
</pre></div>
</div>
</div>
<p>Before 2006, <em>Tralics</em> created file, named _hyperref.cfg, containing
all the keywords in alphabetic order. You could see errors of the form</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Error at line 107
Strange keywords

meromorphic approximation, frequency-domain identification,
extremal problems {$(\max,+)$}
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">participants</span></code> environment should contain only <code class="docutils literal notranslate"><span class="pre">\pers{}{}[]</span></code>
commands, separated by commas.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Error signaled at line 253:
Syntax error near `and \pers{xx}{yy}&#39;

\pers{Jean-Paul}{Marmorat} and \pers{xx}{yy}.
Fatal_error for miaou2003
</pre></div>
</div>
</div>
<p>or</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">signaled</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">253</span><span class="p">:</span>
<span class="n">Superfluous</span> <span class="n">comma</span>

\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="o">-</span><span class="n">Paul</span><span class="p">}{</span><span class="n">Marmorat</span><span class="p">},,</span> \<span class="n">pers</span><span class="p">{</span><span class="n">xx</span><span class="p">}{</span><span class="n">yy</span><span class="p">}</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Martine</span><span class="p">}{</span><span class="n">Olivi</span><span class="p">}[</span>\<span class="n">corresp</span><span class="p">]</span>
<span class="o">.</span>
<span class="n">Fatal_error</span> <span class="k">for</span> <span class="n">miaou2003</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">\pers</span></code> command can be used in a <code class="docutils literal notranslate"><span class="pre">participants</span></code> or <code class="docutils literal notranslate"><span class="pre">catperso</span></code>
environment. In one case, you must use commas as separators, in the
other case, you cannot. In the current version, the comma after
<code class="docutils literal notranslate"><span class="pre">\pers</span></code> is optional, so that you won’t see</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">signaled</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">253</span><span class="p">:</span>
<span class="n">There</span> <span class="n">must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">comma</span> <span class="n">between</span> <span class="n">two</span> \<span class="n">pers</span>

\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="o">-</span><span class="n">Paul</span><span class="p">}{</span><span class="n">Marmorat</span><span class="p">}</span>\<span class="n">pers</span><span class="p">{</span><span class="n">xx</span><span class="p">}{</span><span class="n">yy</span><span class="p">}</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Martine</span><span class="p">}{</span><span class="n">Olivi</span><span class="p">}[</span>\<span class="n">corresp</span><span class="p">]</span>
<span class="o">.</span>
<span class="n">Fatal_error</span> <span class="k">for</span> <span class="n">miaou2003</span>
</pre></div>
</div>
</div>
<p>nor</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Error signaled at line 44:
Syntax error near `, \pers{x}{y}&#39;
{Ph. D. Students}
\pers{David}{Avanessoff}[Fellow, INRIA], \pers{x}{y}.
Fatal_error for miaou2003
</pre></div>
</div>
</div>
<p>The distiction between environments participants and participants has
been removed, there is no more</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>For the environment ending near line 191
please use `participant&#39; or `participante&#39; for the name,
as there is only one \pers in the list.
For the environment ending near line 253:
please use `participants&#39; or `participantes&#39; for the name,
as there are 2 \pers in the list.
</pre></div>
</div>
</div>
<p>The following error message was introduced in 2007, after removal of the
preprocessor. You will not see anymore in 2008.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">signaled</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">3095</span> <span class="n">of</span> <span class="n">file</span> <span class="n">apics2007</span><span class="o">.</span><span class="n">tex</span><span class="p">:</span>
<span class="n">Text</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">mode</span> <span class="n">where</span> <span class="n">no</span> <span class="n">text</span> <span class="ow">is</span> <span class="n">allowed</span><span class="o">.</span>
<span class="n">Only</span> \<span class="n">pers</span> <span class="n">commands</span> <span class="n">should</span> <span class="n">appear</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">participants</span> <span class="n">environment</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="modules">
<h3>2.4 Modules<a class="headerlink" href="#modules" title="Link to this heading"></a></h3>
<p>A module is an environment, with some arguments: an optional topic
reference (see above), and three required arguments (section, name,
title). It is followed by an optional interface (formed of contributors,
keywords, glossary, and moreinfo) and text. Since a module is
essentially a <code class="docutils literal notranslate"><span class="pre">\subsection</span></code>, the text should contain only
<code class="docutils literal notranslate"><span class="pre">\subsubsection</span></code> and <code class="docutils literal notranslate"><span class="pre">\paragraph</span></code> commands. Modules cannot be
nested. The first module is special, we shall explain it later. The
second module looks like this</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">begin</span><span class="p">{</span><span class="n">module</span><span class="p">}{</span><span class="n">presentation</span><span class="p">}{</span><span class="n">presentation</span><span class="p">}{}</span> <span class="o">%</span><span class="mi">047</span>
\<span class="n">begin</span><span class="p">{</span><span class="n">moreinfo</span><span class="p">}</span>                             <span class="o">%</span><span class="mi">048</span>
<span class="n">The</span> <span class="n">project</span> <span class="n">was</span> <span class="n">terminated</span> <span class="n">June</span> <span class="n">the</span> <span class="mi">30</span><span class="n">th</span><span class="p">,</span> <span class="mf">2003.</span>
<span class="n">A</span> <span class="n">proposal</span> <span class="k">for</span> <span class="n">a</span> <span class="n">new</span> <span class="n">project</span> <span class="n">named</span> <span class="n">APICS</span> <span class="n">has</span> <span class="n">been</span> <span class="n">submitted</span> <span class="n">to</span> <span class="n">the</span> <span class="n">steering</span>
<span class="n">committee</span> <span class="n">of</span> <span class="n">Inria</span> <span class="n">Sophia</span> <span class="n">Antipolis</span><span class="o">.</span>
\<span class="n">end</span><span class="p">{</span><span class="n">moreinfo</span><span class="p">}</span>
<span class="o">...</span>
\<span class="n">end</span><span class="p">{</span><span class="n">module</span><span class="p">}</span>                                 <span class="o">%</span><span class="mi">076</span>
</pre></div>
</div>
</div>
<p>It should be a small description of the main research objectives of the
Team. You can use the <code class="docutils literal notranslate"><span class="pre">moreinfo</span></code> environment for emphasizes (in this
example, to indicate that this is the last RA for the miaou Team).
Historical note: Miaou has been effectively dissolved on 2003-31-12, was
replaced by Apics on 2004-01-01, which became a Project on 2005-01-01.</p>
<p>The standard configuration file <a class="reference external" href="#confspec">(see above)</a> defines nine
sections. The Raweb DTD associates to each section an English name,
shown in parenthesis here. Since 2007, the names have been moved to the
configuration file <a class="reference external" href="#confspec1">(see above)</a></p>
<ol class="arabic simple">
<li><p>composition (Team) example <a class="reference external" href="raweb1.html#022">line 22</a>
This section gives the list of the members of the Team; see below.</p></li>
<li><p>presentation (Overall Objectives), example <a class="reference external" href="raweb1.html#047">line
47</a>
General presentation of the team, and overall objectives.</p></li>
<li><p>fondements (Scientific Foundations), example <a class="reference external" href="raweb1.html#079">line
79</a>.
This should explain the (scientific) tools and methodology used by
the Team.</p></li>
<li><p>domaine (Application Domains), <a class="reference external" href="raweb1.html#183">example line
183</a>, <a class="reference external" href="raweb1.html#187">line 187</a>, <a class="reference external" href="raweb1.html#201">line
201</a>, <a class="reference external" href="raweb1.html#207">line 207</a>, <a class="reference external" href="raweb1.html#212">line
212</a>, <a class="reference external" href="raweb1.html#217">line 217</a>.
This is a very important section. You should use the following
official keywords: telecommunications, multimedia, biology, health,
process engineering, transportation systems, environment.</p></li>
<li><p>logiciels (Software), <a class="reference external" href="raweb1.html#231">example line 231</a>, <a class="reference external" href="raweb1.html#241">line
241</a>, <a class="reference external" href="raweb1.html#249">line 249</a>, <a class="reference external" href="raweb1.html#262">line
262</a>, <a class="reference external" href="raweb1.html#273">line 273</a>
Each piece of software should be described here. You should use
<code class="docutils literal notranslate"><span class="pre">[correspondant]</span></code> as moreinfo field for one of the team members.</p></li>
<li><p>resultats (New Results), example <a class="reference external" href="raweb1.html#286">line 286</a>,
<a class="reference external" href="raweb1.html#314">line 314</a>, <a class="reference external" href="raweb1.html#318">line 318</a>, <a class="reference external" href="raweb1.html#359">line
359</a>.
This section explains the new results found by the Team.</p></li>
<li><p>contrats (Contracts and Grants with Industry), example <a class="reference external" href="raweb1.html#322">line
322</a>, <a class="reference external" href="raweb1.html#338">line 338</a>, <a class="reference external" href="raweb1.html#346">line
346</a>.
You should explain here the work funded by Industry.</p></li>
<li><p>international (Other Grants and Activities), example <a class="reference external" href="raweb1.html#366">line
366</a>, <a class="reference external" href="raweb1.html#380">line 380</a>, <a class="reference external" href="raweb1.html#401">line
401</a>, <a class="reference external" href="raweb1.html#407">line 407</a>.
In this section, you describe contacts with other Teams (in France,
Europe, and rest of the Word).</p></li>
<li><p>diffusion (Dissemination), example <a class="reference external" href="raweb1.html#433">line 433</a>,
<a class="reference external" href="raweb1.html#468">line 468</a>, <a class="reference external" href="raweb1.html#474">line 474</a>.
Here you describe Teaching activities, etc.</p></li>
</ol>
<p>The first argument of a module, the section, is handled by calling
<code class="docutils literal notranslate"><span class="pre">\tralics&#64;get&#64;config{fullsection}{#1}</span></code> whose behavior is described
<a class="reference external" href="#fullsection">above</a>. If this defines a new section, the previous
section (if any) is popped via
<code class="docutils literal notranslate"><span class="pre">`\tralics&#64;pop&#64;section</span></code> &lt;doc-t.html#cmd-tralicspopsection&gt;`__ and a
new section is created via
<code class="docutils literal notranslate"><span class="pre">`\tralics&#64;push&#64;section{#1}</span></code> &lt;doc-t.html#cmd-tralicspushsection&gt;`__.</p>
<p>The section may be empty, case where no new section is created. If there
is no current section, you will see an error of the form <em>No default
section</em>. Normally, “composition” is the first module (see below) and
the first section. So, if the first module has an empty section and is
followed by the composition, you will see a second error <em>Composition
must be before first module</em> and a third <em>Only one module accepted in
composition</em>. If a module with empty section follows the composition,
you will only see the last of these three message.</p>
<p>If the section is not in the list of valid sections defined by the
configuration file, you will get an error of the form <em>Invalid section
Domaine</em> followed by <em>Valid sections are composition presentation
fondements domaine logiciels resultats contrats international diffusion</em>
(it could be followed by the errors listed above).</p>
<p><strong>Note</strong> You can notice that the module starting at <a class="reference external" href="raweb1.html#359">line
359</a> is in the section “resultats”, but it comes
after the modules of the section “contrats”. This is allowed by the
preprocessor : modules are re-ordered. This feature is removed in 2007.
You will see the error <em>Bad section fondements after diffusion</em> followed
by <em>Order of sections is composition presentation fondements domaine
logiciels resultats contrats partenariat diffusion</em> (it could be
followed by a second error).</p>
<p>The second item in a module, name, is a symbolic name, that uniquely
defines the module; it must be unique, or else an error of the form
<em>Class Raweb Error: Duplicate module: dif-anim</em> is signaled. Since a
label (for instance <code class="docutils literal notranslate"><span class="pre">mod:presentation</span></code>, is created and anchored to the
module, there will be another error <em>Label ‘mod:dif-anim’ multiply
defined (first use line 667 file exemple2006.tex)</em>. Trying to use
special commands (for instance math formulas) can produce errors of the
form <em>unexpected element formula</em>.</p>
<p>Finally a module has a title. In the example, three modules have an
empty title: <a class="reference external" href="raweb1.html#022">line 22</a>, <a class="reference external" href="raweb1.html#047">line
47</a>, and <a class="reference external" href="raweb1.html#183">line 183</a>. This is
somehow weird, so, unless ra.plt is loaded with option <code class="docutils literal notranslate"><span class="pre">emptymodule</span></code>,
an empty title is replaced by <code class="docutils literal notranslate"><span class="pre">(Sans</span> <span class="pre">Titre)</span></code>. Before 2008, a
complicated algorithm was used by the post-processor to deal with the
case of empty modules titles. In the current version, an error is
signaled and a default title is used.</p>
</section>
<section id="module-interface">
<span id="modules-i"></span><h3>2.5 Module Interface<a class="headerlink" href="#module-interface" title="Link to this heading"></a></h3>
<p>A typical module should contain an interface and a body. The interface
is formed of contributors, keywords, glossary, and moreinfo. The
original idea was that body is defined by a <code class="docutils literal notranslate"><span class="pre">body</span></code> environment. This
has been simplified: it can be any text, including subsections with
their own interface. In a section like “Overall objectives”, you do not
cite contributors (because you talk about the whole Team), and in a
section like “Dissemination”, you do not cite them either (in fact,
names appear in the body of the module, for instance <a class="reference external" href="raweb1.html#436">line
436</a> and <a class="reference external" href="raweb1.html#470">line 470</a>). Example</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">begin</span><span class="p">{</span><span class="n">module</span><span class="p">}{}{</span><span class="n">calcul</span> <span class="n">formel</span><span class="p">}{</span><span class="n">Software</span> <span class="n">aspects</span> <span class="n">of</span> <span class="n">computer</span> <span class="n">algebra</span><span class="p">}</span>
  \<span class="n">begin</span><span class="p">{</span><span class="n">participants</span><span class="p">}</span>
    \<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}[</span><span class="n">de</span><span class="p">]{</span><span class="n">La</span> <span class="n">Fontaine</span><span class="p">}[</span><span class="mi">1621</span><span class="o">-</span><span class="mi">1695</span><span class="p">]</span>
    \<span class="n">pers</span><span class="p">{</span><span class="n">Cecil</span> <span class="n">Blount</span><span class="p">}{</span><span class="n">De</span> <span class="n">Mille</span><span class="p">}</span>
  \<span class="n">end</span><span class="p">{</span><span class="n">participants</span><span class="p">}</span>
  \<span class="n">begin</span><span class="p">{</span><span class="n">motscle</span><span class="p">}</span>
    <span class="n">mot1</span><span class="p">,</span> <span class="n">mot2</span><span class="p">,</span> <span class="n">mot3</span>
  \<span class="n">end</span><span class="p">{</span><span class="n">motscle</span><span class="p">}</span>
  \<span class="n">begin</span><span class="p">{</span><span class="n">glossaire</span><span class="p">}</span>
    \<span class="n">glo</span><span class="p">{</span><span class="n">trick</span><span class="p">}{</span><span class="n">the</span> <span class="n">thing</span> <span class="n">which</span> <span class="n">makes</span> <span class="n">go</span> <span class="n">the</span> <span class="n">thingummy</span><span class="p">}</span>
    \<span class="n">glo</span><span class="p">{</span><span class="n">BabelFish</span><span class="p">}{</span><span class="n">the</span> <span class="n">translator</span> <span class="n">of</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">sentence</span><span class="p">}</span>
  \<span class="n">end</span><span class="p">{</span><span class="n">glossaire</span><span class="p">}</span>
  \<span class="n">begin</span><span class="p">{</span><span class="n">moreinfo</span><span class="p">}</span>
    <span class="n">This</span> <span class="n">work</span> <span class="n">was</span> <span class="n">sponsored</span> <span class="n">by</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">sponsors</span>
  \<span class="n">end</span><span class="p">{</span><span class="n">moreinfo</span><span class="p">}</span>
  <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">body</span> <span class="n">of</span> <span class="n">the</span> <span class="n">module</span><span class="o">.</span>
\<span class="n">end</span><span class="p">{</span><span class="n">module</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>The moreinfo is technically a <code class="docutils literal notranslate"><span class="pre">moreinfo</span></code> environment. It is formed of
a short paragraph (of the form: “this work done in collaboration with
X”).</p>
<p>The keywords are indicated by the <code class="docutils literal notranslate"><span class="pre">motscle</span></code> environment; examples are
given at <a class="reference external" href="raweb1.html#104">line 104</a>, <a class="reference external" href="raweb1.html#136">line 136</a>,
<a class="reference external" href="raweb1.html#193">line 193</a>, <a class="reference external" href="raweb1.html#202">line 202</a>, and
<a class="reference external" href="raweb1.html#225">line 225</a>. The environment contains a comma
separated list of keywords. The last example shows how to put commas
into a keyword. Keywords have become obsolete. Later on, the powers that
be have reintroduced a global list of keywords, with a different syntax.</p>
<p>A glossary is a <code class="docutils literal notranslate"><span class="pre">glossaire</span></code> environment in which you can put <code class="docutils literal notranslate"><span class="pre">\glo</span></code>
commands; they take two arguments: a word and its description. There is
a dummy example <a class="reference external" href="raweb1.html#104">line 475</a>. In the current version,
there is no possibility to make a reference to the items of the
glossary.</p>
<p>A contributors list is given by a <code class="docutils literal notranslate"><span class="pre">participants</span></code> environment. Since
2008, this produces a <code class="docutils literal notranslate"><span class="pre">&lt;participants&gt;</span></code> element. For compatibility
reasons with the initial (French) version, you can use <code class="docutils literal notranslate"><span class="pre">participant</span></code>,
<code class="docutils literal notranslate"><span class="pre">participante</span></code> or <code class="docutils literal notranslate"><span class="pre">participantes</span></code>. If the ra package is called with
option <code class="docutils literal notranslate"><span class="pre">participant</span></code>, then the name of the element is the name of the
environment. Inside the environment, empty lines are ignored and
<code class="docutils literal notranslate"><span class="pre">\pers</span></code> is defined to be <code class="docutils literal notranslate"><span class="pre">\persA</span></code>. Examples are <a class="reference external" href="raweb1.html#094">line
094</a>, <a class="reference external" href="raweb1.html#126">line 126</a>, <a class="reference external" href="raweb1.html#189">line
189</a>, <a class="reference external" href="raweb1.html#219">line 219</a>, <a class="reference external" href="raweb1.html#233">line
233</a>, <a class="reference external" href="raweb1.html#243">line 243</a>, <a class="reference external" href="raweb1.html#250">line
250</a>, <a class="reference external" href="raweb1.html#265">line 265</a>, and <a class="reference external" href="raweb1.html#274">line
274</a>.</p>
</section>
<section id="first-module">
<span id="f-module"></span><h3>2.6 First Module<a class="headerlink" href="#first-module" title="Link to this heading"></a></h3>
<section id="original-syntax">
<span id="fmodule3"></span><h4>2.6.1 Original syntax<a class="headerlink" href="#original-syntax" title="Link to this heading"></a></h4>
<p>The first section contains a single module, for instance, the one
starting at <a class="reference external" href="raweb1.html#022">line 22</a>. Its name is useless. It
should contain only <code class="docutils literal notranslate"><span class="pre">catperso</span></code> environments (but this is not checked).
Examples are <a class="reference external" href="raweb1.html#024">line 24</a>, <a class="reference external" href="raweb1.html#028">line
28</a>, <a class="reference external" href="raweb1.html#032">line 32</a>, <a class="reference external" href="raweb1.html#036">line
36</a>, and <a class="reference external" href="raweb1.html#040">line 40</a>. Each such
environment has a title, and contains a list of names, like the
<code class="docutils literal notranslate"><span class="pre">participants</span></code> environment, without commas.</p>
<p>The syntax of the <code class="docutils literal notranslate"><span class="pre">\pers</span></code> command is the following: first name,
particle, last name and moreinfo. An example is the following:
\pers{Jean}[de]{La Fontaine}[1621-1695]. Arguments in braces an
mandatory, arguments in brackets are optional. We recommend the syntax
<code class="docutils literal notranslate"><span class="pre">\pers{Jean}{de</span> <span class="pre">la</span>&#160;&#160; <span class="pre">Fontaine}</span></code>, since <em>Tralics</em> does nothing with the
particle apart prefixing it to the last name. In the first module, the
moreinfo may indicate that some contributor has a grant from Inria, or
whatever, and for non permanent people, their arrival, and departure
date (as in <a class="reference external" href="raweb1.html#043">line 43</a>); this could also indicate a
collaboration of another organism, for instance like in <a class="reference external" href="raweb1.html#097">line
97</a>;</p>
</section>
<section id="the-2006-semantics">
<span id="fmodule6"></span><h4>2.6.2 The 2006 semantics<a class="headerlink" href="#the-2006-semantics" title="Link to this heading"></a></h4>
<p>In 2006, the syntax of <code class="docutils literal notranslate"><span class="pre">\pers</span></code> changed. The <code class="docutils literal notranslate"><span class="pre">\persA</span></code> command is the
one described above, the syntax of <code class="docutils literal notranslate"><span class="pre">\persB</span></code> is first name, particle,
last name (same meaning as above), CR, profession, affiliation,
moreinfo, HDR. The last two arguments are optional; a non-empty value of
HDR means that the person has a “Thèse d’état” or a “Habilitation à
diriger les Recherches”. The CR argument was introduced in 2007, and is
described in section 2.6.3.</p>
<p>The profession and affiliation arguments must be used after the last
name. The value is restricted to what is defined by the <a class="reference external" href="#confspec">configuration
file</a>. Example</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">begin</span><span class="p">{</span><span class="n">catperso</span><span class="p">}{</span><span class="n">Ph</span><span class="o">.</span> <span class="n">D</span><span class="o">.</span> <span class="n">Students</span><span class="p">}</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Dupond</span><span class="p">}{</span><span class="n">Scientist</span><span class="p">}{</span><span class="n">Inria</span><span class="p">}</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Dupont</span><span class="p">}{</span><span class="n">Assistant</span><span class="p">}{</span><span class="n">Cnrs</span><span class="p">}[][</span><span class="n">yes</span><span class="p">]</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Durand</span><span class="p">}{</span><span class="n">Technical</span><span class="p">}{</span><span class="n">University</span><span class="p">}[][]</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Dumat</span><span class="p">}{</span><span class="n">StudentIntern</span><span class="p">}{</span><span class="n">Other</span><span class="p">}[</span><span class="n">bla</span> <span class="n">bla</span> <span class="p">][</span><span class="n">no</span><span class="p">]</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Durant</span><span class="p">}{</span><span class="n">PHD</span><span class="p">}{</span><span class="n">ForeignUniversity</span><span class="p">}[</span><span class="k">with</span> <span class="n">a</span> <span class="n">T</span><span class="p">]</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Dumas</span><span class="p">}{</span><span class="n">PostDoc</span><span class="p">}{</span><span class="n">Public</span><span class="p">}[</span><span class="k">with</span> <span class="n">a</span> <span class="n">S</span><span class="p">][</span><span class="n">scheduled</span> <span class="n">november</span> <span class="mi">2007</span><span class="p">]</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Dumont</span><span class="p">}{</span> <span class="n">Other</span> <span class="p">}{</span><span class="n">Other</span><span class="p">}[</span><span class="n">bla</span> <span class="n">bla</span> <span class="p">][</span><span class="n">no</span><span class="p">]</span>
\<span class="n">end</span><span class="p">{</span><span class="n">catperso</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="the-2007-changes">
<span id="fmodule7"></span><h4>2.6.3 The 2007 changes<a class="headerlink" href="#the-2007-changes" title="Link to this heading"></a></h4>
<p>Topics have become obsolescent. This means that <em>Tralics</em> recognises the
syntax, but ignores all values. A new feature has been added: the start
of the document optionally contains a line of the form
<code class="docutils literal notranslate"><span class="pre">\TeamHasHdr{yes}</span></code>. A true value means: at least one staff member has
a Hdr (see discussion about the <code class="docutils literal notranslate"><span class="pre">\pers</span></code> command). This feature has
been removed in 2008.</p>
<p>The following three lines are equivalent; they say that the team is
located in both Rocquencourt and Sophia. Recall that “UR” stands for
Unité de Recherche (Research Unit), and this is nowadays called Research
Center.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">UR</span><span class="p">{</span>\<span class="n">URRocquencourt</span>\<span class="n">URSophia</span> <span class="p">}</span>
\<span class="n">UR</span><span class="p">{</span><span class="n">Rocquencourt</span><span class="p">,</span><span class="n">Sophia</span> <span class="p">}</span>
\<span class="n">ResearchCentreList</span><span class="p">{</span><span class="n">Rocquencourt</span><span class="p">,</span><span class="n">Sophia</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Since 2007 you must indicate, for every staff member, its localisation
(Rocquencourt or Sophia, in the example above). This is done by adding
an optional argument to the <code class="docutils literal notranslate"><span class="pre">\pers</span></code> command. Of course, the optional
argument is required only if the RC list has more than one element.
Example</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">begin</span><span class="p">{</span><span class="n">catperso</span><span class="p">}{</span><span class="n">Team</span> <span class="n">Leader</span><span class="p">}</span>
\<span class="n">pers</span><span class="p">{</span><span class="n">Laurent</span><span class="p">}{</span><span class="n">Baratchart</span><span class="p">}[</span><span class="n">Sophia</span><span class="p">]{</span><span class="n">Chercheur</span><span class="p">}{</span><span class="n">INRIA</span><span class="p">}[</span><span class="n">DR</span> <span class="n">Inria</span><span class="p">][</span><span class="n">Habilite</span><span class="p">]</span>
\<span class="n">end</span><span class="p">{</span><span class="n">catperso</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>In the example that follows, the equals sign says that Sophia becomes
the default value (so that there is no need to repeat it).</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">begin</span><span class="p">{</span><span class="n">catperso</span><span class="p">}{</span><span class="n">Reserch</span> <span class="n">scientists</span> <span class="p">(</span><span class="n">external</span><span class="p">)}</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Louchet</span><span class="p">}[</span><span class="o">=</span><span class="n">Sophia</span><span class="p">]{</span><span class="n">Chercheur</span><span class="p">}{</span><span class="n">INRIA</span><span class="p">}[</span><span class="n">CR</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="o">-</span><span class="n">Marie</span><span class="p">}{</span><span class="n">Rocchisani</span><span class="p">}{</span><span class="n">Chercheur</span><span class="p">}{</span><span class="n">UnivFr</span><span class="p">}[</span><span class="n">Université</span> <span class="n">Paris</span> <span class="n">XIII</span><span class="p">]</span>
\<span class="n">end</span><span class="p">{</span><span class="n">catperso</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="the-2008-changes">
<span id="fmodule8"></span><h4>2.6.4 The 2008 changes<a class="headerlink" href="#the-2008-changes" title="Link to this heading"></a></h4>
<p>Before 2008, the first section consisted in a module consisting of a
sequence of <code class="docutils literal notranslate"><span class="pre">catperso</span></code> environments. Such an environment takes one
argument, a category of people. As the examples show, the values are
very diverse (compare <code class="docutils literal notranslate"><span class="pre">Head</span> <span class="pre">of</span> <span class="pre">project</span> <span class="pre">team</span></code> with <code class="docutils literal notranslate"><span class="pre">Team</span> <span class="pre">leader</span></code>), so
there was an attempt to limit the values to those defined in the
configuration file, before the replacement by a unique environment
<code class="docutils literal notranslate"><span class="pre">composition</span></code>, outside any module.</p>
<p>Remember that the <code class="docutils literal notranslate"><span class="pre">\pers</span></code> command comes in two versions <code class="docutils literal notranslate"><span class="pre">\persA</span></code>
(simple) and <code class="docutils literal notranslate"><span class="pre">\persB</span></code> (complicated). These are commands are defined in
the ra.plt package file, included from the class file (for instance
ra2009.clt) with some options. You should use the <code class="docutils literal notranslate"><span class="pre">\pers</span></code> command only
in two cases: inside a <code class="docutils literal notranslate"><span class="pre">participant</span></code> environment (and then it is
<code class="docutils literal notranslate"><span class="pre">\persA</span></code>), or in the first module. If this one is defined by
<code class="docutils literal notranslate"><span class="pre">composition</span></code> (2008 and later), then <code class="docutils literal notranslate"><span class="pre">\pers</span></code> is made undefined
outside <code class="docutils literal notranslate"><span class="pre">participant</span></code> and <code class="docutils literal notranslate"><span class="pre">composition</span></code>. It is <code class="docutils literal notranslate"><span class="pre">\persA</span></code> if the
package is loaded with option <code class="docutils literal notranslate"><span class="pre">old</span></code> (2005 and before) and <code class="docutils literal notranslate"><span class="pre">\persB</span></code>
otherwise (2006 and later). Example for 2008:</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">begin</span><span class="p">{</span><span class="n">composition</span><span class="p">}</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Christine</span><span class="p">}{</span><span class="n">Eisenbeis</span><span class="p">}{</span><span class="n">Chercheur</span><span class="p">}{</span><span class="n">INRIA</span><span class="p">}[</span><span class="n">Team</span> <span class="n">Leader</span> <span class="p">(</span><span class="n">CR</span><span class="p">)</span> <span class="n">Inria</span><span class="p">][</span><span class="n">Habilite</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Nathalie</span><span class="p">}{</span><span class="n">Gaudechoux</span><span class="p">}{</span><span class="n">Assistant</span><span class="p">}{</span><span class="n">INRIA</span><span class="p">}[</span><span class="n">Secretary</span> <span class="p">(</span><span class="n">SAR</span><span class="p">)</span> <span class="n">Inria</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">François</span><span class="p">}{</span><span class="n">Thomasset</span><span class="p">}{</span><span class="n">Chercheur</span><span class="p">}{</span><span class="n">INRIA</span><span class="p">}[</span><span class="n">Research</span> <span class="n">Director</span> <span class="p">(</span><span class="n">DR</span><span class="p">)</span> <span class="n">Inria</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="p">}{</span><span class="n">Louchet</span><span class="p">}{</span><span class="n">Chercheur</span><span class="p">}{</span><span class="n">AutreEtablissementPublic</span><span class="p">}[</span><span class="n">Ing</span><span class="o">.</span> <span class="n">en</span> <span class="n">chef</span> <span class="n">Armement</span> <span class="p">(</span><span class="n">CR</span><span class="p">)]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Jean</span><span class="o">-</span><span class="n">Marie</span><span class="p">}{</span><span class="n">Rocchisani</span><span class="p">}{</span><span class="n">Chercheur</span><span class="p">}{</span><span class="n">UnivFr</span><span class="p">}[</span><span class="n">Université</span> <span class="n">Paris</span> <span class="n">XIII</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Moussa</span><span class="p">}{</span><span class="n">Lo</span><span class="p">}{</span><span class="n">Visiteur</span><span class="p">}{</span><span class="n">UnivEtrangere</span><span class="p">}[</span><span class="n">AUF</span> <span class="n">Grant</span><span class="o">/</span> <span class="n">Gaston</span> <span class="n">Berger</span> <span class="n">University</span><span class="p">,</span>
    <span class="n">Saint</span><span class="o">-</span><span class="n">Louis</span><span class="p">,</span> <span class="n">Senegal</span><span class="p">,</span> <span class="kn">from</span><span class="w"> </span><span class="nn">March</span> <span class="mi">1</span><span class="n">st</span> <span class="n">till</span> <span class="n">August</span> <span class="mi">31</span> <span class="mi">2008</span><span class="p">]</span>
\<span class="n">end</span><span class="p">{</span><span class="n">composition</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="the-2013-changes">
<h4>2.6.5 The 2013 changes<a class="headerlink" href="#the-2013-changes" title="Link to this heading"></a></h4>
<p>The affiliation part of the <code class="docutils literal notranslate"><span class="pre">\pers</span></code> command has been removed (and the
command is defined as <code class="docutils literal notranslate"><span class="pre">\persC</span></code>). Example (with a CR part).</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">begin</span><span class="p">{</span><span class="n">composition</span><span class="p">}</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Tim</span><span class="p">}{</span><span class="n">Berners</span><span class="o">-</span><span class="n">Lee</span><span class="p">}[</span><span class="o">=</span><span class="n">Grenoble</span><span class="p">]{</span><span class="n">Chercheur</span><span class="p">}[</span><span class="n">Team</span> <span class="n">leader</span><span class="p">,</span> <span class="n">Senior</span> <span class="n">Researcher</span> <span class="n">Inria</span><span class="p">][</span><span class="n">Habilite</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Ada</span><span class="p">}{</span><span class="n">Lovelace</span><span class="p">}{</span><span class="n">Assistant</span><span class="p">}[</span><span class="n">shared</span> <span class="k">with</span> <span class="n">another</span> <span class="n">team</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Richard</span><span class="p">}{</span><span class="n">Stallman</span><span class="p">}[</span><span class="n">Saclay</span><span class="p">]{</span><span class="n">Chercheur</span><span class="p">}[</span><span class="n">Senior</span> <span class="n">Researcher</span> <span class="n">Inria</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Linus</span><span class="p">}{</span><span class="n">Torvalds</span><span class="p">}{</span><span class="n">Chercheur</span><span class="p">}[</span><span class="n">Ing</span><span class="o">.</span> <span class="n">en</span> <span class="n">chef</span> <span class="n">Armement</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Marc</span><span class="p">}{</span><span class="n">Andreessen</span><span class="p">}{</span><span class="n">Enseignant</span><span class="p">}[</span><span class="n">Professor</span><span class="p">,</span> <span class="n">Université</span> <span class="n">Paris</span> <span class="mi">13</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">Donald</span> <span class="n">E</span><span class="o">.</span><span class="p">}{</span><span class="n">Knuth</span><span class="p">}{</span><span class="n">Visiteur</span><span class="p">}[</span><span class="n">AUF</span> <span class="n">Grant</span><span class="o">/</span> <span class="n">Gaston</span> <span class="n">Berger</span> <span class="n">University</span><span class="p">,</span> <span class="n">Saint</span><span class="o">-</span><span class="n">Louis</span><span class="p">,</span> <span class="n">Senegal</span><span class="p">,</span> <span class="kn">from</span><span class="w"> </span><span class="nn">March</span> <span class="mi">1</span><span class="n">st</span> <span class="n">till</span> <span class="n">August</span> <span class="mi">31</span><span class="p">]</span>
  \<span class="n">pers</span><span class="p">{</span><span class="n">François</span><span class="p">}{</span><span class="n">Gernelle</span><span class="p">}{</span><span class="n">Technique</span><span class="p">}[</span><span class="n">IGHCA</span><span class="p">,</span> <span class="n">Unicode</span> <span class="n">team</span><span class="p">]</span>
\<span class="n">end</span><span class="p">{</span><span class="n">composition</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="references">
<h3>2.7 References<a class="headerlink" href="#references" title="Link to this heading"></a></h3>
<p>Our example contains <a class="reference external" href="raweb1.html#092">line 92</a> a <code class="docutils literal notranslate"><span class="pre">\label</span></code> that is
referenced at <a class="reference external" href="raweb1.html#329">line 329</a>. This label is associated
to a section (starting at line <a class="reference external" href="raweb1.html#090">line 90</a>). You can
also associate a label with an equation (<a class="reference external" href="raweb1.html#141">line 141</a>)
or a figure (<a class="reference external" href="raweb1.html#304">line 304</a>) (note that the label has
nothing to do with the <code class="docutils literal notranslate"><span class="pre">\caption</span></code> that follows; references to the
figure will be correct after translation, but incorrect if LaTeX is
called directly).</p>
<p>You can reference a module via the <code class="docutils literal notranslate"><span class="pre">\moduleref[y]{p}{s}{name}</span></code>. Since
2006, the optional argument has been removed, and the command is
equivalent to <code class="docutils literal notranslate"><span class="pre">\ref{mod:name}</span></code> (if the last argument is non-empty, to
<code class="docutils literal notranslate"><span class="pre">\ref{section:s}</span></code> otherwise). The original idea was to refer to the
module “name” in section “s” of the activity report of team “p” for year
“y” (this worked in principle for the HTML version of the RA as the name
of the HTML page depended only on this quantities; it never worked in
the PDF version). So the year has to be the current year, the team has
to be the current team and the section could be deduced from the module
name, whence the current implementation. There is an example <a class="reference external" href="raweb1.html#330">line
330</a> and some more at <a class="reference external" href="raweb1.html#410">line 410</a>
(if the module name is empty, the link points to the section).</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">\href</span></code> command for external references, like in <a class="reference external" href="raweb1.html#258">line
258</a>, <a class="reference external" href="raweb1.html#280">line 280</a>, <a class="reference external" href="raweb1.html#384">line
384</a>, <a class="reference external" href="raweb1.html#394">line 394</a>, <a class="reference external" href="raweb1.html#398">line
398</a>, <a class="reference external" href="raweb1.html#481">line 481</a>.</p>
<p>In the bibliography, you can add a <code class="docutils literal notranslate"><span class="pre">url</span></code> field, like <a class="reference external" href="raweb1.html#bib-Avan-Bar-Pom03rr">this
one</a>. We provide the <code class="docutils literal notranslate"><span class="pre">\rrrt</span></code>
command: its argument is the number of a Inria Research report. Example
<a class="reference external" href="raweb1.html#bib-Bara-Chy-Pom03">here</a>.</p>
<p>It is also possible to give the <code class="docutils literal notranslate"><span class="pre">doi</span></code>: in <a class="reference external" href="raweb1.html#bib-lswprep">this
example</a>, indicating the <code class="docutils literal notranslate"><span class="pre">doi=</span></code> is the
same as the <code class="docutils literal notranslate"><span class="pre">xxurl</span></code>, without the xx.</p>
</section>
<section id="bibliography">
<span id="rabib"></span><h3>2.8 Bibliography<a class="headerlink" href="#bibliography" title="Link to this heading"></a></h3>
<section id="bibliography-the-raweb-case">
<span id="rabib1"></span><h4>2.8.1 Bibliography: the raweb case<a class="headerlink" href="#bibliography-the-raweb-case" title="Link to this heading"></a></h4>
<p>There are three bibliography files for the raweb: <code class="docutils literal notranslate"><span class="pre">miaou2003.bib</span></code>,
<code class="docutils literal notranslate"><span class="pre">miaou_foot2003.bib</span></code>, and <code class="docutils literal notranslate"><span class="pre">miaou_refer2003.bib</span></code>.</p>
<p>A reference from the main file miaou2003.bib appears in the bibliography
if it is cited via <code class="docutils literal notranslate"><span class="pre">\cite</span></code> (there is an example <a class="reference external" href="raweb1.html#122">line
122</a>) or via <code class="docutils literal notranslate"><span class="pre">\nocite</span></code> (example <a class="reference external" href="raweb1.html#246">line
246</a>) or if the <code class="docutils literal notranslate"><span class="pre">\nocite{*}</span></code> has been issued
(example <a class="reference external" href="raweb1.html#020">line 20</a>). The example file contains an
instance of each of the standard bibtex entries, with all the required
and optional fields, named std1 to std13, with two famous authors. The
main bibliography should contain only references of the Team in the
current year. Since 2013, this file is automatically generated.</p>
<p>Entries from miaou_refer2003.bib can be referred to via <code class="docutils literal notranslate"><span class="pre">\cite</span></code> or
<code class="docutils literal notranslate"><span class="pre">\refercite</span></code>, there is an implicit <code class="docutils literal notranslate"><span class="pre">\nocite{*}</span></code>, so that the whole
database is included. The miaou_refer2003.bib should contain the ten
most important published papers (or books) of the team.</p>
<p>Reference to other bibliography entries (not from the team, not from the
current year, or not one of the most important publications of the team)
can be made, provided that the entry is in miaou_foot2003.bib, and you
use the command <code class="docutils literal notranslate"><span class="pre">\footcite</span></code> (there is an example <a class="reference external" href="raweb1.html#122">line
122</a>).</p>
</section>
<section id="bibliography-the-general-case">
<span id="rabib2"></span><h4>2.8.2 Bibliography: the general case<a class="headerlink" href="#bibliography-the-general-case" title="Link to this heading"></a></h4>
<p>Normally, you say <code class="docutils literal notranslate"><span class="pre">\cite{foo,bar}</span></code>, and this makes two references to
some bibliographic entries, defined by <code class="docutils literal notranslate"><span class="pre">\bibitem{foo}</span></code> and
<code class="docutils literal notranslate"><span class="pre">\bibitem{bar}</span></code>. Very often, an external program, bibtex, is used to
compute the list of these <code class="docutils literal notranslate"><span class="pre">\bibitem</span></code> and their content, using the
argument of the <code class="docutils literal notranslate"><span class="pre">\bibliography</span></code> command as the list of the database
files to look at. The output of bibtex is put in the file miaou2003.bbl,
it contains essentially one <code class="docutils literal notranslate"><span class="pre">thebibliography</span></code> environment (more than
one in the raweb case), and lots of <code class="docutils literal notranslate"><span class="pre">\bibitem{foo}</span></code> commands. The
content of these is defined by the current bibliography style, the value
of the argument of the <code class="docutils literal notranslate"><span class="pre">\bibliographystyle</span></code> command.</p>
<p>The default behavior of <em>Tralics</em> is not to call bibtex, but to compute
and translate an intermediate file, say <code class="docutils literal notranslate"><span class="pre">miaou2003_.bbl</span></code> (note the
underscore), that is equivalent to the miaou2003.bbl file produced by
bibtex. It contains no <code class="docutils literal notranslate"><span class="pre">thebibliography</span></code> environment, but a lot of
<code class="docutils literal notranslate"><span class="pre">\citation</span></code> commands (that are in reality environments, since they are
explicitly terminated by an <code class="docutils literal notranslate"><span class="pre">\endcitation</span></code> command). This file is
translated (in case of errors while translating the bibliography, line
numbers refer to this file). An example is given under
<code class="docutils literal notranslate"><span class="pre">`\citation</span></code> &lt;doc-c.html#cmd-citation&gt;`__.</p>
<p>The result is independent of any bibliographystyle. It contains commands
of the form <code class="docutils literal notranslate"><span class="pre">\cititem{btitle}{title</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">book}</span></code>. If the command
<code class="docutils literal notranslate"><span class="pre">\cititem-btitle</span></code> is defined, it will be called with
<code class="docutils literal notranslate"><span class="pre">title</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">book</span></code> as argument. It can also contain commands as
<code class="docutils literal notranslate"><span class="pre">\bauteurs</span></code> and <code class="docutils literal notranslate"><span class="pre">\beditors</span></code>, that take as argument a list of
<code class="docutils literal notranslate"><span class="pre">\bpers</span></code> commands. All these commands can be redefined, they are
independent of commands used elsewhere.</p>
<p>The bibliography is translated at the end of the run, when the list of
all citations is found. The result is a <code class="docutils literal notranslate"><span class="pre">&lt;biblio&gt;</span></code> element (the name
can be changed, via the configuration file, using something like
xml_biblio = “Biblio”). This element is inserted in the XML tree at the
end. If you use the <code class="docutils literal notranslate"><span class="pre">\bibliography</span></code> command, the first occurrence of
it defines the location (bibtex complains if more than one
<code class="docutils literal notranslate"><span class="pre">\bibliography</span></code> is issued, but <em>Tralics</em> is happy with more than one).
You can also use <code class="docutils literal notranslate"><span class="pre">\insertbibliohere</span></code>, this command has precedence over
everything else.</p>
<p>Assume that the configuration file contains a line with bibtex_fields =
“firstpage lastpage”. The effect of this line is to tell <em>Tralics</em> to
read also the fields <code class="docutils literal notranslate"><span class="pre">firstpage</span></code> and <code class="docutils literal notranslate"><span class="pre">lastpage</span></code> and to include them
in the bbl file as <code class="docutils literal notranslate"><span class="pre">\cititem{firstpage}{50}</span></code>. If the configuration
file contains also bibtex_extension = “foo bar” then entry types <code class="docutils literal notranslate"><span class="pre">foo</span></code>
and <code class="docutils literal notranslate"><span class="pre">bar</span></code> are recognised, together with the standard types.</p>
</section>
<section id="bibliography-extended-syntax">
<span id="rabib3"></span><h4>2.8.3 Bibliography: extended syntax<a class="headerlink" href="#bibliography-extended-syntax" title="Link to this heading"></a></h4>
<p>The mechanism explained in §2.8.1 above works by extending the syntax of
the <code class="docutils literal notranslate"><span class="pre">\cite</span></code> command. It takes three arguments type (optional), prenote
(optional) and keys (a comma separated list of keys) for instance
<code class="docutils literal notranslate"><span class="pre">\cite[foo][bar]{gee1,</span> <span class="pre">gee2}</span></code>. If only one optional argument is given,
it is prenote. The translation is a sequence of
<code class="docutils literal notranslate"><span class="pre">&lt;cit&gt;&lt;ref&gt;</span>&#160;&#160; <span class="pre">&lt;/ref&gt;&lt;/cit&gt;</span></code> elements, one for each key.</p>
<p>The three commands <code class="docutils literal notranslate"><span class="pre">\footcite</span></code>, <code class="docutils literal notranslate"><span class="pre">\yearcite</span></code> and <code class="docutils literal notranslate"><span class="pre">\refercite</span></code> do
not read a type but assume it is, respectively, <code class="docutils literal notranslate"><span class="pre">foot</span></code>, <code class="docutils literal notranslate"><span class="pre">year</span></code> and
<code class="docutils literal notranslate"><span class="pre">refer</span></code>. In the case of <code class="docutils literal notranslate"><span class="pre">\footcite</span></code>, the first <code class="docutils literal notranslate"><span class="pre">&lt;cite&gt;</span></code> is
preceded by the value of <code class="docutils literal notranslate"><span class="pre">\footcitepre</span></code> (that does nothing by
default). See also <a class="reference external" href="doc-y.html#cmd-yearcite">\yearcite</a>,
<a class="reference external" href="doc-r.html#cmd-refercite">\refercite</a> and
<a class="reference external" href="doc-f.html#cmd-footcite">\footcite</a>. The commands <code class="docutils literal notranslate"><span class="pre">\yearcite</span></code> and
<code class="docutils literal notranslate"><span class="pre">\refercite</span></code> were introduced in version 2.8 of <em>Tralics</em>, while
<code class="docutils literal notranslate"><span class="pre">\footcite</span></code> is inspired from the footcite package by Eric Domenjoud.
The command <code class="docutils literal notranslate"><span class="pre">\nocite</span></code> is similar, but it takes no prenote. Its
translation is empty. A special key is <code class="docutils literal notranslate"><span class="pre">*</span></code>; in this case a global
variable is set (meaning that the whole bibliography data base should be
included). The command <code class="docutils literal notranslate"><span class="pre">\natcite</span></code> command takes three optional
arguments nat-type, prenote, postnote. Translation is one <code class="docutils literal notranslate"><span class="pre">&lt;Cit&gt;</span></code>
element, containing one <code class="docutils literal notranslate"><span class="pre">&lt;ref&gt;</span></code> per key.</p>
<p>If type is <code class="docutils literal notranslate"><span class="pre">year</span></code>, it will be replaced by an empty value; if type is
<code class="docutils literal notranslate"><span class="pre">refer</span></code> and DRY (see below) is false, it will be replaced as well. An
auxiliary command is then applied to each key. For instance
<code class="docutils literal notranslate"><span class="pre">\cite[year][aa]{r1,r2}</span></code> is converted into
<code class="docutils literal notranslate"><span class="pre">\cite&#64;one</span> <span class="pre">{}{r1}{aa}\citepunct</span> <span class="pre">\cite&#64;one</span> <span class="pre">{}{r2}{}</span></code> (the first empty
argument is the converted type type), and <code class="docutils literal notranslate"><span class="pre">\footcite[bar]{gee1,</span> <span class="pre">gee2}</span></code>
is converted into
<code class="docutils literal notranslate"><span class="pre">\footcitepre</span> <span class="pre">\cite&#64;one</span> <span class="pre">{foot}{gee1}{bar}\footcitesep</span> <span class="pre">\cite&#64;one</span>&#160;&#160; <span class="pre">{foot}{gee2}{}</span></code>
(the first command, by default does nothing). Finally,
<code class="docutils literal notranslate"><span class="pre">\natcite[aa][bb][cc]{r1,r2}</span></code> is converted to
<code class="docutils literal notranslate"><span class="pre">\NAT&#64;open</span> <span class="pre">bb</span> <span class="pre">\cite&#64;simple</span> <span class="pre">{r1}\NAT&#64;sep</span> <span class="pre">\cite&#64;simple</span> <span class="pre">{r2}\NAT&#64;cmt</span>&#160;&#160; <span class="pre">cc\NAT&#64;close</span> <span class="pre">\endnatcite</span></code>;
this uses some commands defined by the natbib.plt package. Translation
is
<code class="docutils literal notranslate"><span class="pre">&lt;Cit</span> <span class="pre">type='aa'&gt;(bb</span> <span class="pre">&lt;ref</span>&#160;&#160; <span class="pre">target='bid0'/&gt;;&lt;ref</span> <span class="pre">target='bid1'/&gt;,</span>&#160;&#160; <span class="pre">cc)&lt;/Cit&gt;</span></code>.
The purpose of the <code class="docutils literal notranslate"><span class="pre">\endnat</span></code> token is to finish the <code class="docutils literal notranslate"><span class="pre">&lt;Cit&gt;</span></code> element.
Translation of <code class="docutils literal notranslate"><span class="pre">\cite{xx}</span></code> is <code class="docutils literal notranslate"><span class="pre">&lt;cit&gt;&lt;ref</span> <span class="pre">target='bid8'/&gt;&lt;/cit&gt;</span></code>.</p>
<p>Let’s explain the commands <code class="docutils literal notranslate"><span class="pre">\cite&#64;simp{key}</span></code> and
<code class="docutils literal notranslate"><span class="pre">\cite&#64;one{type}{val}{key}</span></code>. They first generate a cite key, formed of
the type, the string “cite:” and the key, for instance
<code class="docutils literal notranslate"><span class="pre">footcite:gee2</span></code>. A unique identifier (for instance <code class="docutils literal notranslate"><span class="pre">bid1</span></code>) is
associated to the key. If the identifier does not exists, the reference
is marked to be solved; it is an error if <code class="docutils literal notranslate"><span class="pre">\cite</span></code> is called after
<em>Tralics</em> has started translating the bibliography (for instance, you
cannot use the command in a bibliography file). In the case of
<code class="docutils literal notranslate"><span class="pre">\nocite</span></code> no further action is taken; otherwise a reference is
created, of the form <code class="docutils literal notranslate"><span class="pre">&lt;ref</span> <span class="pre">target='bid1'/&gt;</span></code>. In the case of
<code class="docutils literal notranslate"><span class="pre">\cite&#64;simp</span></code>, this element is inserted in the XML tree, and no further
action is taken. Otherwise, the translation of the second argument
becomes the content of the element. A new paragraph is started if
necessary, and a <code class="docutils literal notranslate"><span class="pre">&lt;cit&gt;</span></code> element is inserted in the current XMl tree;
its value is the <code class="docutils literal notranslate"><span class="pre">&lt;ref&gt;</span></code> element. It may have three attribute:
<code class="docutils literal notranslate"><span class="pre">rend='type'</span></code> (where the value of the attribute is the type),
<code class="docutils literal notranslate"><span class="pre">type='w'</span></code> (in case <code class="docutils literal notranslate"><span class="pre">\def\cite&#64;&#64;type{w}</span></code> has been executed), and
<code class="docutils literal notranslate"><span class="pre">prenote='xx'</span></code> (in case <code class="docutils literal notranslate"><span class="pre">\def\cite&#64;prenote{xx}</span></code> has been executed).</p>
<p>One task of <em>Tralics</em> is to solve the citations, this means, for every
cite key, for instance <code class="docutils literal notranslate"><span class="pre">footcite:gee2</span></code> with unique id <code class="docutils literal notranslate"><span class="pre">bid1</span></code>, there
is a unique element whose id attribute is bid1. There are different
ways, see below. After the whole document is translated, <em>Tralics</em>
checks if there are unsolved citations. If so, it translates the
bibliography. After that, for unsolved citations, an error is signaled
of the form <em>Error signaled while handling entry footcite:gee2 undefined
reference</em>. The <code class="docutils literal notranslate"><span class="pre">\bibliography</span></code> command specifies the list of data
files to consider. In the case of <code class="docutils literal notranslate"><span class="pre">torture+foot</span></code> (assuming there is no
file torture+foo.bib) the file torture.bib is read, and
<code class="docutils literal notranslate"><span class="pre">footcite:gee2</span></code> is solved by a reference whose key is gee2. In the
case of the raweb, for instance for miaou2006, there are three
bibliography files miaou2006.bib (should contain all references of the
year 2006 of the team), miaou_refer2006.bib (contains major publications
of the team in recent years) and miaou_foot2006.bib (for everything
else). These file solve entries of type year, refer and foot
respectively. It may happen that <em>Tralics</em> moves an entry from one
category to the other, withe a message of the type <em>entry moved from
refer to year</em> for different reasons.</p>
<p>There is a special hack, DRY (for distinguish-refer-year) introduced in
version 2.8. If <em>Tralics</em> is called with the switch
-distinguish_refer_in_rabib=false, then DRY mode is set to false (see
details in <a class="reference external" href="options.html#drir">Options of the program</a>). It is true
by default. If DRY is true, you can put the same entry (with the same
key, and the same value) in both files miaou2006.bib and
miaou_refer2006.bib. This is however not recommended.</p>
</section>
<section id="bibliography-more-hacks">
<span id="rabib4"></span><h4>2.8.4 Bibliography: more hacks<a class="headerlink" href="#bibliography-more-hacks" title="Link to this heading"></a></h4>
<p>There are different ways to put solve an entry. For instance
<code class="docutils literal notranslate"><span class="pre">\xbox</span> <span class="pre">{foo}</span> <span class="pre">{\XMLsolvecite</span> <span class="pre">[]</span> <span class="pre">[foot]</span> <span class="pre">{toto}</span> <span class="pre">{text}}</span></code> (see
<a class="reference external" href="doc-x.html#cmd-XMLsolvecite">\XMLsolvecite</a>) solves the entry
associated to <code class="docutils literal notranslate"><span class="pre">\footcite{toto}</span></code>. You can also use
<code class="docutils literal notranslate"><span class="pre">\bibitem[xx]{toto]</span></code> (see <a class="reference external" href="doc-b.html#cmd-bibitem">\bibitem</a>),
that solves the entry with a <code class="docutils literal notranslate"><span class="pre">&lt;citation&gt;</span></code> element. You can ask
<em>Tralics</em> to generate the bibliography, or use an external program that
get all data from one or more bibliography databases. Note: you must use
the -shell-escape argument of <em>Tralics</em> in order to execute an external
program.</p>
<p><em>Tralics</em> interprets the argument of the <code class="docutils literal notranslate"><span class="pre">\bibliographystyle</span></code> command
as follows. If it is <code class="docutils literal notranslate"><span class="pre">bibtex:foo</span></code>, this means that <code class="docutils literal notranslate"><span class="pre">bibtex</span> <span class="pre">testb</span></code> is
executed; if it is <code class="docutils literal notranslate"><span class="pre">program:cat</span></code>, this means that the program
<code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">testb.aux</span></code> will be executed. In all other cases, it defines the
style to be used (default is plain). This command can be used more then
once: first to define the style, second to define the command; note that
<code class="docutils literal notranslate"><span class="pre">bibtex:foo</span></code> sets the style to foo, and <code class="docutils literal notranslate"><span class="pre">bibtex:</span></code> uses the defined
style. We assume here that testb is the name of the document to
translate. Example</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">documentclass</span><span class="p">{</span><span class="n">article</span><span class="p">}</span>
\<span class="n">begin</span><span class="p">{</span><span class="n">document</span><span class="p">}</span>
\<span class="n">AtEndDocument</span><span class="p">{</span>\<span class="n">bibitem</span><span class="p">{</span><span class="n">unused</span><span class="p">}</span><span class="n">Hey</span><span class="p">}</span>
\<span class="n">bibliography</span><span class="p">{</span><span class="n">torture</span><span class="p">}</span>
\<span class="n">bibliographystyle</span><span class="p">{</span><span class="n">bibtex</span><span class="p">:}</span>
\<span class="n">cite</span><span class="p">{</span><span class="n">poussin</span><span class="p">,</span><span class="n">cruz</span><span class="p">,</span><span class="n">many</span><span class="p">,</span><span class="n">strange</span><span class="p">,</span><span class="n">unused</span><span class="p">}</span>
\<span class="n">end</span><span class="p">{</span><span class="n">document</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>If an external program is given, a minimal auxiliary file is created,
named, testb.aux, containing</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">citation</span><span class="p">{</span><span class="n">poussin</span><span class="p">}</span>
\<span class="n">citation</span><span class="p">{</span><span class="n">cruz</span><span class="p">}</span>
\<span class="n">citation</span><span class="p">{</span><span class="n">many</span><span class="p">}</span>
\<span class="n">citation</span><span class="p">{</span><span class="n">strange</span><span class="p">}</span>
\<span class="n">bibstyle</span><span class="p">{</span><span class="n">plain</span><span class="p">}</span>
\<span class="n">bibdata</span><span class="p">{</span><span class="n">torture</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>It is assumed that the external program generates a file named
testb.bbl; this is obviously not the case for <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">testb.aux</span></code>. This
file is loaded (if possible) and executed. It is assumed that
translating this file will solve all entries, but no further checks are
done.</p>
<p>If no external program is given, <em>Tralics</em> will read the database files, and
construct a bbl file (named <code class="docutils literal notranslate"><span class="pre">testb_.bbl</span></code>) and executes it. Given the following
command <code class="docutils literal notranslate"><span class="pre">\newcommand</span> <span class="pre">\usebib[2]</span> <span class="pre">{\bibliography{#1#2,</span> <span class="pre">#1_foot#2+foot,</span>
<span class="pre">#1_refer#2+refer}}</span></code>, you can say <code class="docutils literal notranslate"><span class="pre">\usebib{miaou}{2003}</span></code>, if you want to mimic
what <em>Tralics</em> does for the RA2003. (note: only suffixes year, foot and refer
are considered; this could be generalized).</p>
</section>
<section id="bibliography-reducing-entropy">
<span id="rabib5"></span><h4>2.8.5 Bibliography: reducing entropy<a class="headerlink" href="#bibliography-reducing-entropy" title="Link to this heading"></a></h4>
<p>A new feature was introduced in 2006, it allows the use of a single data
base instead of three different ones. This means that you can provide
miaou_all2006.bib instead of three files. This feature is incompatible
with the idea that one of the three files is automatically generated. An
entry in the file has type year, foot or refer, if it is cited by
<code class="docutils literal notranslate"><span class="pre">\yearcite</span></code>, <code class="docutils literal notranslate"><span class="pre">\footcite</span></code> or <code class="docutils literal notranslate"><span class="pre">\refercite</span></code> or <code class="docutils literal notranslate"><span class="pre">\nocite</span></code> with the
corresponding flag.</p>
<p>When <em>Tralics</em> reads the file miaou_all2006.bib, and sees an entry, say
`Knuth’, it considers it as solving <code class="docutils literal notranslate"><span class="pre">\cite{Knuth}</span></code>,
<code class="docutils literal notranslate"><span class="pre">\refercite{Knuth}</span></code> or <code class="docutils literal notranslate"><span class="pre">\footcite{Knuth}</span></code>. In general, a single
alternative is chosen, but as explained above, it is allowed to use both
<code class="docutils literal notranslate"><span class="pre">\cite{Knuth}</span></code> and <code class="docutils literal notranslate"><span class="pre">\refercite{Knuth}</span></code>.</p>
<p>What happens if you say <code class="docutils literal notranslate"><span class="pre">\nocite{*}</span></code>? One possibility would be to
insert the whole data base thrice (as foot, refer and year), a second
possibility would be to insert it once, but not as year, neither as
refer. Hence, the only logical solution: the behavior is the same as
before version 2.9.3. If you say <code class="docutils literal notranslate"><span class="pre">\nocite{*}</span></code>, all entries from
miaou2006.bib are included, by defaut all entries from
miaou_refer2006.bib are included. As a consequence, an entry from
miaou_foot2006.bib or miaou_all2006.bib is included only if explicitly
cited. This can be done via <code class="docutils literal notranslate"><span class="pre">\nocite[foot]{Knuth}</span></code> or
<code class="docutils literal notranslate"><span class="pre">\nocite[refer]{Knuth}</span></code> if the reference should have type `foot’ or
`refer’.</p>
<p>Important note. Assume that you say <code class="docutils literal notranslate"><span class="pre">\cite{Knuth}</span></code> and
<code class="docutils literal notranslate"><span class="pre">\footcite{knuth}</span></code>, but no other variants like KNUTH of KNuth, etc. It
is possible to have two files miaou2006.bib and miaou_foot2006.bib with
the entry `Knuth’. When the second data base is read, then `Knuth’
will solve `knuth’ (assuming that the data base does not contain any
variants like KNUTH, etc.) However, if you merge these two files in a
single one, you will be in trouble: `Knuth’ will solve
<code class="docutils literal notranslate"><span class="pre">\cite{Knuth}</span></code>, and no tentative is made for variants; in this case
the data base must contain `knuth’ that solves <code class="docutils literal notranslate"><span class="pre">\footcite{knuth}</span></code>.</p>
</section>
</section>
</section>
<section id="running-the-programs">
<span id="run0"></span><h2>3. Running the programs<a class="headerlink" href="#running-the-programs" title="Link to this heading"></a></h2>
<p>Options to the <em>Tralics</em> program can be found on a <a class="reference external" href="options.html">separate
page</a>. Some of them have been removed in 2008, there
description can be found <a class="reference external" href="raweb4.html">here</a>, where we explain the
different strategies that could be used to produce the Raweb before
2008.</p>
<p>You have the following choices:</p>
<ol class="arabic simple">
<li><p>You are not interested in the raweb, and you just say tralics myfile.
This produces a beautiful XML document.</p></li>
<li><p>You do not have tralics on your machine: you run latex (bibtex,
dvips, etc) on your TeX document. The gives a dvi or PS version of
your document (with `draft’ on each page in the case of the Raweb).</p></li>
<li><p>You can say tralics -check. This will check the syntax, and produce a
transcript file, and nothing more.</p></li>
<li><p>You can say tralics myfile -ps. This is more or less the combination
of the two previous options. However, the order of the modules might
be changed. This generates a PostScript file with the Inria Logo on
it.</p></li>
<li><p>You can say tralics myfile -myoptions. This produces a beautiful XML
document, and more. For instance, if you tralics -xmltex, you will
get a pdf file, provided that all files and scripts are available on
your machine (normally, everything should be included in the raweb
package, contact maintainers of this package in case of problem).</p></li>
</ol>
<p>Since 2008, all these funny options have been removed, and <em>Tralics</em>
just produces the XML file.</p>
<section id="options-of-the-program">
<h3>3.1 Options of the program<a class="headerlink" href="#options-of-the-program" title="Link to this heading"></a></h3>
<p>Options of the program are available on a <a class="reference external" href="options.html">separate
page</a>.</p>
</section>
<section id="running-latex">
<h3>3.2 Running latex<a class="headerlink" href="#running-latex" title="Link to this heading"></a></h3>
<p>You can run latex on the file. This works provided that the raweb class
file is available (until 2006). This is the first run</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ latex miaou2003
This is TeX, Version 3.14159 (Web2C 7.3.1)
(miaou2003.tex
LaTeX2e &lt;2003/12/01&gt;
Babel &lt;v3.8c&gt; and hyphenation patterns for english, UKenglish, french, german,
ngerman, italian, spanish, dumylang, nohyphenation, loaded.
(/usr/local/lib/texmf.local/tex/generic/inria/inputs/ra2003.cls
Document Class: ra2003 2003/06/12 v3,1 Copyright INRIA/MIAOU 2003 (E version)
(/usr/local/lib/texmf/tex/latex/base/article.cls
Document Class: article 2004/02/16 v1.4f Standard LaTeX document class
%%Stuff about packages omitted
No file miaou2003.aux.
No file miaou2003.fb.bbl.
No file miaou2003.fb.aux.
No file miaou2003.toc.
No file miaou2003.refer.bbl.
No file miaou2003.bbl.
%% Lots of warnings omitted
LaTeX Warning: There were undefined references.
LaTeX Warning: Label(s) may have changed. Rerun to get cross-references right.)
(see the transcript file for additional information)
Output written on miaou2003.dvi (11 pages, 22628 bytes).
Transcript written on miaou2003.log.
</pre></div>
</div>
</div>
<p>The start of the run could also be, in 2006, something like</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ latex apics2006
This is pdfeTeX, Version 3.141592-1.30.3-2.2 (Web2C 7.5.5)
entering extended mode
(./apics2006.tex
LaTeX2e &lt;2003/12/01&gt;
Babel &lt;v3.8d&lt; and hyphenation patterns for american, french, german, ngerman,
bahasa, basque, bulgarian, catalan, croatian, czech, danish, dutch, esperanto,
estonian, finnish, greek, icelandic, irish, italian, latin, magyar, norsk,
polish, portuges, romanian, russian, serbian, slovak, slovene, spanish,
swedish, turkish, ukrainian, nohyphenation, loaded.
(./ra2006.cls
Document Class: ra2006 2006/07/25 v3,2
   Copyright INRIA/MIAOU/APICS 2006 Raweb in DRAFT mode
(/usr/local/teTeX/share/texmf-dist/tex/latex/base/article.cls
</pre></div>
</div>
</div>
<p>Run bibtex on each of the three files. <strong>Note</strong>: the arguments of bibtex
are not completely obvious. The file miaou2003.fb.aux is created by the
footbib package, and the use of the <code class="docutils literal notranslate"><span class="pre">\footcite</span></code> command, the file
miaou2003.refer.aux is created by the <code class="docutils literal notranslate"><span class="pre">\loadbiblio</span></code> command.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ bibtex miaou2003
This is BibTeX, Version 0.99c (Web2C 7.3.1)
The top-level auxiliary file: miaou2003.aux
The style file: raweb.bst
Database file #1: miaou2003.bib
Warning--empty booktitle in seyfertIMS2003
(There was 1 warning)
grimm@medee$ bibtex miaou2003.fb
This is BibTeX, Version 0.99c (Web2C 7.3.1)
The top-level auxiliary file: miaou2003.fb.aux
The style file: rawebalpha.bst
Database file #1: miaou_foot2003.bib
grimm@medee$ bibtex miaou2003.refer
This is BibTeX, Version 0.99c (Web2C 7.3.1)
The top-level auxiliary file: miaou2003.refer.aux
The style file: rawebnum.bst
Database file #1: miaou_refer2003.bib
</pre></div>
</div>
</div>
<p>Run latex a second time</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ latex miaou2003
This is TeX, Version 3.14159 (Web2C 7.3.1)
(miaou2003.tex
%% Lots of warnings/messages omitted
LaTeX Warning: There were undefined references.
LaTeX Warning: There were multiply-defined labels.)
(see the transcript file for additional information)
Output written on miaou2003.dvi (15 pages, 42256 bytes).
Transcript written on miaou2003.log.
</pre></div>
</div>
</div>
<p>Run latex a third time. This will suppress the `undefined references’
message.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ latex miaou2003
This is TeX, Version 3.14159 (Web2C 7.3.1)
(miaou2003.tex
%% Lots of messages omitted
LaTeX Warning: Label `MIAOU@resultats@&#39; multiply defined.
%% Lots of messages omitted
LaTeX Warning: There were multiply-defined labels. )
(see the transcript file for additional information)
Output written on miaou2003.dvi (15 pages, 42264 bytes).
Transcript written on miaou2003.log.
grimm@medee$ dvips  miaou2003 -o
This is dvips(k) 5.94a Copyright 2003 Radical Eye Software (www.radicaleye.com)
&#39; TeX output 2004.07.29:1056&#39; -&gt; miaou2003.ps
&lt;tex.pro&gt;&lt;special.pro&gt;. [1] [2] [3] [4] [5] [6] [7] [8] [9&lt;xml-route.ps&gt;]
[10] [11] [12] [13] [14] [15]
</pre></div>
</div>
</div>
<p>The result is the following <a class="reference download internal" download="" href="_downloads/13c82a9e9cba2ce0fbb60db94b9f83b4/miaou2003.ps"><code class="xref download docutils literal notranslate"><span class="pre">miaou2003.ps</span></code></a>. There
are two sections `New results’ (section 6 and 8), because there is a module in
section `new results’ after a module in section `Contracts’. This explains why
LaTeX sees multiply-defined labels. There is an: Overfull \hbox (22.7474pt too
wide) in paragraph at lines 19–19. Line 19 contains the <code class="docutils literal notranslate"><span class="pre">\maketitle</span></code> command.
The overfull box contains the long name of the Team. It is hard to remove it.
Note: this is a draft version. You should not try to add commands that remove
overfull and underfull boxes, this is completely useless.</p>
</section>
<section id="running-tralics">
<h3>3.3 Running Tralics<a class="headerlink" href="#running-tralics" title="Link to this heading"></a></h3>
<p>When you run <em>Tralics</em>, whatever the arguments, it will print the
following lines. The third line (<code class="docutils literal notranslate"><span class="pre">Starting</span> <span class="pre">XX</span> <span class="pre">processing</span> <span class="pre">for</span> <span class="pre">YYY</span></code> may
change).</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is tralics 2.2, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2004, Jos\&#39;e Grimm
Starting latex processing for miaou2003.
Configuration file identification: standard $Revision: 2.3 $
Read configuration file /net/home/grimm/cvs/tralics/.tralics_rc.
For the environment ending near line 191
please use `participant&#39; or `participante&#39; for the name,
as there is only one \pers in the list.
For the environment ending near line 253:
please use `participants&#39; or `participantes&#39; for the name,
as there are 2 \pers in the list.
There are 63 environments
Checked 5 keyword env with 19 keywords
Checked 5 catperso and 9 participant(es) envs with 34 \pers
There were 2 topics
Sections (and # of modules): 1(1) 2(1) 3(1) 4(6) 5(5) 6(4) 7(3) 8(4) 9(3).
</pre></div>
</div>
</div>
<p>We already explained the messages about singular/plural in the
<code class="docutils literal notranslate"><span class="pre">participant</span></code> environment. The preprocessor has seen 63 environments
(5 <code class="docutils literal notranslate"><span class="pre">motscle</span></code>, 5 <code class="docutils literal notranslate"><span class="pre">catperso</span></code>, 9 <code class="docutils literal notranslate"><span class="pre">participant</span></code>, 28 <code class="docutils literal notranslate"><span class="pre">module</span></code>, and
some others, namely one <code class="docutils literal notranslate"><span class="pre">moreinfo,</span></code> one <code class="docutils literal notranslate"><span class="pre">glossaire</span></code>, one <code class="docutils literal notranslate"><span class="pre">array</span></code>,
one <code class="docutils literal notranslate"><span class="pre">figure</span></code>, two <code class="docutils literal notranslate"><span class="pre">description</span></code>, two <code class="docutils literal notranslate"><span class="pre">equation</span></code>, and 8
<code class="docutils literal notranslate"><span class="pre">itemize</span></code>). The total number of keywords is 19, the number of
<code class="docutils literal notranslate"><span class="pre">\pers</span></code> commands is 34. They were two declared topics, and the last
line indicates the number of modules per section.</p>
<p>You can run tralics with option -check. In this case, the program checks
the syntax, prints some information, and that’s all.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics miaou2003 -check
This is tralics 2.2, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2004, Jos\&#39;e Grimm
Starting check for miaou2003.
%% Common output as above omitted
</pre></div>
</div>
</div>
<p>For the 2006 version, this changes a little bit. Note that there are no
artificial topics in the Apics RA.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is tralics 2.8, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2006, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting xml processing for apics2006.
Configuration file identification: standard $ Revision: 2.18 $
Read configuration file .tralics_rc.
Configuration file identification: standard-ra $ Revision: 2.2 $
Read tcf file for type: ../confdir/ra.tcf
There are 157 environments
You did not use any topic
Sections (and # of modules): 1(1) 2(1) 3(2) 4(6) 5(5) 6(15) 7(2) 8(6) 9(3).
</pre></div>
</div>
</div>
</section>
<section id="running-tralics-ps">
<h3>3.4 Running Tralics -ps<a class="headerlink" href="#running-tralics-ps" title="Link to this heading"></a></h3>
<p>Let’s try tralics -ps miaou2003. The effect of this command is to check
the source file, re-arrange the modules in the right order, and call
LaTeX. The ps option is not supported anymore in the 2008 version.</p>
<p>From the input file miaou2003.tex another source file miaou.tex (whose
content is given <a class="reference external" href="raweb2.html">here</a>) is created. Essentially, it is
the initial file, with the modules in the right order; commands like
<code class="docutils literal notranslate"><span class="pre">\begin{module}</span></code> are replaced by
<code class="docutils literal notranslate"><span class="pre">\RAstartmodule{1}</span> <span class="pre">{MIAOU}</span> <span class="pre">{6}</span> <span class="pre">{tralics}{...}</span></code> (the first number is
the topics, the second number is the section). The document class is
<code class="docutils literal notranslate"><span class="pre">raweb</span></code>.</p>
<p>This file is compiled by an external program, launched directly by
<em>Tralics</em> some years ago, a Perl script later on. On some systems the
latex command does not recognize the -interaction switch, and you have
to say something like /mypath/mylatex \nonstopmodeinput{thefile}. For
these reasons, the names of the command to execute is not built-in, but
in the configuration file. We assume that the relevant lines are:</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">makefo</span><span class="o">=</span><span class="s2">&quot;xsltproc --catalogs -o %A.fo %B %C&quot;</span><span class="p">;</span>
<span class="n">makehtml</span> <span class="o">=</span> <span class="s2">&quot;xsltproc --catalogs  %B %C&quot;</span><span class="p">;</span>
<span class="n">call_lint</span> <span class="o">=</span> <span class="s2">&quot;xmllint --catalogs --valid  --noout %C&quot;</span>
<span class="n">makepdf</span> <span class="o">=</span> <span class="s2">&quot;pdflatex -interaction=nonstopmode %w&quot;</span>
<span class="n">generatedvi</span> <span class="o">=</span> <span class="s2">&quot;latex -interaction=nonstopmode %t&quot;</span>
<span class="n">generateps</span> <span class="o">=</span> <span class="s2">&quot;dvips %t.dvi -o %t.ps&quot;</span>
</pre></div>
</div>
</div>
<p>These lines are copied in the file user_param.pl and the Perl script
rahandler.pl is called on it (there is a command line option that allows
the use of another program). In the example that follows, there are
lines of the form todo_something=x. They correspond to the options of
tralics. Here ps is set to true, this explains that the script must call
latex on the file apics.tex. Here html is set to false, true would mean
that conversion from apics.xml to apics.html is required.</p>
<div class="ltx-source docutils container" id="user-param">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$::makefo=&#39;xsltproc --catalogs -o %A.fo %B %C&#39;;
$::makehtml=&#39;xsltproc --catalogs  %B %C&#39;;
$::checkxml=&#39;xmllint --catalogs --valid  --noout %C&#39;;
$::makepdf=&#39;pdflatex -interaction=nonstopmode %w&#39;;
$::makedvi=&#39;&#39;;
$::dvitops=&#39;&#39;;
$::generate_dvi=&#39;latex -interaction=nonstopmode %t&#39;;
$::generate_ps=&#39;dvips %t.dvi -o %t.ps&#39;;
$::tralics_dir=&#39;/user/grimm/home/cvs/tralics&#39;;
$::ra_year=&#39;2006&#39;;
$::no_year=&#39;apics&#39;;
$::tex_file=&#39;apics&#39;;
$::todo_fo=0;
$::todo_html=0;
$::todo_tex=0;
$::todo_lint=0;
$::todo_ps=1;
$::todo_xml=0;
1;
</pre></div>
</div>
</div>
<p>This is now what you see on the screen.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics miaou2003 -ps
This is tralics 2.2, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2004, Jos\&#39;e Grimm
Starting latex processing for miaou2003.
%% Common output as above omitted
/user/grimm/home/bin/rahandler.pl v2.5, (C) 2004 INRIA, José Grimm, projet APICS
copy-and-exec for miaou
latex -interaction=nonstopmode miaou
This is TeX, Version 3.14159 (Web2C 7.3.1)
(miaou.tex
LaTeX2e &lt;2003/12/01&gt;
Babel &lt;v3.8c&gt; and hyphenation patterns for english, UKenglish, french, german,
ngerman, italian, spanish, dumylang, nohyphenation, loaded.
(raweb.cls
Document Class: raweb 2001/06/14 v2,2 Copyright INRIA/MIAOU 2001
(/usr/local/lib/texmf/tex/latex/base/article.cls
Document Class: article 2004/02/16 v1.4f Standard LaTeX document class
%%more latex trace
No file miaou.aux.
No file miaou.fb.bbl.
No file miaou.fb.aux.
No file miaou.toc.
%%more latex trace
No file miaou.refer.bbl.
No file miaou.bbl.
[10] (miaou.fb.aux) (miaou.aux)

LaTeX Warning: There were undefined references.
LaTeX Warning: Label(s) may have changed. Rerun to get cross-references right.)
(see the transcript file for additional information)
Output written on miaou.dvi (11 pages, 19004 bytes).
Transcript written on miaou.log.
exit status of latex is 0
bibtex -min-crossrefs=1000 miaou
bibtex exit status 0
bibtex -min-crossrefs=1000 miaou.refer
bibtex exit status 0
bibtex -min-crossrefs=1000 miaou.fb
bibtex exit status 0
latex -interaction=nonstopmode miaou
This is TeX, Version 3.14159 (Web2C 7.3.1)
(miaou.tex
%%more latex trace
LaTeX Warning: Label(s) may have changed. Rerun to get cross-references right.
(see the transcript file for additional information)
Output written on miaou.dvi (15 pages, 38616 bytes).
Transcript written on miaou.log.
exit status of latex is 0
latex -interaction=nonstopmode miaou
This is TeX, Version 3.14159 (Web2C 7.3.1)
(miaou.tex
%%more latex trace
(miaou.aux) )
(see the transcript file for additional information)
Output written on miaou.dvi (15 pages, 38624 bytes).
Transcript written on miaou.log.
exit status of latex is 0
dvips miaou.dvi -o miaou.ps
This is dvips(k) 5.94a Copyright 2003 Radical Eye Software (www.radicaleye.com)
&#39; TeX output 2004.07.29:1125&#39; -&gt; miaou.ps
&lt;tex.pro&gt;&lt;8r.enc&gt;&lt;texps.pro&gt;&lt;special.pro&gt;. [1&lt;LogoRA2003.eps&gt;
&lt;Logo-INRIA-couleur.ps&gt;] [2] [1] [2] [3] [4] [5] [6] [7&lt;xml-route.ps&gt;] [8]
[9] [10] [11] [12] [13]
exit status of dvips is 0
(Transcript written on miaou.rh.log)
done
</pre></div>
</div>
</div>
<p>The result is the following <a class="reference download internal" download="" href="_downloads/1663cf9965197674d0e2cc61c5bf16cc/miaou.ps"><code class="xref download docutils literal notranslate"><span class="pre">miaou.ps</span></code></a>.</p>
<p>There is one warning: Underfull \vbox (badness 10000) has occurred
while \output is active. Tracing TeX shows the following. The selected
breakpoint at end of page 7 has: t=151.71101 plus 4.88531, g=200.427
(here g is the size of the page, minus the size of the image, and t the
size of the text, the big difference between t and g explains the
underfull box). There is no page break between the title of module 6.2
and the first line of the text. There is possible page break between
this line and the start of 6.3. Parameters are t=201.6997 plus 12.54138
minus 0.94266 and g=200.427. This pagebreak is not chosen because it
would overflow by 0.33pt! Adding a bit of shrinkability to the parskip,
for instance <code class="docutils literal notranslate"><span class="pre">\parskip</span> <span class="pre">=0pt</span> <span class="pre">plus</span> <span class="pre">1pt</span> <span class="pre">minus</span> <span class="pre">1pt</span></code>, is enough in this
case. But, remember: this is not the final document.</p>
<p>In case of errors, latex may complain, for instance as “Undefined
control sequence”. In this case, you will see something like “exit
status of latex is 256”. A zero status is OK, a non-zero one means an
error. If your code contains <code class="docutils literal notranslate"><span class="pre">\def\foobar{0\foobar}\foobar</span></code>, you will
overflow TeX’s memory. However, if you remove the 0, you will go in an
endless loop. If you kill the process, normally, this will kill the Perl
script, and the latex process. After that, you will have to debug (add
<code class="docutils literal notranslate"><span class="pre">\tracingall</span></code> somewhere, and look at the transcript file, its name is
miaou.log)</p>
</section>
<section id="running-tralics-xml">
<h3>3.5 Running Tralics -xml<a class="headerlink" href="#running-tralics-xml" title="Link to this heading"></a></h3>
<p>Let’s start with a call of <em>Tralics</em> without options. This is what you
will see (you may notice that module statistics are no longer computed)</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>This is tralics 2.13.0, a LaTeX to XML translator, running on medee
Copyright INRIA/MIAOU/APICS 2002-2008, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting translation of file apics2007.tex.
Configuration file identification: standard $ Revision: 2.24 $
Read configuration file /user/grimm/home/cvs/tralics/confdir/.tralics_rc.
Configuration file identification: standard-ra $ Revision: 2.3 $
Read tcf file /user/grimm/home/cvs/tralics/confdir/ra2007.tcf
Document class: ra2007 2008/07/16 v1.1 Activity Report, Inria 2007
Translating section composition
Translating section presentation
Translating section fondements
Translating section domaine
Translating section logiciels
Translating section resultats
Translating section contrats
Translating section international
Translating section diffusion
Bib stats: seen 91 entries.
Seen 91 bibliographic entries.
Math stats: formulas 612, kernels 212, trivial 3, \mbox 6, large 0, small 65.
Buffer realloc 40, string 18431, size 669087, merge 13
Macros created 2013, deleted 1766; hash size 2493; foonotes 1.
Save stack +2635 -2635.
Attribute list search 11990(1484) found 3831 in 6638 elements (1117 at boot).
Number of ref 105, of used labels 47, of defined labels 109, of ext. ref. 24.
Input conversion: 137 lines converted.
There were 20 images.
Output written on apics.xml (289437 bytes).
No error found.
(For more information, see transcript file apics2007.log)
</pre></div>
</div>
</div>
<p>Let’s try apics2006 with version 2.8. We get</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grimm@medee$ tralics apics2006
This is tralics 2.8, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2006, Jos\&#39;e Grimm
Licensed under the CeCILL Free Software Licensing Agreement
Starting xml processing for apics2006.
%% Common output as above omitted
Translating section composition
Translating section presentation
Translating section fondements
Translating section domaine
Translating section logiciels
Translating section resultats
Translating section contrats
Translating section international
Translating section diffusion
Bib stats: seen 71 entries
Seen 75 bibliographic entries
%% Memory usage
Used 1784 commands
Math stats: formulas 607, non trivial kernels 321,
   special 7, trivial 141, \mbox 6, large 0, small 142.
Buffer realloc 32, string 18447, size 704375, merge 13
Macros created 85, deleted 0.
Save stack +1828 -1828.
Attribute list search 8640(1549) found 3514 in 6351 elements (1450 after boot).
Number of ref 96, of used labels 46, of defined labels 90, of ext. ref. 26.
Modules with 26, without 15, sections with 9, without 19
There were 16 images.
Output written on apics.xml (284415 bytes).
No error found. %% Very important information here
(For more information, see transcript file apics2006.log)
%% Raweb specific commands, via the Perl script
rahandler.pl v2.12, (C) 2004 2006 INRIA, Jos\&#39;e Grimm, Team Apics
Postprocessor did nothing
</pre></div>
</div>
</div>
<p>You can see that the Perl script has been called. It is configurated to
call a XSLT processor twice (producing a file miaou.fo, or a bunch of
HTML files), then calling pdflatex twice, then xmllint. In fact nothing
is done.</p>
<p>You could try tralics apics2006 -xmllint. No error is signaled: the file
apics2006.tex that we use to check the tools produces correct output!
You could try tralics miaou2003 -xmllint. The answer is that the
document produced by <em>Tralics</em> does not conform the DTD, because the
module starting at <a class="reference external" href="raweb1.html#201">line 201</a> contains no text; in
reality, xmllint says the following:</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">miaou</span><span class="o">.</span><span class="n">xml</span><span class="p">:</span><span class="mi">152</span><span class="p">:</span> <span class="n">element</span> <span class="n">module</span><span class="p">:</span> <span class="n">validity</span> <span class="n">error</span> <span class="p">:</span> <span class="n">Element</span> <span class="n">module</span> <span class="n">content</span> <span class="n">does</span>
<span class="ow">not</span> <span class="n">follow</span> <span class="n">the</span> <span class="n">DTD</span><span class="p">,</span> <span class="n">expecting</span> <span class="p">(</span><span class="n">head</span> <span class="p">,</span> <span class="p">(</span><span class="n">moreinfo</span> <span class="o">|</span> <span class="n">keywords</span> <span class="o">|</span> <span class="n">participant</span> <span class="o">|</span>
<span class="n">participants</span> <span class="o">|</span> <span class="n">participante</span> <span class="o">|</span> <span class="n">participantes</span> <span class="o">|</span> <span class="n">anchor</span><span class="p">)</span><span class="o">*</span> <span class="p">,</span> <span class="p">((</span><span class="n">div2</span> <span class="o">|</span> <span class="n">div3</span> <span class="o">|</span>
<span class="n">div4</span><span class="p">)</span><span class="o">+</span> <span class="o">|</span> <span class="p">((</span><span class="n">cit</span> <span class="o">|</span> <span class="n">p</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">note</span> <span class="o">|</span> <span class="n">formula</span> <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">figure</span><span class="p">)</span><span class="o">+</span> <span class="p">,</span> <span class="p">(</span><span class="n">div2</span> <span class="o">|</span>
<span class="n">div3</span> <span class="o">|</span> <span class="n">div4</span><span class="p">)</span><span class="o">*</span><span class="p">))),</span> <span class="n">got</span> <span class="p">(</span><span class="n">head</span> <span class="n">keywords</span><span class="p">)</span>
<span class="o">&lt;/</span><span class="n">keywords</span><span class="o">&gt;&lt;/</span><span class="n">module</span><span class="o">&gt;</span>
                    <span class="o">^</span>
</pre></div>
</div>
</div>
<p>If you say tralics miaou2003 -xmltex, you will see the following.
<strong>Note</strong>: you ask TeX to interpret the XML code, this is much slower
anything else. Timings for apics 2006: Tralics 0.1 s, Latex 0.5s, Pdf
via XML 24s.</p>
<div class="tty-out docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[2]grimm@medee$ tralics miaou2003 -xmltex
This is tralics 2.2, a LaTeX to XML translator
Copyright INRIA/MIAOU/APICS 2002-2004, Jos\&#39;e Grimm
Starting xml processing for miaou2003.
%% as above
Output written on miaou.xml (38393 bytes).
No error found.
(For more information, see transcript file miaou2003.log)
/user/grimm/home/bin/rahandler.pl v2.4, (C) 2004 INRIA, José Grimm, projet APICS
exec-xml for miaou
%% This converts miaou.xml into miaou.fo
xsltproc --catalogs -o miaou.fo /net/home/grimm/cvs/raweb/src/rawebfo.xsl miaou.xml
exit status of makefo is 0
(not done) xsltproc --catalogs  /net/home/grimm/cvs/raweb/src/rawebhtml.xsl miaou.xml
%% Call pdflatex on wmiaou
pdflatex -interaction=nonstopmode wmiaou
This is pdfTeXk, Version 3.14159-1.10b (Web2C 7.4.5)
 %&amp;-line parsing enabled.
(./wmiaou.tex{/usr/local/lib/texmf/pdftex/config/pdftex.cfg}
LaTeX2e &lt;2003/12/01&gt;
Babel &lt;v3.8c&gt;  and hyphenation patterns for english, UKenglish, french, german,
ngerman, italian, spanish, dumylang, nohyphenation, loaded.
(/usr/local/lib/texmf/tex/xmltex/base/xmltex.tex
xmltex version: 2002/06/25 v1.9 (Exp)

Encoding = utf-8 (/usr/local/lib/texmf/tex/xmltex/base/xmltex.cfg)
(./wmiaou.cfg
Loading mathml support and raweb extensions
) (./miaou.fo (/usr/local/lib/texmf/tex/xmltex/passivetex/fotex.xmt)
(/usr/local/lib/texmf/tex/latex/base/article.cls
Document Class: article 2004/02/16 v1.4f Standard LaTeX document class
%% More latex packages
(/usr/local/lib/texmf/tex/latex/hyperref/pd1enc.def) (./hyperref.cfg)
(/usr/local/lib/texmf/tex/latex/hyperref/hpdftex.def) (./fotex.cfg))
No file wmiaou.aux.
No file wmiaou.out.
No file wmiaou.out.
&lt;Logo-INRIA-couleur.pdf, id=7, 411.5375pt x 106.3975pt&gt;
&lt;use Logo-INRIA-couleur.pdf&gt; &lt;LogoRA2003.pdf, id=8, 299.1175pt x 341.275pt&gt;
&lt;use LogoRA2003.pdf&gt;
LaTeX Warning: Reference `uid1&#39; on page 1 undefined on input line 3.
%% More latex warnings

LaTeX Warning: There were undefined references.
LaTeX Warning: Label(s) may have changed.Rerun to get cross-references right.
 ) ) )
(see the transcript file for additional information)
Output written on wmiaou.pdf (14 pages, 137378 bytes).
Transcript written on wmiaou.log.

exit status of pdflatex is 0
%% Second run
pdflatex -interaction=nonstopmode wmiaou
This is pdfTeXk, Version 3.14159-1.10b (Web2C 7.4.5)
 %&amp;-line parsing enabled.
(./wmiaou.tex{/usr/local/lib/texmf/pdftex/config/pdftex.cfg}
%% some messages omitted
[2] [1] [2] [3]
[4 &lt;./xml-route.pdf&gt;] [5] [6] [7] [8] [9] (./wmiaou.aux) ) ) )
(see the transcript file for additional information)&lt;/usr/local/lib/texmf/fonts
/type1/bluesky/cm/cmtt10.pfb&gt;&lt;/usr/local/lib/texmf/fonts/type1/bluesky/cm/cmbx1
0.pfb&gt;&lt;/usr/local/lib/texmf/fonts/type1/bluesky/cm/cmsy7.pfb&gt;&lt;/usr/local/lib/te
xmf/fonts/type1/bluesky/cm/cmr5.pfb&gt;&lt;/usr/local/lib/texmf/fonts/type1/bluesky/c
m/cmex10.pfb&gt;&lt;/usr/local/lib/texmf/fonts/type1/bluesky/symbols/msbm7.pfb&gt;&lt;/usr/
local/lib/texmf/fonts/type1/bluesky/cm/cmr7.pfb&gt;&lt;/usr/local/lib/texmf/fonts/typ
e1/bluesky/cm/cmmi5.pfb&gt;&lt;/usr/local/lib/texmf/fonts/type1/bluesky/symbols/msbm1
0.pfb&gt;&lt;/usr/local/lib/texmf/fonts/type1/bluesky/cm/cmmi7.pfb&gt;&lt;/usr/local/lib/te
xmf/fonts/type1/bluesky/cm/cmr10.pfb&gt;&lt;/usr/local/lib/texmf/fonts/type1/bluesky/
cm/cmmi10.pfb&gt;&lt;/usr/local/lib/texmf/fonts/type1/bluesky/cm/cmsy10.pfb&gt;{/usr/loc
al/lib/texmf/dvips/base/8r.enc}
Output written on wmiaou.pdf (14 pages, 152502 bytes).
Transcript written on wmiaou.log.
exit status of pdflatex is 0
(not done) xmllint --catalogs --valid  --noout miaou.xml
(Transcript written on miaou.rh.log)
done
</pre></div>
</div>
</div>
<p>The pdf is <a class="reference download internal" download="" href="_downloads/ba863b8fefcad0ae1133433ab48dc05c/wmiaou.pdf"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>. It is named wmiaou.pdf, a name
that does not conflict with the names miaou2003.ps and miaou.ps. Running
<em>Tralics</em> ten times in a row give the following size for the Pdf file: 152499
152499 152500 152500 152500 152500 152497 152497 152497 152497. Strange, isn’t
it?</p>
</section>
</section>
<section id="the-auxiliary-perl-script">
<span id="script0"></span><h2>4. The auxiliary perl script<a class="headerlink" href="#the-auxiliary-perl-script" title="Link to this heading"></a></h2>
<p>Before 2008, an auxiliary Perl script was used for the Raweb.The behavior of
<em>Tralics</em> is not the same in Raweb mode or in normal mode. Raweb mode if entered
if the document type (deduced from the options, the configuration file, and the
document) is <code class="docutils literal notranslate"><span class="pre">RA</span></code> (or <code class="docutils literal notranslate"><span class="pre">ra</span></code>). In the case, the file name should be
apics2006.tex, and the document class should be <code class="docutils literal notranslate"><span class="pre">ra2006</span></code> (the year can be
replaced by 2004, etc, provided that it is the same). If an XML file is created,
it will be apics.xml and the year will be an attribute of the document element.
If a TeX file is created, it will be named apics.tex, and it will use the
<code class="docutils literal notranslate"><span class="pre">raweb</span></code> documentclass.</p>
<ul class="simple">
<li><p>If you say tralics apics2006 -check, the software will read your
file, analyze it and, that’s all (the transcript file is
apics2006.log).</p></li>
<li><p>If you say tralics apics2006 -ps, the software will read your file,
analyze it, create a new TeX file, and use an external program to
compile it; communication is via a file named user_param.pl. The file
apics.rh.log will hold the logs of all the external programs
(apics2006.log is the transcript file of <em>Tralics</em>, apics.log the
transcript file of LaTeX).</p></li>
<li><p>If you say tralics apics2006, the software will read your file,
analyze it, and translate it. It will call the external program, but
nothing will happen.</p></li>
<li><p>If you say tralics apics2006 -xmlall (or some other options) the
software will read your file, analyze it, and translate it. It will
call the external program, that will convert the XML file. As above,
communication is via user_param.pl, transcript in apics.rh.log.</p></li>
</ul>
<p>The auxiliary script starts like this</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>
<span class="c1"># additional header info here</span>
<span class="nb">print</span> <span class="s2">&quot;(C) 2004 2006 INRIA, Jos</span><span class="se">\\</span><span class="s2">&#39;e Grimm, Team Apics</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<p>All variables used by the program can be redefined by the `require’ at
the end of the file. If <code class="docutils literal notranslate"><span class="pre">todo_ps</span></code> is true (non-zero), then you want a
preview (conversion from latex to dvi and Postscript). Otherwise, if
<code class="docutils literal notranslate"><span class="pre">todo_xml</span></code> is true, you want conversion from latex to XML; this is
done by <em>Tralics</em>. The post-processor allows you to check the XML (if
<code class="docutils literal notranslate"><span class="pre">todo_lint</span></code> is true), convert it to HTML (if <code class="docutils literal notranslate"><span class="pre">todo_html</span></code> is true),
to XMLFO (if <code class="docutils literal notranslate"><span class="pre">todo_fo</span></code> is true), and to Pdf or Postscript (if
<code class="docutils literal notranslate"><span class="pre">todo_tex</span></code> is true). The variables are initialized like this.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$::todo_fo = 1;
$::todo_html = 1;
$::todo_tex = 1;
$::todo_lint = 1;
$::todo_ps = 0;
$::todo_xml = 1;
</pre></div>
</div>
</div>
<p>If you run <em>Tralics</em> on the file apics2006.tex, the preview will be in
the file apics.tex (from the variable <code class="docutils literal notranslate"><span class="pre">tex_file</span></code>), while the XML file
will be apics.xml (from the variable <code class="docutils literal notranslate"><span class="pre">no_year</span></code>). And the year is 2006.
Other variable contain a percent sign. Make sure that Perl does not
interpret them as a hash reference, since we will modify them later.
(<a class="reference external" href="#percent">explanations here</a>).</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Predeclare all variables here.
$::tralics_dir= &quot;/user/grimm/home/cvs/tralics&quot;;
$::ra_year = &quot;2006&quot;;
$::tex_file = &quot;miaou&quot;;
$::no_year = &quot;miaou&quot;;
$::generate_dvi = q/latex -interaction=nonstopmode %t/;
$::generate_ps = q/dvips %t.dvi -o %t.ps/;
$::makefo = &#39;xsltproc --catalogs -o %A.fo %B %C&#39;;
$::makehtml =&#39;xsltproc --catalogs  %B %C&#39;;
$::makepdf = &#39;pdflatex -interaction=nonstopmode %w&#39;;
$::makedvi = &#39;latex -interaction=nonstopmode %w&#39;;
$::dvitops = &#39;dvips %w.dvi -o %w.ps&#39;;
$::checkxml = &#39;xmllint --catalogs --valid  --noout %C&#39;;

$::dtd_file = &quot;raweb3.dtd&quot;; # New in 2004.
</pre></div>
</div>
</div>
<p>The variables shown above are overwritten by the content of the
user_param.pl, an example is <a class="reference external" href="raweb4.html#user-param">given here</a>. In
particuler, the user-param file must give the name of the TeX file, and
<code class="docutils literal notranslate"><span class="pre">tralics_dir</span></code>, the location where additional files are located.</p>
<section id="postscript-mode">
<h3>4.1 Postscript mode<a class="headerlink" href="#postscript-mode" title="Link to this heading"></a></h3>
<p>The objective is easy to understand: we have to call latex three times,
then dvips; after the first call, we execute bibtex. Three auxiliary
file are needed for bibtex: one is created by the footbib package, and
one by the script. The last one is standard.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub copy_and_exec {
  print &quot;copy-and-exec for $::tex_file\n&quot;;
  link_some_files();
  open OUTFILE, &quot;&gt;$::no_year.refer.aux&quot;;
  print OUTFILE &quot;\\bibstyle{rawebnum}\n&quot;;
  print OUTFILE &quot;\\citation{*}\n&quot;;
  print OUTFILE &quot;\\bibdata{$::no_year&quot; . &quot;_refer&quot; . $::ra_year . &quot;}\n&quot;;
  close OUTFILE;
  open LOGFILE, &quot;&gt;$::no_year.rh.log&quot;;
  call_latex();
  call_bibtex (&quot;&quot;,&quot;&quot;);
  call_bibtex (&quot;.refer&quot;,&quot;_refer&quot;);
  call_bibtex (&quot;.fb&quot;,&quot;_foot&quot;);
  call_latex();
  call_latex();
  interpret_and_launch($::generate_ps,&quot;junk&quot;,1,&quot;dvips&quot;,&quot;&quot;);
  close LOGFILE;
  print &quot;(Transcript written on $::no_year.rh.log)\n&quot;;
  print &quot;done\n&quot;;
}
</pre></div>
</div>
</div>
<p>This is an auxiliary routine that takes 5 arguments. The first one is a
string to be evaluated (as explained below), it comes from the
configuration file; the second argument is either `junk’, or the name
of a xslt file, it can be used by the evaluator of the argument. Then
comes a boolean, if false nothing is done. Argument number four is a
symbolic name of the command, and if the last argument is true, the
command is executed twice.</p>
<p>If you do not want to generate PS, just put the empty string in
<code class="docutils literal notranslate"><span class="pre">$::generate_ps</span></code>, because here, nothing is done if <code class="docutils literal notranslate"><span class="pre">$template</span></code> is
empty.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub interpret_and_launch {
  my ($template,$aux,$tr,$name,$twice) = @_;
  $_ = $template;
  return unless $_;
  interpret_str($aux);
  launch_cmd($_,$tr,$name);
  launch_cmd($_,$tr,$name) if $twice;
}
</pre></div>
</div>
</div>
<p>This launches latex.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub call_latex {
  interpret_and_launch($::generate_dvi,&quot;junk&quot;,1,&quot;latex&quot;,0);
  copy_to_log(&quot;$::no_year.log&quot;);
}
</pre></div>
</div>
</div>
<p>This launches bibtex. We do not use the <code class="docutils literal notranslate"><span class="pre">interpret_str</span></code> subroutine (if
your executable is called BibTex, just edit the Perl script). There are
three bibtex files, apics2006.bib, apics_foot2006.bib and
apics_refer2006.bib. The procedure gets `apics’ from <code class="docutils literal notranslate"><span class="pre">$::no_year</span></code>,
the `2006’ from <code class="docutils literal notranslate"><span class="pre">$::ra_year</span></code>, and what is between as second argument.
The bibliography files are optional, so nothing is done in case the
files do not exist. On the other hand, the auxiliary files have the same
name as in section 3.1, without the year. For instance, it would be
apics.fb.aux. The quantity between `apics’ and `aux’ is the first
argument.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub call_bibtex {
  my ($exta, $extb) = @_;
  my ($bib);
  $bib = &quot;$::no_year$extb$::ra_year.bib&quot;;
  return unless -f $bib;
  $_ = $::no_year . $exta;
  print &quot;bibtex -min-crossrefs=1000 $_\n&quot;;
  print LOGFILE &quot;result of bibtex $_\n&quot;;
  `bibtex -min-crossrefs=1000 $_`;
  print &quot;bibtex exit status $?\n&quot;;
  print LOGFILE &quot;bibtex exit status $?\n&quot;;
  copy_to_log(&quot;$_.blg&quot;);
}
</pre></div>
</div>
</div>
<p>This allows us to merge the transcript files of the different processes.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub copy_to_log  {
  my($file) = @_;
  open(INPUT,&quot;&lt;$file&quot;);
  while (&lt;INPUT&gt;) {
    print LOGFILE;
  };
  close INPUT;
}
</pre></div>
</div>
</div>
<p>This executes the first argument if the second is true. Everything
printed on the screen is also copied in the transcript file. Note: <em>this
means that all messages of LaTeX are stored in a buffer and printed at
end of job</em>. Said otherwise, in case of trouble, you will see the error
messages only after you abort the job.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub launch_cmd {
  my ($cmd,$test,$name) = @_;
  if(! $test) {
    print LOGFILE &quot;(not done) $cmd\n&quot;;
    print  &quot;(not done) $cmd\n&quot;;
    return;
  }
  print LOGFILE &quot;$cmd\n&quot;;
  print &quot;$cmd\n&quot;;
  print LOGFILE &quot;-------------------------\nStart trace of $name\n&quot;;
  my $value;
  $value = `$cmd`;
  print LOGFILE $value;
  print $value;
  print LOGFILE &quot;End trace of $name\n-------------------------\n&quot;;
  print LOGFILE &quot;exit status of $name is $?\n&quot;;
  print &quot;exit status of $name is $?\n&quot;;
}
</pre></div>
</div>
</div>
<p>The raweb directory of <em>Tralics</em> contains a lot of useful files. What we
do here is to put a symbolic link for the following files: the three bst
files, the class file, and the two logos (in PostScript and Pdf form).</p>
<p>Todo. Some files depend on the year, and other do not. In particular,
raweb.cls and raweb.bst depend on the year. The class file contains the
current year for headings, name of logo, name of foot bibliography, the
bst file output warnings in case of a bad year. The name `raweb.bst’
comes from the class file, this is easy to change, but the name of the
document class is generated by Tralics.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub link_some_files {
  link_src (&quot;rawebalpha.bst&quot;);
  link_src (&quot;raweb.bst&quot;);
  link_src (&quot;rawebnum.bst&quot;);
  link_src (&quot;raweb.cls&quot;);
  link_src (&quot;Logo-INRIA-couleur.pdf&quot;);
  link_src (&quot;Logo-INRIA-couleur.ps&quot;);
  link_src (&quot;LogoRA&quot; . $::ra_year . &quot;.eps&quot;);
  link_src (&quot;LogoRA&quot; . $::ra_year . &quot;.pdf&quot;);
}
</pre></div>
</div>
</div>
<p>This takes three arguments, A, B and C. The effect is to make a symbolic
link from file A in the source directory, in the directory B, to file C.
Nothing is done if the target exists, or if the source does not exists.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub link_file {
   my($in,$out,$short_in);
   $in = @_[0]; $out = @_[1]; $short_in = @_[2];
   $in = &quot;$::raweb_dir/$in&quot;;
   `ln -s $in $out` if (-f $in &amp;&amp; !-f &quot;$out/$short_in&quot;);
}
</pre></div>
</div>
</div>
<p>Same as above, but B (the directory in which is put the link) is the
current directory.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub link_src {
   my($in,$out,$short_in);
   $short_in =@_[0];
    $in = &quot;$::tralics_dir/raweb/$short_in&quot;;
   `ln -s $in` if (-f $in &amp;&amp; !-f &quot;$short_in&quot;);
}
</pre></div>
</div>
</div>
<p>Some other files come from the xml directory of <em>Tralics</em>, and neeed a
different function.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub link_xml {
   my($in,$out,$short_in);
   $short_in =@_[0];
   $in = &quot;$::tralics_dir/xml/$short_in&quot;;
   `ln -s $in` if (-f $in &amp;&amp; !-f &quot;$short_in&quot;);
}
</pre></div>
</div>
</div>
</section>
<section id="xml-mode">
<h3>4.2 XML mode<a class="headerlink" href="#xml-mode" title="Link to this heading"></a></h3>
<p>This is done in XML mode. Note that <em>Tralics</em> creates a file named
_hyperref.cfg that contains useful information. On the other hand, the
hyperref.cfg file is used by the hyperref package. For this reason, we
are a bit careful, when copying.</p>
<p>The script constructs also a TeX file, that reads the XML file (value of
<code class="docutils literal notranslate"><span class="pre">\xmlfile</span></code>). This file loads the xmltex.tex package (by Carlisle)
explicitly, and the fotex.xmt (by Rahtz) implicitly, according to some
obscure rules. There are some scheduling problems; as a consequence, the
file wapics.cfg loads the MathML stuff. The fotex.cfg file is loaded
much too late (it is needed however, since it explains how to insert the
Logo on the front page).</p>
<p>After these files are created, all the shell scripts are run.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub exec_xml {
  if(!($::todo_html || $::todo_fo || $::todo_tex || $::todo_lint) ) {
    print &quot;Postprocessor did nothing\n&quot;;
    return;
  }
  print &quot;exec-xml for $::tex_file\n&quot;;
  link_xml_files();# links files, for instance fotex.cfg
  make_icons();# for HTML
  if(-f &quot;_hyperref.cfg&quot;) { # keywords and such
    `rm hyperref.cfg`  if(-f &quot;hyperref.cfg&quot;);
    `mv _hyperref.cfg hyperref.cfg`;
  }
  my $name1 = &quot;w&quot; . $::no_year . &quot;.cfg&quot;;
  my $name2 = $::tralics_dir . &quot;raweb-cfg.sty&quot;;
  `rm $name1` if -f $name1;
  `ln -s $name2 $name1` if -f $name2;
  make_catalog();
  open OUTFILE, &quot;&gt;w$::no_year.tex&quot;;
  print OUTFILE &quot;\\def\\xmlfile{$::no_year.fo}\n&quot;;
  print OUTFILE &quot;\\def\\LastDeclaredEncoding{T1}\n&quot;;
  print OUTFILE &quot;\\input{xmltex.tex}\n&quot;;
  print OUTFILE &quot;\\end{document}\n&quot;;
  close OUTFILE;

  open LOGFILE, &quot;&gt;$::no_year.rh.log&quot;;
  if($::todo_html) {
    `rm -rf $::no_year$::ra_year`;   # a bit aggressive? ;
    `mkdir $::no_year$::ra_year`;
  }
  interpret_and_launch($::makefo,&quot;raweb3fo&quot;, $::todo_fo,&quot;makefo&quot;,0);
  interpret_and_launch($::makehtml,&quot;rawebhtml&quot;, $::todo_html,&quot;makehtml&quot;,0);
  interpret_and_launch($::makepdf,&quot;junk&quot;, $::todo_tex,&quot;pdflatex&quot;,1);
  interpret_and_launch($::makedvi,&quot;junk&quot;, $::todo_tex,&quot;latex&quot;,1);
  interpret_and_launch($::dvitops,&quot;junk&quot;, $::todo_tex,&quot;dvips&quot;,0);
  interpret_and_launch($::checkxml,&quot;junk&quot;, $::todo_lint,&quot;lint&quot;,0);
  close LOGFILE;
  print &quot;(Transcript written on $::no_year.rh.log)\n&quot;;
  print &quot;done\n&quot;;
}
</pre></div>
</div>
</div>
<p>Obtaining the Pdf from the XML requires the same logos. It also needs a
hook: this is fotex.cfg. We also make sure that the DTD is visible.
Maybe, we should have a raweb2004.dtd ?</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub link_xml_files {
  link_xml ($::dtd_file);
  link_xml (&quot;fotex.cfg&quot;);
  link_xml (&quot;fotex.sty&quot;);
  link_xml (&quot;fotex.sty&quot;);
  link_xml (&quot;raweb-uni.sty&quot;);
  link_xml (&quot;fotex-add.sty&quot;);
  link_src (&quot;Logo-INRIA-couleur.pdf&quot;);
  link_src (&quot;Logo-INRIA-couleur.ps&quot;);
  link_src (&quot;LogoRA&quot; . $::ra_year . &quot;.eps&quot;);
  link_src (&quot;LogoRA&quot; . $::ra_year . &quot;.pdf&quot;);
}
</pre></div>
</div>
</div>
<p>This routine creates a icons directory and links some files. The names
of the icons that are needed can be found in the different styles
sheets. Note that the HTML files are put in a directory below the
current directory, so that it accesses them via ../icons/xx.png. As a
result, if you call the script with different teams, the icons directory
will be shared. This is only useful if you generate HTML.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub make_icons {
  `mkdir icons` unless -d &quot;icons&quot;;
  link_file (&quot;icons/contents_motif.png&quot;, &quot;icons&quot;, &quot;contents_motif.png&quot;);
  # more lines omitted
}
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">make_catalog</span></code> routine copies the file catalog.src (found in the
source directory) into the file named catalog. However, it does not
overwrite it. The string <code class="docutils literal notranslate"><span class="pre">source_directory</span></code> is replaced by the source
directory (check for <code class="docutils literal notranslate"><span class="pre">$ENV</span></code> at the end of the script).</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub make_catalog {
  return if -f &quot;catalog&quot;;
  my $src_name = $::tralics_dir . &quot;catalog.src&quot;;
  open(INPUT,&quot;&lt;$src_name&quot;);
  my(@file_string);
  while (&lt;INPUT&gt;) {
    push(@file_string, $_ );
  };
  $_ = join(&#39;&#39;,@file_string);
  return unless $_;
  s!source_directory/dtd/!$::tralics_dir/xml/!g;
  s!source_directory/xml/!$::tralics_dir/xml/!g;
  open OUTFILE, &quot;&gt;catalog&quot;;
  print OUTFILE;
  close OUTFILE;
}
</pre></div>
</div>
</div>
<p>This is a very complicated procedure, whose purpose is to produce a file
with the following two lines</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PUBLIC</span> <span class="s2">&quot;mathml&quot;</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">grimm</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cvs</span><span class="o">/</span><span class="n">tralics</span><span class="o">/</span><span class="n">xml</span><span class="o">/</span><span class="n">mathml2</span><span class="o">/</span><span class="n">mathml2</span><span class="o">.</span><span class="n">dtd</span>
<span class="n">PUBLIC</span> <span class="s2">&quot;teixlite&quot;</span> <span class="s2">&quot;/user/grimm/home/cvs/tralics/xml/teixlite.dtd&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="evaluation-of-parameters">
<h3>4.3 Evaluation of parameters<a class="headerlink" href="#evaluation-of-parameters" title="Link to this heading"></a></h3>
<p>We have seen that the configuration file of <em>Tralics</em> contains lines
like: <code class="docutils literal notranslate"><span class="pre">makefo=&quot;xsltproc</span> <span class="pre">--catalogs</span> <span class="pre">-o</span> <span class="pre">%A.fo</span> <span class="pre">%B</span> <span class="pre">%C&quot;;</span></code>. These lines are
copied verbatim in the user_param.pl file (with single quotes instead of
double quotes). The lines are evaluated according to the following rules</p>
<ul class="simple">
<li><p>%A and %a are replaced by `apics’ (the name of the team),</p></li>
<li><p>%B and %b are replaced by the value of the argument (in the source
directory), with, or without the <code class="docutils literal notranslate"><span class="pre">.xsl</span></code> extension.</p></li>
<li><p>%C and %c are replaced by `apics’ (the name of the team), with and
without the <code class="docutils literal notranslate"><span class="pre">.xml</span></code> suffix,</p></li>
<li><p>%W and %w are replaced by `wapics’ (team name, with an initial w),
with and without the <code class="docutils literal notranslate"><span class="pre">.tex</span></code> suffix,</p></li>
<li><p>%T and %t are replaced by `apics’ (alternate team name) with and
without the <code class="docutils literal notranslate"><span class="pre">.tex</span></code> suffix.</p></li>
</ul>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sub interpret_str {
  my $B = @_[0];
  my ($Y,$S,$P) = ($::no_year,$::raweb_dir_src,$::tex_file);
  # hack here in case replacement contains %
  s/%A/$Y/g;
  s/%a/$Y/g;
  s/%B/$S$B.xsl/g;
  s/%b/$S$B/g;
  s/%C/$Y.xml/g;
  s/%c/$Y/g;
  s/%W/w$Y.tex/g;
  s/%w/w$Y/g;
  s/%T/$P.tex/g;
  s/%t/$P/g;
}
</pre></div>
</div>
</div>
</section>
<section id="end-of-rahandler-pl">
<h3>4.4 End of rahandler.pl<a class="headerlink" href="#end-of-rahandler-pl" title="Link to this heading"></a></h3>
<p>The rahandler.pl file contains all variables and procedures shown above,
maybe in a different order. The action of the script is given here. This
read the user parameters (created by Tralics, possibly modified by the
user). Since the file is read by `require’ it should terminate with
something that does not evaluate to zero.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">require</span> <span class="s2">&quot;user_param.pl&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<p>It is important to export the catalog. It is also important to export
the <code class="docutils literal notranslate"><span class="pre">TEXMFCNF</span></code> variable. For security reasons, it is better not to put
this in the current directory. On the other hand, you need a huge
pdflatex when reading XML.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ENV{SGML_CATALOG_FILES}= &quot;./catalog&quot;;
$ENV{TEXMFCNF} = &quot;$::tralics_dir&quot; . &quot;/xml:&quot;
   . ( defined($ENV{TEXMFCNF}) ? &quot;$ENV{TEXMFCNF}&quot; : &quot;&quot;);
</pre></div>
</div>
</div>
<p>Action.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if($::todo_ps) { copy_and_exec(); }
elsif ($::todo_xml) { exec_xml(); }
</pre></div>
</div>
</div>
</section>
</section>
<section id="the-raweb-cfg-sty-file">
<span id="fotex"></span><h2>5. The raweb-cfg.sty file<a class="headerlink" href="#the-raweb-cfg-sty-file" title="Link to this heading"></a></h2>
<p>The pdf files of the activity report are produced via a Makefile as
follows. The TeX source is converted by <em>Tralics</em> into some XML file; an
XML processor converts this into another XML file, conforming to the new
DTD (whatever this means). Another XML processor converts the result
into XSL/FO format, which is interpreted by TeX via the tools of S.
Rahtz and D. Carlisle.</p>
<section id="details">
<h3>5.1 Details<a class="headerlink" href="#details" title="Link to this heading"></a></h3>
<p>Some patches to these files are required. We explain here the content of the
file raweb-cfg.sty. It starts like this.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">makeatletter</span>
\<span class="n">immediate</span>\<span class="n">write20</span><span class="p">{</span><span class="n">Loading</span> <span class="n">mathml</span> <span class="n">support</span> <span class="ow">and</span> <span class="n">raweb</span> <span class="n">extensions</span><span class="p">}</span>
<span class="o">%</span> <span class="n">patch</span> <span class="n">of</span> <span class="n">xmltex</span><span class="o">.</span><span class="n">tex</span>
</pre></div>
</div>
</div>
<p>There are some lines that try to solve the problem: how to put an &amp;
character in an URL, i.e. in an attribute. See
<a class="reference external" href="raweb3.html#ampersand">here</a>.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">\utfeight&#64;protect&#64;internal</span></code> redefines, among other, the
command <code class="docutils literal notranslate"><span class="pre">\utfeightaz</span></code> as
<code class="docutils literal notranslate"><span class="pre">\def\utfeightaz</span> <span class="pre">{\noexpand</span> <span class="pre">\utfeightaz</span> <span class="pre">\noexpand}</span></code>. A more efficient
code would be: <code class="docutils literal notranslate"><span class="pre">\let</span> <span class="pre">\utfeightaz</span> <span class="pre">\utfeightaz&#64;jg&#64;int</span></code>. See
<a class="reference external" href="raweb3.html#added-cmds">here</a> the definition of
<code class="docutils literal notranslate"><span class="pre">\utfeightaz&#64;jg&#64;int</span></code> and the like.</p>
<p>We redefine <code class="docutils literal notranslate"><span class="pre">\utfeight&#64;protect&#64;internal</span></code> and
<code class="docutils literal notranslate"><span class="pre">\utfeight&#64;protect&#64;chars</span></code>. Code is given
<a class="reference external" href="raweb3.html#modified-cmds">here</a>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\def\utfeight@protect@chars{ source code shown here }
\begingroup
\catcode`&lt;\active
\catcode`&amp;\active
\gdef\utfeight@protect@internal{ source code shown here}
</pre></div>
</div>
</div>
</section>
<section id="ampersands-in-url">
<h3>5.2 Ampersands in URL<a class="headerlink" href="#ampersands-in-url" title="Link to this heading"></a></h3>
<p>The problem is that the fotex.fmt file has a declaration like this
<code class="docutils literal notranslate"><span class="pre">\XMLnamespaceattributeX</span> <span class="pre">{fo}</span> <span class="pre">{external-destination}</span> <span class="pre">{\FOexternaldestination}</span> <span class="pre">{}</span></code>.
As a result, the property list of the `fo’ namespace will contain
(among others) the following tokens
<code class="docutils literal notranslate"><span class="pre">\XML&#64;attrib</span>&#160; <span class="pre">0:external-destination\relax</span> <span class="pre">\FOexternaldestination</span> <span class="pre">{}\utfeight&#64;chardef</span>&#160; <span class="pre">\FOexternaldestination</span></code>.
In some places, <code class="docutils literal notranslate"><span class="pre">\XMLattributeX</span></code> is called: this defines an attribute
for a single element. In both cases, the X means: call
<code class="docutils literal notranslate"><span class="pre">\utfeight&#64;chardef</span></code>, and these are the only cases where the macro is
used. The X is for `expand’; the trouble is that entities cannot be
expanded, and we need a way to inhibit this expansion.</p>
<p>We redefine <code class="docutils literal notranslate"><span class="pre">\utfeight&#64;chardef</span></code> with a little hack for the &amp;
character, as follows. Normally, ampersand is the same as
<code class="docutils literal notranslate"><span class="pre">\XML&#64;amp&#64;markup</span></code>. We change its value locally. Thus, we change the
behavior only inside some attributes.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">gdef</span>\<span class="n">utfeight</span><span class="nd">@chardef</span><span class="c1">#1{%</span>
  \<span class="n">begingroup</span>
  \<span class="n">utfeight</span><span class="nd">@protect@chars</span>
  \<span class="n">let</span><span class="o">&amp;</span>\<span class="n">XML</span><span class="nd">@amp@markup@jg</span>  <span class="o">%</span> <span class="n">line</span> <span class="n">added</span>
  \<span class="n">xdef</span>\<span class="n">x</span><span class="nd">@temp</span><span class="p">{</span><span class="c1">#1}%</span>
  \<span class="n">endgroup</span>
  \<span class="n">let</span><span class="c1">#1\x@temp}</span>
</pre></div>
</div>
</div>
<p>Original code was complicated. What we do here is just test if the
argument is `amp;’ and replace it with an ampersand. We test the value
of the argument by adding `amp;’ and we look for the string.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">XML</span><span class="nd">@amp@markup@jg</span><span class="c1">#1;{%</span>
  \<span class="n">XML</span><span class="nd">@amp@markup@jgw</span><span class="c1">#1;amp;\@nil}</span>
\<span class="n">def</span>\<span class="n">XML</span><span class="nd">@amp@markup@jgw</span><span class="c1">#1amp;#2\@nil{%</span>
  \<span class="n">ifx</span> <span class="n">b</span><span class="c1">#2b \XML@amp@markup#1;\else\string&amp;\fi}</span>
</pre></div>
</div>
</div>
</section>
<section id="mathml">
<h3>5.3 MathML<a class="headerlink" href="#mathml" title="Link to this heading"></a></h3>
<p>Here we redefine a lot of MathML functions from mathml2.xmt, and add a
great number of other procedures.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% Is this needed ? we redefine everything here
%\inputonce{mathml2.xmt}
% We do not want mathml to be loaded after this file
\global\expandafter\let\csname xmt:mathml2.xmt\endcsname\@ne
</pre></div>
</div>
</div>
<p>This declares the three namespaces that will be used later in this file.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">DeclareNamespace</span><span class="p">{</span><span class="n">m</span><span class="p">}{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">w3</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">1998</span><span class="o">/</span><span class="n">Math</span><span class="o">/</span><span class="n">MathML</span><span class="p">}</span>
\<span class="n">DeclareNamespace</span><span class="p">{</span><span class="n">fotex</span><span class="p">}{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">tug</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">fotex</span><span class="p">}</span>
\<span class="n">DeclareNamespace</span><span class="p">{</span><span class="n">fo</span><span class="p">}{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">w3</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">1999</span><span class="o">/</span><span class="n">XSL</span><span class="o">/</span><span class="n">Format</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>We declare <a class="reference external" href="raweb3.html#string-decls1">here</a> and
<a class="reference external" href="raweb3.html#string-decls2">here</a> some strings via commands of the
form <code class="docutils literal notranslate"><span class="pre">\XMLstring\att&#64;true&lt;&gt;true&lt;/&gt;</span></code>. After that, we can test that an
attribute is true with a test like <code class="docutils literal notranslate"><span class="pre">\ifx\foo\att&#64;true</span></code>. Some strings
are prefixed by `jg’ others by `att’.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\global\delcode`{&quot;66308
\global\delcode`}&quot;67309

% We have to redefine some operators...
\def\jg@tilde@acc{\mathaccent&quot;707E }
\def\jg@check@acc{\mathaccent&quot;7014 }
\def\jg@breve@acc{\mathaccent&quot;7015 }
\def\jg@hat@acc{\mathaccent&quot;705E }
\def\jg@dot@acc{\mathaccent&quot;705F }
\def\jg@ddot@acc{\mathaccent&quot;707F }
\def\jg@grave@acc{\mathaccent&quot;7012 }
\def\jg@ring@acc{\protect \mathaccentV {mathring}017 }
\def\jg@overRarrow@acc{\let\rightarrow\JGG@orig@rarrow\mathpalette{\overarrow@\rightarrowfill@}}
\def\jg@overLarrow@acc{\let\leftarrow\JGG@orig@larrow\mathpalette{\overarrow@\leftarrowfill@}}
\def\jg@underRarrow@acc{\let\rightarrow\JGG@orig@rarrow\mathpalette{\underarrow@\rightarrowfill@}}
\def\jg@underLarrow@acc{\let\leftarrow\JGG@orig@larrow\mathpalette{\underarrow@\leftarrowfill@}}
</pre></div>
</div>
</div>
<p>This makes the underscore character produce an underscore.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">expandafter</span>\<span class="n">def</span>\<span class="n">csname</span> <span class="mi">8</span><span class="p">:</span><span class="n">_</span>\<span class="n">endcsname</span><span class="p">{</span><span class="o">%</span>
 \<span class="n">relax</span>\<span class="n">ifmmode</span>\<span class="n">hbox</span><span class="p">{</span>\<span class="n">textunderscore</span><span class="p">}</span>\<span class="k">else</span> \<span class="n">textunderscore</span>\<span class="n">fi</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>This defines the behavior of the <code class="docutils literal notranslate"><span class="pre">&lt;math&gt;</span></code> element. Note. Our style
sheet puts display math elements into <code class="docutils literal notranslate"><span class="pre">&lt;fotex:displaymath&gt;</span></code> elements,
whose translation is a <code class="docutils literal notranslate"><span class="pre">displaymath</span></code> environment. As a result,
<code class="docutils literal notranslate"><span class="pre">\GATHER</span></code> could be undefined…</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">math</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">display</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@mathmlmode</span><span class="p">}{</span><span class="n">foo</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">def</span>\<span class="n">GATHER</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">%</span>
     \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mathmlmode</span>\<span class="n">att</span><span class="nd">@BLOCK</span>\<span class="p">[</span>\<span class="k">else</span>\<span class="p">(</span>\<span class="n">fi</span>
   <span class="p">}</span>
  <span class="p">{</span>
     \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mathmlmode</span>\<span class="n">att</span><span class="nd">@BLOCK</span>\<span class="p">]</span>\<span class="k">else</span>\<span class="p">)</span>\<span class="n">fi</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<p>This implements <code class="docutils literal notranslate"><span class="pre">&lt;mover&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;munder&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;munderover&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;mfrac&gt;</span></code>. Actual code is elsewhere. <em>Tralics</em> does not use
<code class="docutils literal notranslate"><span class="pre">&lt;munderover&gt;</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mover</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">accent</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@overaccent</span><span class="p">}{</span><span class="n">none</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmltextwochildren</span>\<span class="n">xml</span><span class="nd">@implement@over</span><span class="p">{}</span><span class="c1">#1}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">munder</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">accentunder</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@underaccent</span><span class="p">}{</span><span class="n">none</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmltextwochildren</span>\<span class="n">xml</span><span class="nd">@implement@under</span><span class="p">{}</span><span class="c1">#1}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">munderover</span><span class="p">}</span>
  <span class="p">{</span> <span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmltexthreechildren</span>\<span class="nd">@firstofone</span>\<span class="n">sb</span>\<span class="n">sp</span><span class="c1">#1}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mfrac</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">linethickness</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@linethickness</span><span class="p">}{</span><span class="n">true</span><span class="p">}</span><span class="o">%</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">numalign</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@numalign</span><span class="p">}{</span><span class="n">center</span><span class="p">}</span><span class="o">%</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">denomalign</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@denomalign</span><span class="p">}{</span><span class="n">center</span><span class="p">}</span><span class="o">%</span>
  <span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmltextwochildren</span>\<span class="n">xml</span><span class="nd">@implement@frac</span><span class="p">{}</span><span class="c1">#1}</span>
</pre></div>
</div>
</div>
<p>This implements the <code class="docutils literal notranslate"><span class="pre">&lt;mo&gt;</span></code> element. In the special case of
<code class="docutils literal notranslate"><span class="pre">&lt;mo</span> <span class="pre">form=&quot;prefix&quot;&gt;ln&lt;/mo&gt;</span></code> or
<code class="docutils literal notranslate"><span class="pre">&lt;mo</span> <span class="pre">movablelimits=&quot;true&quot;</span> <span class="pre">form=&quot;prefix&quot;&gt;lim&lt;/mo&gt;</span></code> we use an upright
font, and <code class="docutils literal notranslate"><span class="pre">\limits</span></code> or <code class="docutils literal notranslate"><span class="pre">\nolimits</span></code>. General case is handled below.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mo</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">form</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@mathmlform</span><span class="p">}{</span><span class="n">inline</span><span class="p">}</span><span class="o">%</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">movablelimits</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@movablelimits</span><span class="p">}{</span><span class="n">false</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mathmlform</span>\<span class="n">att</span><span class="nd">@PREFIX</span>
     \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@movablelimits</span>\<span class="n">att</span><span class="nd">@true</span>
       \<span class="n">mathop</span><span class="p">{</span>\<span class="n">operator</span><span class="nd">@font</span> <span class="c1">#1}\limits</span>
     \<span class="k">else</span>
       \<span class="n">mathop</span><span class="p">{</span>\<span class="n">operator</span><span class="nd">@font</span> <span class="c1">#1}\nolimits</span>
     \<span class="n">fi</span>
   \<span class="k">else</span>\<span class="n">special</span><span class="nd">@mo</span><span class="p">{</span><span class="c1">#1}\fi</span>
   <span class="p">}</span>
</pre></div>
</div>
</div>
<p>When you say <code class="docutils literal notranslate"><span class="pre">$\bar</span> <span class="pre">x$</span></code>, the MathML equivalent is
<code class="docutils literal notranslate"><span class="pre">&lt;mover</span> <span class="pre">accent=&quot;true&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;</span>&#160; <span class="pre">&lt;mo&gt;&amp;#xAF;&lt;/mo&gt;&lt;/mover&gt;</span></code>. When we
see the <code class="docutils literal notranslate"><span class="pre">&lt;mo&gt;</span></code> element, we know that it is an accent because
<code class="docutils literal notranslate"><span class="pre">\notinover</span></code> is no <code class="docutils literal notranslate"><span class="pre">\relax</span></code>. In this case, we have to do something
special with the content. In some cases, we put the content in
<code class="docutils literal notranslate"><span class="pre">\cur&#64;mo&#64;content</span></code>, in other cases, we set <code class="docutils literal notranslate"><span class="pre">\jg&#64;cur&#64;acc</span></code>. For some
strange reasons <code class="docutils literal notranslate"><span class="pre">&amp;lt;</span></code> translates like <code class="docutils literal notranslate"><span class="pre">\lbra</span></code>, we change this.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">let</span>\<span class="n">notinover</span>\<span class="n">relax</span>
\<span class="n">def</span>\<span class="n">cur</span><span class="nd">@mo@content</span><span class="p">{</span><span class="n">TOTO</span><span class="p">}</span>

\<span class="n">def</span>\<span class="n">special</span><span class="nd">@mo</span><span class="c1">#1{%</span>
     \<span class="n">def</span>\<span class="n">jg</span><span class="nd">@tck</span><span class="p">{</span><span class="c1">#1} % save the argument</span>
     \<span class="n">ifx</span>\<span class="n">notinover</span>\<span class="n">over</span><span class="o">%</span> <span class="n">we</span> <span class="n">cannot</span> <span class="n">typeset</span> <span class="n">here</span>
        \<span class="n">ifx</span>\<span class="n">jg</span><span class="nd">@tck</span>\<span class="n">jg</span><span class="nd">@accgrave</span> <span class="o">%</span> <span class="n">strange</span>
          \<span class="k">global</span>\<span class="n">let</span>\<span class="n">jg</span><span class="nd">@cur@acc</span>\<span class="n">jg</span><span class="nd">@grave@acc</span>
          \<span class="k">global</span>\<span class="n">let</span>\<span class="n">cur</span><span class="nd">@mo@content</span>\<span class="n">relax</span>
        \<span class="k">else</span> \<span class="n">ifx</span>\<span class="n">jg</span><span class="nd">@tck</span>\<span class="n">jg</span><span class="nd">@accdddot</span> <span class="o">%</span> <span class="n">strange</span>
          \<span class="k">global</span>\<span class="n">let</span>\<span class="n">jg</span><span class="nd">@cur@acc</span>\<span class="n">dddot</span>
          \<span class="k">global</span>\<span class="n">let</span>\<span class="n">cur</span><span class="nd">@mo@content</span>\<span class="n">relax</span>
        \<span class="k">else</span> \<span class="n">ifx</span>\<span class="n">jg</span><span class="nd">@tck</span>\<span class="n">jg</span><span class="nd">@accddddot</span> <span class="o">%</span> <span class="n">strange</span>
          \<span class="k">global</span>\<span class="n">let</span>\<span class="n">jg</span><span class="nd">@cur@acc</span>\<span class="n">ddddot</span>
          \<span class="k">global</span>\<span class="n">let</span>\<span class="n">cur</span><span class="nd">@mo@content</span>\<span class="n">relax</span>
        \<span class="k">else</span>\<span class="n">gdef</span>\<span class="n">cur</span><span class="nd">@mo@content</span><span class="p">{</span><span class="c1">#1}\fi\fi\fi</span>
     \<span class="k">else</span> <span class="o">%</span> <span class="n">typeset</span> <span class="n">the</span> <span class="n">argument</span><span class="p">,</span> <span class="n">handle</span> <span class="o">&lt;</span> <span class="ow">and</span> <span class="o">&gt;</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">way</span>
     \<span class="n">ifx</span>\<span class="n">jg</span><span class="nd">@tck</span>\<span class="n">jg</span><span class="nd">@gt</span>\<span class="n">string</span><span class="o">&gt;</span>\<span class="k">else</span>
     \<span class="n">ifx</span>\<span class="n">jg</span><span class="nd">@tck</span>\<span class="n">jg</span><span class="nd">@lt</span>\<span class="n">string</span><span class="o">&lt;</span>\<span class="k">else</span>
     <span class="c1">#1\fi\fi\fi</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>We can avoid testing against every accent in the following way: If you
want to put a tilde, the XML will contain <code class="docutils literal notranslate"><span class="pre">&lt;mo&gt;&amp;#x2DC;&lt;/mo&gt;</span></code>. This is
defined as <code class="docutils literal notranslate"><span class="pre">\texttildelow</span></code> in the file ucharacters.sty. We redefine
this command, so as to define <code class="docutils literal notranslate"><span class="pre">\jg&#64;cur&#64;acc</span></code>. We use two functions, one
for over accents, another one for underaccents.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">let</span>\<span class="n">XXacute</span>\<span class="n">acute</span>
\<span class="n">def</span>\<span class="n">jg</span><span class="nd">@bindings</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">def</span>\<span class="n">texttildelow</span> <span class="p">{</span>\<span class="k">global</span>\<span class="n">let</span>\<span class="n">jg</span><span class="nd">@cur@acc</span>\<span class="n">jg</span><span class="nd">@tilde@acc</span><span class="p">}</span><span class="o">%</span>
  <span class="p">(</span><span class="n">complete</span> <span class="n">code</span> <span class="n">here</span><span class="p">)</span>
  \<span class="n">def</span>\<span class="n">ring</span><span class="p">{</span>\<span class="k">global</span>\<span class="n">let</span>\<span class="n">jg</span><span class="nd">@cur@acc</span>\<span class="n">mathring</span><span class="p">}</span>
<span class="p">}</span>
\<span class="n">def</span>\<span class="n">jg</span><span class="nd">@ubindings</span><span class="p">{</span><span class="o">%</span>
   \<span class="n">let</span>\<span class="n">JGG</span><span class="nd">@orig@rarrow</span>\<span class="n">rightarrow</span>
   \<span class="n">let</span>\<span class="n">JGG</span><span class="nd">@orig@larrow</span>\<span class="n">leftarrow</span>
   \<span class="n">def</span>\<span class="n">texttildelow</span> <span class="p">{</span>\<span class="k">global</span>\<span class="n">let</span>\<span class="n">jg</span><span class="nd">@cur@acc</span>\<span class="n">jg</span><span class="nd">@tilde@acc</span><span class="p">}</span><span class="o">%</span>
    <span class="p">(</span><span class="n">complete</span> <span class="n">code</span> <span class="n">here</span><span class="p">)</span>
   \<span class="n">def</span>\<span class="n">jgunderline</span><span class="p">{</span>\<span class="k">global</span>\<span class="n">let</span>\<span class="n">jg</span><span class="nd">@cur@acc</span>\<span class="n">underline</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Translation of <code class="docutils literal notranslate"><span class="pre">&lt;mover&gt;xy&lt;/mover&gt;</span></code> uses <code class="docutils literal notranslate"><span class="pre">\stackrel</span></code>, unless it is an
accent. Otherwise, we call <code class="docutils literal notranslate"><span class="pre">\jg&#64;bindings</span></code>, evaluate the second
argument in a context where <code class="docutils literal notranslate"><span class="pre">\notinover</span></code> is <code class="docutils literal notranslate"><span class="pre">\over</span></code>. We assume that
<code class="docutils literal notranslate"><span class="pre">\cur&#64;mo&#64;content\jg&#64;cur&#64;acc</span></code> will typeset what is needed.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">xml</span><span class="nd">@implement@over</span><span class="c1">#1#2{%</span>
 \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@overaccent</span>\<span class="n">att</span><span class="nd">@true</span> <span class="p">{</span><span class="o">%</span>
   \<span class="n">jg</span><span class="nd">@bindings</span>
   \<span class="n">let</span>\<span class="n">notinover</span>\<span class="n">over</span> <span class="c1">#2\let\notinover\relax \cur@mo@content\jg@cur@acc{#1}%</span>
 <span class="p">}</span>\<span class="k">else</span>\<span class="n">stackrel</span><span class="p">{</span><span class="c1">#2}{#1}\fi</span>
<span class="p">}</span>

\<span class="n">def</span>\<span class="n">xml</span><span class="nd">@implement@under</span><span class="c1">#1#2{%</span>
 \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@underaccent</span>\<span class="n">att</span><span class="nd">@true</span> <span class="p">{</span><span class="o">%</span>
   \<span class="n">jg</span><span class="nd">@ubindings</span>
   \<span class="n">let</span>\<span class="n">notinover</span>\<span class="n">over</span> <span class="c1">#2\let\notinover\relax \cur@mo@content\jg@cur@acc{#1}%</span>
 <span class="p">}</span>\<span class="k">else</span> \<span class="n">underset</span><span class="p">{</span><span class="c1">#2}{#1}\fi%</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The code of a fraction is trivial. However, there is an <a class="reference external" href="raweb3.html#unimp-frac">alternate
version</a> that honors the <code class="docutils literal notranslate"><span class="pre">scriptlevel</span></code>
attribute (<em>Tralics</em> uses a <code class="docutils literal notranslate"><span class="pre">&lt;mstyle&gt;</span></code> element for <code class="docutils literal notranslate"><span class="pre">\frac</span></code> and
such).</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">xml</span><span class="nd">@implement@frac</span><span class="c1">#1#2{%</span>
  \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@linethickness</span>\<span class="n">att</span><span class="nd">@true</span>\<span class="n">frac</span><span class="p">{</span><span class="c1">#1}{#2}%</span>
  \<span class="k">else</span> \<span class="n">genfrac</span><span class="p">{}{}</span>\<span class="n">XML</span><span class="nd">@linethickness</span><span class="p">{}{</span><span class="c1">#1}{#2}\fi</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">\defaultunits</span></code> command calls <code class="docutils literal notranslate"><span class="pre">\afterassignment</span></code> in order to
skip all tokens up to <code class="docutils literal notranslate"><span class="pre">\&#64;nnil</span></code>. As a result, <code class="docutils literal notranslate"><span class="pre">\XML&#64;mspacewidth</span></code> can
contain a dimension (for instance 33mm) or a number (like 2.3) case
where a `pt’ unit is inserted.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mspace</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">width</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@mspacewidth</span><span class="p">}{</span><span class="mi">0</span><span class="p">}}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="nd">@defaultunits</span>\<span class="n">dimen</span><span class="o">@</span>\<span class="n">XML</span><span class="nd">@mspacewidth</span> <span class="n">pt</span>\<span class="n">relax</span>\<span class="nd">@nnil</span>
   \<span class="n">ifnum</span>\<span class="n">dimen</span><span class="o">@=</span>\<span class="n">z</span><span class="o">@</span>\<span class="k">else</span>\<span class="n">kern</span>\<span class="n">dimen</span><span class="o">@</span>\<span class="n">fi</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>This implements the <code class="docutils literal notranslate"><span class="pre">&lt;mstyle&gt;</span></code> element.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mstyle</span><span class="p">}</span>
 <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">displaystyle</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@att@displaystyle</span><span class="p">}{</span><span class="n">foo</span><span class="p">}</span> <span class="o">%</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">scriptlevel</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@scriptlevel</span><span class="p">}{</span><span class="n">none</span><span class="p">}</span><span class="o">%</span>
 <span class="p">}</span>
 <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
 <span class="p">{{</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@att@displaystyle</span>\<span class="n">att</span><span class="nd">@true</span>\<span class="n">displaystyle</span>
   \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@att@displaystyle</span>\<span class="n">att</span><span class="nd">@false</span>
    \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@scriptlevel</span>\<span class="n">att</span><span class="nd">@dzero</span>\<span class="n">textstyle</span>
     \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@scriptlevel</span>\<span class="n">att</span><span class="nd">@done</span>\<span class="n">scriptstyle</span>
      \<span class="k">else</span> \<span class="n">scriptscriptstyle</span>\<span class="n">fi</span>\<span class="n">fi</span>
   \<span class="n">fi</span> <span class="o">%</span><span class="n">do</span> <span class="n">nothing</span> <span class="k">if</span> <span class="n">neither</span> <span class="n">true</span> <span class="n">nor</span> <span class="n">false</span>
   \<span class="n">fi</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>We give here the code of some trivial functions.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mrow</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{}</span>
  <span class="p">{}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">msub</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmltextwochildren</span>\<span class="nd">@firstofone</span>\<span class="n">sb</span><span class="c1">#1}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">msup</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmltextwochildren</span>\<span class="nd">@firstofone</span>\<span class="n">sp</span><span class="c1">#1}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">msubsup</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmltexthreechildren</span>\<span class="nd">@firstofone</span>\<span class="n">sb</span>\<span class="n">sp</span><span class="c1">#1}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mroot</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">xmltextwochildren</span>\<span class="n">mathmlroot</span><span class="p">{}</span><span class="c1">#1}</span>
\<span class="n">def</span>\<span class="n">mathmlroot</span><span class="c1">#1#2{\root#2\of{#1}}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">msqrt</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">sqrt</span><span class="p">{</span><span class="c1">#1}}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mtext</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">hbox</span><span class="p">{</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>This implements the <code class="docutils literal notranslate"><span class="pre">&lt;mn&gt;</span></code> element. Is <code class="docutils literal notranslate"><span class="pre">\mathrm</span></code> a good choice? We
implement also the <code class="docutils literal notranslate"><span class="pre">&lt;mi&gt;</span></code> element. You can specify a font in the
attribute. There is also the infamous test on the length. This means
that you should not insert spaces. This means also that you cannot use
entities.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mi</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">mathvariant</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@mathmlvariant</span><span class="p">}{</span><span class="n">normal</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">mi</span><span class="nd">@test</span><span class="c1">#1\relax}</span>

\<span class="n">gdef</span>\<span class="n">mi</span><span class="nd">@test</span><span class="c1">#1#2\relax{</span>
 \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mathmlvariant</span>\<span class="n">att</span><span class="nd">@mathml@bold</span>
  \<span class="n">mathbf</span><span class="p">{</span><span class="c1">#1#2}\else</span>
 \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mathmlvariant</span>\<span class="n">att</span><span class="nd">@mathml@sansserif</span>
  \<span class="n">mathsf</span><span class="p">{</span><span class="c1">#1#2}\else</span>
 \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mathmlvariant</span>\<span class="n">att</span><span class="nd">@mathml@tt</span>
  \<span class="n">texttt</span><span class="p">{</span><span class="c1">#1#2}\else</span>
  \<span class="n">ifx</span>\<span class="n">mi</span><span class="nd">@test</span><span class="c1">#2\mi@test</span>
   \<span class="n">expandafter</span><span class="c1">#1</span>
  \<span class="k">else</span>
   \<span class="n">mathrm</span><span class="p">{</span><span class="c1">#1#2}</span>
  \<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span><span class="p">}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mn</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">mathrm</span><span class="p">{</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>This implements the <code class="docutils literal notranslate"><span class="pre">&lt;mfence&gt;</span></code> element. The trouble is that the
<code class="docutils literal notranslate"><span class="pre">\left</span></code> and <code class="docutils literal notranslate"><span class="pre">\right</span></code> commands expect (after expansion) a delimiter.
What we have is a character string, that we must convert into a token.
The code is trivial, but a bit longish.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mfenced</span><span class="p">}</span>
  <span class="p">{</span> \<span class="n">XMLattribute</span><span class="p">{</span><span class="nb">open</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@fenceopen</span><span class="p">}{(}</span>
    \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">close</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@fenceclose</span><span class="p">}{)}</span>  <span class="p">}</span>
  <span class="p">{</span>\<span class="n">jg</span><span class="nd">@hacko</span>\<span class="n">left</span>\<span class="n">XML</span><span class="nd">@fenceopen</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">jg</span><span class="nd">@hackc</span>\<span class="n">right</span>\<span class="n">XML</span><span class="nd">@fenceclose</span><span class="p">}</span>

\<span class="n">def</span>\<span class="n">jg</span><span class="nd">@hacko</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@fenceopen</span>\<span class="n">jg</span><span class="nd">@lt</span>\<span class="n">let</span>\<span class="n">XML</span><span class="nd">@fenceopen</span>\<span class="n">langle</span>\<span class="n">fi</span>
  <span class="p">(</span><span class="n">complete</span> <span class="n">code</span> <span class="n">shown</span> <span class="n">here</span><span class="p">)</span>
<span class="p">}</span>

\<span class="n">def</span>\<span class="n">jg</span><span class="nd">@hackc</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@fenceclose</span>\<span class="n">jg</span><span class="nd">@gt</span>\<span class="n">let</span>\<span class="n">XML</span><span class="nd">@fenceclose</span>\<span class="n">rangle</span>\<span class="n">fi</span><span class="p">}</span>
  <span class="p">(</span><span class="n">complete</span> <span class="n">code</span> <span class="n">shown</span> <span class="n">here</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="tables-in-mathml">
<h3>5.4 Tables in MathML<a class="headerlink" href="#tables-in-mathml" title="Link to this heading"></a></h3>
<p>Original code tested attribute <code class="docutils literal notranslate"><span class="pre">class=equation</span></code>. Called `gathered’ in
this case. This uses three global variables: <code class="docutils literal notranslate"><span class="pre">\GATHER</span></code>,
<code class="docutils literal notranslate"><span class="pre">\StartTable</span></code> and <code class="docutils literal notranslate"><span class="pre">\StartRow</span></code></p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mtable</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>
  \<span class="n">def</span>\<span class="n">StartTable</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">%</span>
  \<span class="n">def</span>\<span class="n">GATHER</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span><span class="o">%</span>
     \<span class="n">begin</span><span class="p">{</span><span class="n">array</span><span class="p">}{</span><span class="o">*</span><span class="p">{</span><span class="mi">99</span><span class="p">}{</span><span class="n">c</span><span class="p">}}</span>
  <span class="p">}</span>
  <span class="p">{</span>
    \<span class="n">end</span><span class="p">{</span><span class="n">array</span><span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<p>A non trivial question: where the does group start of finish? We
globally define a command <code class="docutils literal notranslate"><span class="pre">\temp</span></code> that is executed just after the
current group. This command defines <code class="docutils literal notranslate"><span class="pre">\StartRow</span></code> to 1 (true), then
executes the argument. Moreover, if <code class="docutils literal notranslate"><span class="pre">\StartTable</span></code> is 0 (first row of
the table) it toggles it to 1; otherwise, it inserts a <code class="docutils literal notranslate"><span class="pre">\\</span></code>, this
creates a new row.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mtr</span><span class="p">}</span>
 <span class="p">{}</span>
 <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
 <span class="p">{</span>\<span class="n">ifnum</span>\<span class="n">StartTable</span><span class="o">=</span><span class="mi">1</span>
    \<span class="n">gdef</span>\<span class="n">temp</span><span class="p">{</span> \<span class="n">gdef</span>\<span class="n">StartTable</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>\<span class="n">def</span>\<span class="n">StartRow</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="c1">#1}%</span>
  \<span class="k">else</span>
    \<span class="n">gdef</span>\<span class="n">temp</span><span class="p">{</span>\\\<span class="n">def</span>\<span class="n">StartRow</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="c1">#1}%</span>
  \<span class="n">fi</span>
  \<span class="n">aftergroup</span>\<span class="n">temp</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>This piece of code is not complete. It does not handle the multicolumn
case. We construct a <code class="docutils literal notranslate"><span class="pre">\temp</span></code> command as above. If <code class="docutils literal notranslate"><span class="pre">StartRow</span></code> is one,
we toggle to 0, otherwise insert a ampersand (here <code class="docutils literal notranslate"><span class="pre">\tabcellsep</span></code>). We
test also alignments (left, right, center). What is the purpose of the
space after <code class="docutils literal notranslate"><span class="pre">\hfill</span></code>?</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">m</span><span class="p">:</span><span class="n">mtd</span><span class="p">}</span>
 <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">columnalign</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@mtdalign</span><span class="p">}{</span><span class="n">center</span><span class="p">}</span>
  \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">columnspan</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@mtdspan</span><span class="p">}{</span><span class="mi">1</span><span class="p">}}</span>
 <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
 <span class="p">{</span>
   <span class="o">%</span>  \<span class="n">ifnum</span>\<span class="n">XML</span><span class="nd">@mtdspan</span><span class="o">=</span><span class="mi">1</span>
   \<span class="n">ifnum</span>\<span class="n">StartRow</span><span class="o">=</span><span class="mi">1</span>
     \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mtdalign</span>\<span class="n">att</span><span class="nd">@mtd@left</span>
        \<span class="n">gdef</span>\<span class="n">temp</span><span class="p">{</span>\<span class="n">gdef</span>\<span class="n">StartRow</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span><span class="c1">#1\hfill{ }}%</span>
        \<span class="k">else</span> \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mtdalign</span>\<span class="n">att</span><span class="nd">@mtd@right</span>
          \<span class="n">gdef</span>\<span class="n">temp</span><span class="p">{</span>\<span class="n">gdef</span>\<span class="n">StartRow</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>\<span class="n">hfill</span><span class="c1">#1}%</span>
          \<span class="k">else</span> \<span class="n">gdef</span>\<span class="n">temp</span><span class="p">{</span>\<span class="n">gdef</span>\<span class="n">StartRow</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span><span class="c1">#1}\fi\fi%</span>
   \<span class="k">else</span><span class="o">%</span>
     \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mtdalign</span>\<span class="n">att</span><span class="nd">@mtd@left</span>
        \<span class="n">gdef</span>\<span class="n">temp</span><span class="p">{</span>\<span class="n">tabcellsep</span><span class="c1">#1\hfill{ }}%</span>
        \<span class="k">else</span> \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@mtdalign</span>\<span class="n">att</span><span class="nd">@mtd@right</span>
          \<span class="n">gdef</span>\<span class="n">temp</span><span class="p">{</span>\<span class="n">tabcellsep</span>\<span class="n">hfill</span> <span class="c1">#1}%</span>
          \<span class="k">else</span> \<span class="n">gdef</span>\<span class="n">temp</span><span class="p">{</span>\<span class="n">tabcellsep</span><span class="c1">#1}\fi\fi%</span>
    \<span class="n">fi</span>
  \<span class="n">aftergroup</span>\<span class="n">temp</span>
 <span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="pictures">
<h3>5.5 Pictures<a class="headerlink" href="#pictures" title="Link to this heading"></a></h3>
<p>We show there the TeX command used to implement the picture environment.</p>
<p>The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;picture</span> <span class="pre">width='A'</span> <span class="pre">height='B'</span> <span class="pre">xpos='C'</span> <span class="pre">ypos='D'&gt;</span> <span class="pre">etc</span> <span class="pre">&lt;/picture&gt;</span></code> is
<code class="docutils literal notranslate"><span class="pre">\begin{picture}(A,B)(C,D)</span> <span class="pre">etc</span> <span class="pre">\end{picture}</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">picture</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">width</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">}{</span><span class="mi">1</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">height</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@height</span><span class="p">}{</span><span class="mi">1</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xpos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">ypos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="p">{</span>\<span class="n">begin</span><span class="p">{</span><span class="n">picture</span><span class="p">}(</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@height</span><span class="p">)(</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">)}</span>
  <span class="p">{</span>\<span class="n">end</span><span class="p">{</span><span class="n">picture</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<p>The translation of <code class="docutils literal notranslate"><span class="pre">&lt;pic-put</span> <span class="pre">xpos='A'</span> <span class="pre">ypos='B'&gt;</span> <span class="pre">object</span> <span class="pre">&lt;/pic-put&gt;</span></code> is
<code class="docutils literal notranslate"><span class="pre">\put(A,B){object}</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">put</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xpos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">ypos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">put</span><span class="p">(</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">){</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>The translation of <code class="docutils literal notranslate"><span class="pre">&lt;pic-arc</span> <span class="pre">xpos='A'</span> <span class="pre">ypos='B'</span> <span class="pre">angle='C'/&gt;</span></code> is
<code class="docutils literal notranslate"><span class="pre">\arc(A,B){C}</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">arc</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xpos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">angle</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@angle</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">ypos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">arc</span><span class="p">(</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">){</span>\<span class="n">XML</span><span class="nd">@angle</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<p>The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-scaleput</span> <span class="pre">xscale='A'</span> <span class="pre">yscale='B'</span>&#160; <span class="pre">xscaley='C'</span> <span class="pre">yscalex='D'</span> <span class="pre">xpos='E'</span> <span class="pre">ypos='F'&gt;</span> <span class="pre">argument</span> <span class="pre">&lt;/pic-scaleput&gt;</span></code>
is
<code class="docutils literal notranslate"><span class="pre">\def\xscale{A}</span> <span class="pre">\def\yscale{B}</span> <span class="pre">\def\xscaley{C}</span> <span class="pre">\def\yscalex{D}</span> <span class="pre">\scaleput(E,F){argument}</span></code>.
The <code class="docutils literal notranslate"><span class="pre">\def</span></code>s are automatic.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">scaleput</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xscale</span><span class="p">}{</span>\<span class="n">xscale</span><span class="p">}{</span><span class="mf">1.0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">yscale</span><span class="p">}{</span>\<span class="n">yscale</span><span class="p">}{</span><span class="mf">1.0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xscaley</span><span class="p">}{</span>\<span class="n">xscaley</span><span class="p">}{</span><span class="mf">0.0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">yscalex</span><span class="p">}{</span>\<span class="n">yscalex</span><span class="p">}{</span><span class="mf">0.0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xpos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">ypos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">scaleput</span><span class="p">(</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">){</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>The translation of <code class="docutils literal notranslate"><span class="pre">&lt;pic-thicklines/&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">\thicklines</span></code>; that of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-thinlines/&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">\thinlines</span></code>; and that of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-linethickness</span> <span class="pre">size='A'&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">\linethickness{A}</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">thicklines</span><span class="p">}</span>
  <span class="p">{}{</span>\<span class="n">xmlgrab</span><span class="p">}{</span>\<span class="n">thicklines</span><span class="p">}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">thinlines</span><span class="p">}</span>
  <span class="p">{}{}{</span>\<span class="n">thinlines</span><span class="p">}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">linethickness</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">size</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@size</span><span class="p">}{</span><span class="mi">1</span><span class="n">pt</span><span class="p">}}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">linethickness</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@size</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<p>The previous code works only if the commands modify global variables.
Thus we redefine these.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">gdef</span>\<span class="n">thinlines</span><span class="p">{</span>\<span class="k">global</span>\<span class="n">let</span>\<span class="nd">@linefnt</span>\<span class="n">tenln</span> \<span class="k">global</span>\<span class="n">let</span>\<span class="nd">@circlefnt</span>\<span class="n">tencirc</span>
  \<span class="k">global</span>\<span class="nd">@wholewidth</span>\<span class="n">fontdimen8</span>\<span class="n">tenln</span> \<span class="k">global</span>\<span class="nd">@halfwidth</span> <span class="mf">.5</span>\<span class="nd">@wholewidth</span><span class="p">}</span>

\<span class="n">gdef</span>\<span class="n">thicklines</span><span class="p">{</span>\<span class="k">global</span>\<span class="n">let</span>\<span class="nd">@linefnt</span>\<span class="n">tenlnw</span> \<span class="k">global</span>\<span class="n">let</span>\<span class="nd">@circlefnt</span>\<span class="n">tencircw</span>
  \<span class="k">global</span>\<span class="nd">@wholewidth</span>\<span class="n">fontdimen8</span>\<span class="n">tenlnw</span> \<span class="k">global</span>\<span class="nd">@halfwidth</span> <span class="mf">.5</span>\<span class="nd">@wholewidth</span><span class="p">}</span>

\<span class="n">gdef</span>\<span class="n">linethickness</span><span class="c1">#1{%</span>
   \<span class="k">global</span>\<span class="nd">@wholewidth</span> <span class="c1">#1\relax \global\@halfwidth .5\@wholewidth}</span>
</pre></div>
</div>
</div>
<p>The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-multiput</span> <span class="pre">xpos='A'</span> <span class="pre">ypos='B'</span> <span class="pre">repeat='C'</span> <span class="pre">dx='D'</span> <span class="pre">dy='E'&gt;</span>&#160; <span class="pre">argument</span> <span class="pre">&lt;/pic-multiput&gt;</span></code>
is <code class="docutils literal notranslate"><span class="pre">\multiput(A,B)(D,E){C}{argument}</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">multiput</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xpos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">ypos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">repeat</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@repeat</span><span class="p">}{</span><span class="mi">1</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">dx</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@dx</span><span class="p">}{</span><span class="mi">1</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">dy</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@dy</span><span class="p">}{</span><span class="mi">1</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">multiput</span><span class="p">(</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">)(</span>\<span class="n">XML</span><span class="nd">@dx</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@dy</span><span class="p">){</span>\<span class="n">XML</span><span class="nd">@repeat</span><span class="p">}{</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-bezier</span> <span class="pre">a1='A'</span> <span class="pre">a2='B'</span> <span class="pre">b1='C'</span> <span class="pre">b2='D'</span>&#160; <span class="pre">c1='E'</span> <span class="pre">d1='F'</span> <span class="pre">repeat</span> <span class="pre">='G'/&gt;</span></code>
is <code class="docutils literal notranslate"><span class="pre">\qbezier[G](A,B)(C,D)(E,F)</span></code>. The value of the optional argument
`repeat’ is zero.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">bezier</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">a1</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ai</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">a2</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@aii</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">b1</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@bi</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">b2</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@bii</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">c1</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ci</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">c2</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@cii</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">repeat</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@repeat</span><span class="p">}{</span><span class="mi">0</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">qbezier</span><span class="p">[</span>\<span class="n">XML</span><span class="nd">@repeat</span><span class="p">](</span>\<span class="n">XML</span><span class="nd">@ai</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@aii</span><span class="p">)(</span>\<span class="n">XML</span><span class="nd">@bi</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@bii</span><span class="p">)(</span>\<span class="n">XML</span><span class="nd">@ci</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@cii</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<p>Lines and vectors are handled in the same way. The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-line</span> <span class="pre">xdir='A'</span> <span class="pre">ydir='B'</span> <span class="pre">width='C'/&gt;</span></code> or
<code class="docutils literal notranslate"><span class="pre">&lt;pic-vector</span> <span class="pre">xdir='A'</span> <span class="pre">ydir='B'</span> <span class="pre">width='C'/&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">\line(A,B){C}</span></code> and
<code class="docutils literal notranslate"><span class="pre">\vector[G](A,B){C}</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">line</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xdir</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@xdir</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">ydir</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ydir</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">width</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">}{</span><span class="mi">0</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">line</span><span class="p">(</span>\<span class="n">XML</span><span class="nd">@xdir</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@ydir</span><span class="p">){</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">}}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">vector</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xdir</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@xdir</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">ydir</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ydir</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">width</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">}{</span><span class="mi">0</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">vector</span><span class="p">(</span>\<span class="n">XML</span><span class="nd">@xdir</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@ydir</span><span class="p">){</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<p>Three similar routines. The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-curve</span> <span class="pre">unit-length=unit-length=&quot;0.4&quot;&gt;300,0,</span> <span class="pre">340,100,</span> <span class="pre">380,0&lt;/pic-curve&gt;</span></code>
is <code class="docutils literal notranslate"><span class="pre">{\setlength\unitlength{0.4pt}\curve(300,0,</span> <span class="pre">340,100,</span> <span class="pre">380,0)}</span></code>.
There is a big hack here. Spaces are defined to be space plus
<code class="docutils literal notranslate"><span class="pre">\ignorespaces</span></code> by xmltex.tex. When the package tries to convert the
340 into a dimension, via <code class="docutils literal notranslate"><span class="pre">\mylength=argument\unitlength</span></code>, the
<code class="docutils literal notranslate"><span class="pre">\ignorespaces</span></code> gives a <em>Missing number, treated as zero</em> error. For
this reason, we redefine <code class="docutils literal notranslate"><span class="pre">\ignorespaces</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">curve</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">unit</span><span class="o">-</span><span class="n">length</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ulength</span><span class="p">}{</span><span class="mi">1</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{{</span>\<span class="n">def</span>\<span class="n">ignorespaces</span><span class="p">{}</span>\<span class="n">setlength</span>\<span class="n">unitlength</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@ulength</span> <span class="n">pt</span><span class="p">}</span>\<span class="n">curve</span><span class="p">(</span><span class="c1">#1)\global\unitlength=1pt }}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">closecurve</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">unit</span><span class="o">-</span><span class="n">length</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ulength</span><span class="p">}{</span><span class="mi">1</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{{</span>\<span class="n">def</span>\<span class="n">ignorespaces</span><span class="p">{}</span>\<span class="n">setlength</span>\<span class="n">unitlength</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@ulength</span> <span class="n">pt</span><span class="p">}</span>\<span class="n">closecurve</span><span class="p">(</span><span class="c1">#1)\global\unitlength=1pt}}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">tagcurve</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">unit</span><span class="o">-</span><span class="n">length</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ulength</span><span class="p">}{</span><span class="mi">1</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{{</span>\<span class="n">def</span>\<span class="n">ignorespaces</span><span class="p">{}</span>\<span class="n">setlength</span>\<span class="n">unitlength</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@ulength</span> <span class="n">pt</span><span class="p">}</span>\<span class="n">tagcurve</span><span class="p">(</span><span class="c1">#1)\global\unitlength=1pt }}</span>
</pre></div>
</div>
</div>
<p>The translation of <code class="docutils literal notranslate"><span class="pre">&lt;pic-frame&gt;</span> <span class="pre">argument</span>&#160; <span class="pre">&lt;/pic-frame&gt;</span></code> is
<code class="docutils literal notranslate"><span class="pre">\frame{argument}</span></code></p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">frame</span><span class="p">}</span>
 <span class="p">{}</span>
 <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
 <span class="p">{</span>\<span class="n">frame</span><span class="p">{</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>The translation of <code class="docutils literal notranslate"><span class="pre">&lt;pic-circle</span> <span class="pre">size='A'</span> <span class="pre">full='false'/&gt;</span></code> or
<code class="docutils literal notranslate"><span class="pre">&lt;pic-circle</span> <span class="pre">size='A'</span> <span class="pre">full='notfalse'/&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">\circle{A}</span></code> or
<code class="docutils literal notranslate"><span class="pre">\circle*{A}</span></code>. <em>Tralics</em> uses nothing or <code class="docutils literal notranslate"><span class="pre">true</span></code> as value of the
<code class="docutils literal notranslate"><span class="pre">full</span></code> attribute.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">circle</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">size</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@size</span><span class="p">}{</span><span class="mi">1</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">full</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@full</span><span class="p">}{</span><span class="n">false</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@full</span>\<span class="n">att</span><span class="nd">@false</span>\<span class="n">circle</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@size</span><span class="p">}</span>\<span class="k">else</span> \<span class="n">circle</span><span class="o">*</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@size</span><span class="p">}</span>\<span class="n">fi</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>The translation of <code class="docutils literal notranslate"><span class="pre">&lt;pic-bigcircle</span> <span class="pre">size='A'</span> <span class="pre">unitlength='B'/&gt;</span></code> should
be <code class="docutils literal notranslate"><span class="pre">{\unitlength=Bpt</span> <span class="pre">\bigcircle{A}}</span></code>. For some reasons, the
<code class="docutils literal notranslate"><span class="pre">\bigcircle</span></code> command modifies globally <code class="docutils literal notranslate"><span class="pre">\unitlength</span></code>, so that the
piece of code given above modifies <code class="docutils literal notranslate"><span class="pre">\unitlength</span></code>. For this reason, we
use another variable, and use a global assignment.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">newdimen</span>\<span class="n">jgunitlength</span>
\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">bigcircle</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">size</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@size</span><span class="p">}{</span><span class="mi">1</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">unit</span><span class="o">-</span><span class="n">length</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ulength</span><span class="p">}{</span><span class="mi">1</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">jgunitlength</span><span class="o">=</span>\<span class="n">unitlength</span>\<span class="n">setlength</span>\<span class="n">unitlength</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@ulength</span> <span class="n">pt</span><span class="p">}</span>
    \<span class="n">bigcircle</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@size</span><span class="p">}</span>
    \<span class="k">global</span>\<span class="n">unitlength</span><span class="o">=</span>\<span class="n">jgunitlength</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>This should be changed. This evaluates the command (first argument),
with an argument (second argument), using an optional argument which is
one of L, R, and one of T, B, computed from the global variable
<code class="docutils literal notranslate"><span class="pre">\XML&#64;pos</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="nd">@att@to@rtb</span><span class="c1">#1#2{%</span>
  \<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@l</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[l]{#2}}</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@r</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[r]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@t</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[t]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@b</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[b]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@lt</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[lt]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@lb</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[lb]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@rt</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[rt]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@rb</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[rb]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@tl</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[lt]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@bl</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[lb]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@tr</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[rt]{#2}}%</span>
  \<span class="k">else</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@pos</span>\<span class="n">att</span><span class="nd">@br</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1[rb]{#2}}%</span>
  \<span class="k">else</span> \<span class="n">def</span>\<span class="n">foo</span><span class="p">{</span><span class="c1">#1{#2}}</span>
 \<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>\<span class="n">fi</span>
\<span class="n">foo</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-framebox</span> <span class="pre">width='A'</span>&#160; <span class="pre">height='B'</span> <span class="pre">position='xx'&gt;</span> <span class="pre">argument</span> <span class="pre">&lt;/pic-framebox&gt;</span></code>
is <code class="docutils literal notranslate"><span class="pre">\makebox(A,B)[opt]{argument}</span></code>, where the optional argument is
given by the procedure above. In case an non-false <code class="docutils literal notranslate"><span class="pre">framed</span></code> attribute
is given, the <code class="docutils literal notranslate"><span class="pre">\framebox</span></code> command is used instead of <code class="docutils literal notranslate"><span class="pre">\makebox</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">framebox</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">width</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">height</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@height</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">position</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@pos</span><span class="p">}{}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">framed</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@framed</span><span class="p">}{</span><span class="n">false</span><span class="p">}</span>
  <span class="p">}</span>
 <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
 <span class="p">{</span>\<span class="n">let</span>\<span class="n">cmd</span>\<span class="n">framebox</span>\<span class="n">ifx</span>\<span class="n">XML</span><span class="nd">@framed</span>\<span class="n">att</span><span class="nd">@false</span>\<span class="n">let</span>\<span class="n">cmd</span>\<span class="n">makebox</span>\<span class="n">fi</span>
  \<span class="nd">@att@to@rtb</span><span class="p">{</span>\<span class="n">cmd</span><span class="p">(</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@height</span><span class="p">)}{</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-dashbox</span>&#160; <span class="pre">width='A'</span> <span class="pre">height='B'</span> <span class="pre">dashdim='C'</span> <span class="pre">position='xx'&gt;</span> <span class="pre">argument</span> <span class="pre">&lt;/pic-dashbox&gt;</span></code>
is <code class="docutils literal notranslate"><span class="pre">\dashbox{C}(A,B)[opt]{argument}</span></code>, where the optional argument is
given by the procedure above.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">dashbox</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">width</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">height</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@height</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">position</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@pos</span><span class="p">}{</span><span class="n">w</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">dashdim</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@dashdim</span><span class="p">}{</span><span class="mi">1</span><span class="n">pt</span><span class="p">}</span>
  <span class="p">}</span>
 <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
 <span class="p">{</span>\<span class="nd">@att@to@rtb</span><span class="p">{</span>\<span class="n">dashbox</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@dashdim</span><span class="p">}(</span>\<span class="n">XML</span><span class="nd">@width</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@height</span><span class="p">)}{</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>The translation of
<code class="docutils literal notranslate"><span class="pre">&lt;pic-oval</span>&#160; <span class="pre">xpos='A'</span> <span class="pre">ypos='B'</span> <span class="pre">specs='xx'&gt;</span> <span class="pre">argument</span> <span class="pre">&lt;/pic-oval&gt;</span></code> is
<code class="docutils literal notranslate"><span class="pre">\oval(A,B)[opt]{argument}</span></code>, where the optional argument is given by
the procedure above.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pic</span><span class="o">-</span><span class="n">oval</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">xpos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">specs</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@pos</span><span class="p">}{}</span>
   \<span class="n">XMLattribute</span><span class="p">{</span><span class="n">ypos</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">}{</span><span class="mi">0</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="nd">@att@to@rtb</span><span class="p">{</span>\<span class="n">oval</span><span class="p">(</span>\<span class="n">XML</span><span class="nd">@xpos</span><span class="p">,</span>\<span class="n">XML</span><span class="nd">@ypos</span><span class="p">)}{</span><span class="c1">#1}}</span>
</pre></div>
</div>
</div>
<p>Useful for typesetting TeX and LaTeX logos.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">TeX</span><span class="p">}</span>
  <span class="p">{}{</span>\<span class="n">TeX</span><span class="p">{}}{}</span>
\<span class="n">XMLelement</span><span class="p">{</span><span class="n">LaTeX</span><span class="p">}</span>
  <span class="p">{}{</span>\<span class="n">LaTeX</span><span class="p">{}}{}</span>
</pre></div>
</div>
</div>
<p>All images in examples of <em>Tralics</em> are obtained by putting the
expression into <code class="docutils literal notranslate"><span class="pre">&lt;preview&gt;</span></code> element, whose translation is given here.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">preview</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">begin</span><span class="p">{</span><span class="n">preview</span><span class="p">}}</span>
  <span class="p">{</span>\<span class="n">end</span><span class="p">{</span><span class="n">preview</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</section>
<section id="tables">
<h3>5.6 Tables<a class="headerlink" href="#tables" title="Link to this heading"></a></h3>
<p>In the file fotex.sty, tables are implemented via the `NoTable’
mechanism. We modify this a bit.</p>
<p>In this piece of code, we do not set <code class="docutils literal notranslate"><span class="pre">\TableWidth</span></code> if the width is
declared auto.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\newif\ifnoheightcheck
\catcode`\:\active

\def\myNoTableSetup{%
  \ifx\FOwidth\att@auto\else
   \TableWidth\FOwidth
   \advance\TableWidth by -\tabcolsep
   \advance\TableWidth by -\FOmarginleft
   \advance\TableWidth by -\FOmarginright
 \fi
  \global\advance\AbsoluteTableCount by 1 %
  \DeclareArray{fotable\the\AbsoluteTableCount:}%
  \global\CellCount0 %
}
\catcode`\:12
</pre></div>
</div>
</div>
</section>
<section id="getting-labels-right">
<h3>5.7 Getting labels right<a class="headerlink" href="#getting-labels-right" title="Link to this heading"></a></h3>
<p>The fotex.xmt file defines the behaviour of <code class="docutils literal notranslate"><span class="pre">&lt;fo:block&gt;</span></code>. The action
depends on the context. The action, when entering the block can be
<code class="docutils literal notranslate"><span class="pre">\FOListBlock</span></code> inside a list, <code class="docutils literal notranslate"><span class="pre">\FOOutputBlock</span></code> (inside output) or
<code class="docutils literal notranslate"><span class="pre">\FOBoxedBlock</span></code> in a table, or <code class="docutils literal notranslate"><span class="pre">\FONormalBlock</span></code>. We modified the
code of this command <a class="reference external" href="raweb3.html#hack-normalblock">(complete source
here)</a>.</p>
<p>The essential modification is to move the <code class="docutils literal notranslate"><span class="pre">\FOlabel</span></code> after
<code class="docutils literal notranslate"><span class="pre">\FOvspacebefore</span></code>. Thus, in case of page break, the label is near the
text.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">AtBeginDocument</span><span class="p">{</span><span class="o">%</span>
\<span class="n">def</span>\<span class="n">FONormalBlock</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">let</span>\<span class="nd">@x</span>\<span class="n">relax</span>
  \<span class="n">ifnum</span>\<span class="n">FOTableNesting</span><span class="o">&gt;</span><span class="mi">0</span>
    <span class="o">...</span>
  \<span class="k">else</span>
    \<span class="n">ifnum</span>\<span class="n">FOinList</span><span class="o">&gt;</span><span class="mi">0</span>
      \<span class="n">FOlabel</span>
      <span class="o">...</span>
    \<span class="k">else</span>
      <span class="o">...</span>
      \<span class="n">par</span>
       <span class="o">%</span>\<span class="n">FOlabel</span> <span class="p">(</span><span class="n">deleted</span> <span class="n">here</span><span class="p">)</span>
      \<span class="n">Quadding</span>
      \<span class="n">ifFOBlockGrab</span>
        \<span class="n">FOBoxedBlock</span><span class="p">{</span>\<span class="n">linewidth</span><span class="p">}</span><span class="o">%</span>
      \<span class="k">else</span>
        \<span class="n">FOBorderTop</span>
        \<span class="n">ifdim</span>\<span class="n">FOpaddingbefore</span><span class="o">&gt;</span>\<span class="n">z</span><span class="o">@</span>
         \<span class="n">vskip</span>\<span class="n">FOpaddingbefore</span>
        \<span class="n">fi</span>
        \<span class="n">FOvspacebefore</span>
        <span class="o">...</span>
      \<span class="n">fi</span>
      <span class="o">...</span>
    \<span class="n">fi</span>
    \<span class="n">FOlabel</span> <span class="o">%</span> <span class="n">added</span> <span class="n">here</span>
    \<span class="n">FOSetFont</span><span class="p">{</span><span class="n">normal</span><span class="p">}</span><span class="o">%</span>
  \<span class="n">fi</span>
\<span class="nd">@x</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The argument of <code class="docutils literal notranslate"><span class="pre">\FOgeneratePage</span></code> is the expansion of <code class="docutils literal notranslate"><span class="pre">\FOformat</span></code>.
If it is, say <code class="docutils literal notranslate"><span class="pre">A.</span></code>, an A followed by a dot, the result will be
<code class="docutils literal notranslate"><span class="pre">\&#64;Alph{\c&#64;page}.</span></code>, with a dot after the page number.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">\thepage</span></code> command is defined as
<code class="docutils literal notranslate"><span class="pre">\csname</span> <span class="pre">&#64;arabic\endcsname</span> <span class="pre">\c&#64;page</span></code>, and this looks like the
<code class="docutils literal notranslate"><span class="pre">\yFOlabel</span></code> command.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span>\<span class="n">def</span>\<span class="n">FOgeneratePage</span><span class="c1">#1#2\@null{\csname Format-#1\endcsname{\c@page}#2}</span>
\<span class="n">def</span>\<span class="n">xFOgeneratePage</span><span class="c1">#1#2\@null{\yFOlabel#1#2}</span>
\<span class="n">def</span>\<span class="n">yFOlabel</span><span class="c1">#1{\csname Format-#1\endcsname{\c@page}}</span>
</pre></div>
</div>
</div>
<p>The macro <code class="docutils literal notranslate"><span class="pre">\xFOlabel</span></code> is the same as the original <code class="docutils literal notranslate"><span class="pre">\FOlabel</span></code> except
that <code class="docutils literal notranslate"><span class="pre">\yFOlabel</span></code> is not expanded: The purpose of <code class="docutils literal notranslate"><span class="pre">\protected&#64;write</span></code>
is to inhibit premature expansion of <code class="docutils literal notranslate"><span class="pre">\thepage</span></code>. Since the code does
not use <code class="docutils literal notranslate"><span class="pre">\thepage</span></code>, lots of reference in the table of contents are
wrong.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">xFOlabel</span><span class="p">{</span><span class="o">%</span>
 \<span class="n">ifx</span>\<span class="nd">@empty</span>\<span class="n">FOid</span>\<span class="k">else</span>
  \<span class="nd">@bsphack</span>
  \<span class="n">protected</span><span class="nd">@write</span>\<span class="nd">@mainaux</span><span class="p">{</span>\<span class="n">let</span>\<span class="n">yFOlabel</span>\<span class="n">relax</span><span class="p">}</span><span class="o">%</span>
    <span class="p">{</span>\<span class="n">string</span>\<span class="n">newlabel</span><span class="p">{</span>\<span class="n">FOid</span><span class="p">}{{}{</span>\<span class="n">expandafter</span>\<span class="n">xFOgeneratePage</span>
            \<span class="n">FOformat</span>\<span class="nd">@null</span><span class="p">}{}{</span>\<span class="n">FOid</span><span class="p">}{}}}</span><span class="o">%</span>
  \<span class="nd">@esphack</span>
  \<span class="n">hyper</span><span class="o">@</span><span class="nd">@anchor</span><span class="p">{</span>\<span class="n">FOid</span><span class="p">}{</span>\<span class="n">relax</span><span class="p">}</span><span class="o">%</span>
  \<span class="k">global</span>\<span class="n">let</span>\<span class="n">FOid</span>\<span class="nd">@empty</span>
 \<span class="n">fi</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="the-title-page">
<h3>5.8 The title page<a class="headerlink" href="#the-title-page" title="Link to this heading"></a></h3>
<p>If you say <code class="docutils literal notranslate"><span class="pre">\ra&#64;atxy(70mm,174mm){xx}</span></code>, then xx is typeset in a box,
shifted by 70mm horizontally and 174mm vertically, and added to the box
<code class="docutils literal notranslate"><span class="pre">\ra&#64;atxybox</span></code>.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">newbox</span>\<span class="n">ra</span><span class="nd">@atxybox</span>
\<span class="n">def</span>\<span class="n">ra</span><span class="nd">@atxy</span><span class="p">(</span><span class="c1">#1,#2)#3{\global\setbox\ra@atxybox=\hbox</span>
 <span class="p">{</span>\<span class="n">unhbox</span>\<span class="n">ra</span><span class="nd">@atxybox</span>
  \<span class="n">vtop</span> <span class="n">to</span> <span class="mi">0</span><span class="n">pt</span><span class="p">{</span>\<span class="n">kern</span> <span class="c1">#2\hbox to 0pt{\kern #1\relax #3\hss}\vss}}}</span>
</pre></div>
</div>
</div>
<p>The idea is to put the content of the <code class="docutils literal notranslate"><span class="pre">\ra&#64;atxybox</span></code> box at the origin.
We have to modify the <code class="docutils literal notranslate"><span class="pre">\output</span></code> routine, and the easiest way is to
change <code class="docutils literal notranslate"><span class="pre">\&#64;texttop</span></code>, which does nothing (it could be used to implement
<code class="docutils literal notranslate"><span class="pre">\raggedtop</span></code>). The expansion is some material that is put at upper
left corner of the page, before headings are added. This means that we
have to shift the material, inserting some kerns. Note that
<code class="docutils literal notranslate"><span class="pre">\&#64;themargin</span></code> is correct only if the page is odd, or if left and right
margins are the same. The logo appears on only one page, because we kill
<code class="docutils literal notranslate"><span class="pre">\&#64;texttop</span></code>. Note: The raweb.cls file inserts a logo on a given page
by adding <code class="docutils literal notranslate"><span class="pre">\setbox255=\vbox{\&#64;usemyatxy</span> <span class="pre">\unvbox255}</span></code> in front of the
<code class="docutils literal notranslate"><span class="pre">\output</span></code> routine. The <code class="docutils literal notranslate"><span class="pre">\&#64;usemyatxy</span></code> command is similar to the
command given here.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">ra</span><span class="nd">@useatxy</span><span class="p">{{</span><span class="o">%</span>
  \<span class="n">let</span>\<span class="nd">@themargin</span>\<span class="n">oddsidemargin</span>
  \<span class="n">vtop</span> <span class="n">to</span> <span class="mi">0</span><span class="n">pt</span><span class="p">{</span>\<span class="n">kern</span><span class="o">-</span>\<span class="n">headsep</span> \<span class="n">kern</span><span class="o">-</span>\<span class="n">topmargin</span> \<span class="n">kern</span><span class="o">-</span>\<span class="n">headheight</span>
               \<span class="n">kern</span><span class="o">-</span><span class="mi">1</span><span class="ow">in</span> \<span class="n">kern</span><span class="o">-</span>\<span class="n">voffset</span>
    \<span class="n">hbox</span> <span class="n">to</span> <span class="mi">0</span><span class="n">pt</span><span class="p">{</span>\<span class="n">kern</span><span class="o">-</span>\<span class="nd">@themargin</span> \<span class="n">kern</span><span class="o">-</span><span class="mi">1</span><span class="ow">in</span> \<span class="n">kern</span><span class="o">-</span>\<span class="n">hoffset</span>
    \<span class="n">unhbox</span>\<span class="n">ra</span><span class="nd">@atxybox</span> \<span class="n">hss</span><span class="p">}</span>\<span class="n">vss</span><span class="p">}}</span><span class="o">%</span>
    \<span class="k">global</span>\<span class="n">let</span>\<span class="nd">@texttop</span>\<span class="n">relax</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">We give here two similar functions. The first one is for the Raweb, it
is a reference to the English page, and the second is for Research
Reports. In the URL, en is replaced by fr, and THEME is spelled as
THÈME. The effect of this command is to insert, just above the logo,
the value of the theme, with a rule on each side. The <code class="docutils literal notranslate"><span class="pre">\vfil</span></code> is for
vertical centering of the title. The 8cm is obtained by trial and
error. The <code class="docutils literal notranslate"><span class="pre">\firstchar</span></code> command is now useless. We show show here
the two versions of the Logo: French and English. As you can see, they
are not exactly the same.</div>
<div class="line"><img alt="Logo Ra2003" src="_images/LogoRA2003.png" />—<img alt="Logo Ra2002" src="_images/LogoRA2002.png" /></div>
</div>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">foratheme</span><span class="c1">#1{\vskip8cm \vfil</span>
  \<span class="n">ra</span><span class="nd">@atxy</span><span class="p">(</span><span class="mi">74</span><span class="n">mm</span><span class="p">,</span><span class="mi">175</span><span class="n">mm</span><span class="p">)</span> <span class="p">{</span>\<span class="n">hbox</span> <span class="n">to</span> <span class="mi">70</span><span class="n">mm</span><span class="p">{</span><span class="o">%</span>
       \<span class="n">hrulefill</span>\<span class="n">hspace</span><span class="p">{</span><span class="mi">8</span><span class="n">mm</span><span class="p">}</span>
         \<span class="n">def</span>\<span class="n">firstchar</span><span class="c1">##1##2\relax{##1##2} % ducon</span>
           \<span class="n">href</span><span class="p">{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">inria</span><span class="o">.</span><span class="n">fr</span><span class="o">/</span><span class="n">recherche</span><span class="o">/</span><span class="n">equipes</span><span class="o">/</span><span class="n">listes</span><span class="o">/%</span>
      <span class="n">theme_</span>\<span class="n">firstchar</span><span class="c1">#1\relax.en.html}{THEME \uppercase{#1}}%</span>
             \<span class="n">hspace</span><span class="p">{</span><span class="mi">8</span><span class="n">mm</span><span class="p">}</span>\<span class="n">hrulefill</span><span class="p">}}}</span>
\<span class="n">def</span>\<span class="n">forrtheme</span><span class="c1">#1{...}</span>
</pre></div>
</div>
</div>
<p>This puts the logo at the right place in case of a Inria Research or
Technical Report. Digits seem randomly chosen: you would expect both
logos to be of the same size, inserted at the origin, with a width of
210mm.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">forrinria</span><span class="p">{</span><span class="o">%</span>
 <span class="p">{</span>\<span class="n">def</span>\<span class="n">tmp</span><span class="p">{</span><span class="n">RR</span><span class="p">}</span><span class="o">%</span>
   \<span class="n">ifx</span>\<span class="n">tmp</span>\<span class="n">ra</span><span class="nd">@type</span>\<span class="n">ra</span><span class="nd">@atxy</span><span class="p">(</span><span class="mf">1.05</span><span class="n">cm</span><span class="p">,</span><span class="mf">1.625</span><span class="n">cm</span><span class="p">){</span>\<span class="n">includegraphics</span><span class="p">[</span><span class="n">width</span><span class="o">=</span><span class="mf">23.1</span><span class="n">cm</span><span class="p">]</span><span class="o">%</span>
        <span class="p">{</span><span class="n">rap</span><span class="o">-</span><span class="n">rech</span><span class="p">}}</span><span class="o">%</span>
              \<span class="k">else</span>\<span class="n">ra</span><span class="nd">@atxy</span><span class="p">(</span><span class="mf">0.5</span><span class="n">cm</span><span class="p">,</span><span class="mf">1.325</span><span class="n">cm</span><span class="p">){</span>\<span class="n">includegraphics</span><span class="p">[</span><span class="n">width</span><span class="o">=</span><span class="mf">19.2</span><span class="n">cm</span><span class="p">]</span><span class="o">%</span>
        <span class="p">{</span><span class="n">rap</span><span class="o">-</span><span class="n">tech</span><span class="p">}</span>\<span class="n">fi</span><span class="p">}}}</span>
</pre></div>
</div>
</div>
<p>This command is used to put the Raweb logo (depending on the year) and
the Inria logo on the front page. This code is awful: the text INRIA
etc. has a width of 128mm, and is at 39mm from one border and 43 from
the other one. The <code class="docutils literal notranslate"><span class="pre">\vfil</span></code> is for vertical alignment of the text that
follows (name of the team etc).</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">foinria</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">ra</span><span class="nd">@atxy</span><span class="p">(</span><span class="mf">7.8</span><span class="n">cm</span><span class="p">,</span><span class="mf">2.5</span><span class="n">cm</span><span class="p">){</span>\<span class="n">includegraphics</span><span class="p">[</span><span class="n">width</span><span class="o">=</span><span class="mf">5.7</span><span class="n">cm</span><span class="p">]{</span><span class="n">Logo</span><span class="o">-</span><span class="n">INRIA</span><span class="o">-</span><span class="n">couleur</span><span class="p">}}</span><span class="o">%</span>
  \<span class="n">ra</span><span class="nd">@atxy</span><span class="p">(</span><span class="mi">55</span><span class="n">mm</span><span class="p">,</span><span class="mi">173</span><span class="n">mm</span><span class="p">){</span>\<span class="n">includegraphics</span><span class="p">{</span><span class="n">LogoRA</span>\<span class="n">ra</span><span class="nd">@year</span><span class="p">}}</span><span class="o">%</span>
 \<span class="n">setbox0</span>\<span class="n">hbox</span> <span class="n">to</span> <span class="mi">14</span><span class="n">cm</span><span class="p">{</span><span class="o">%</span>
     \<span class="n">noindent</span>\<span class="n">hskip3cm</span>\<span class="n">hfill</span>
     <span class="p">{</span>\<span class="n">fontencoding</span><span class="p">{</span><span class="n">T1</span><span class="p">}</span>\<span class="n">fontfamily</span><span class="p">{</span><span class="n">ptm</span><span class="p">}</span>\<span class="n">fontseries</span><span class="p">{</span><span class="n">m</span><span class="p">}</span><span class="o">%</span>
   \<span class="n">fontshape</span><span class="p">{</span><span class="n">n</span><span class="p">}</span>\<span class="n">fontsize</span><span class="p">{</span><span class="mi">10</span><span class="n">pt</span><span class="p">}{</span><span class="mi">12</span><span class="n">pt</span><span class="p">}</span>\<span class="n">selectfont</span>
     \<span class="n">href</span><span class="p">{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">inria</span><span class="o">.</span><span class="n">fr</span><span class="p">}{</span><span class="n">INSTITUT</span> <span class="n">NATIONAL</span> <span class="n">DE</span> <span class="n">RECHERCHE</span> <span class="n">EN</span> <span class="n">INFORMATIQUE</span> <span class="o">%</span>
        <span class="n">ET</span> <span class="n">EN</span> <span class="n">AUTOMATIQUE</span><span class="p">}}</span><span class="o">%</span>
      \<span class="n">hskip</span><span class="o">-</span><span class="mi">5</span><span class="n">cm</span>\<span class="n">hfill</span><span class="p">}</span><span class="o">%</span>
  \<span class="n">null</span>\<span class="n">vskip0</span><span class="mf">.7</span><span class="n">cm</span> \<span class="n">leavevmode</span>\<span class="n">hskip</span><span class="o">-</span><span class="mf">3.5</span><span class="n">cm</span>\<span class="n">box0</span>\<span class="n">null</span>\<span class="n">vskip2cm</span>\<span class="n">vfil</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>We invented <code class="docutils literal notranslate"><span class="pre">&lt;cleardoublepage/&gt;</span></code>. Its effect is to make the first page
of text appear on a right page (the text starts on a odd page; in fact
it starts on page one, because we use the adequate
<code class="docutils literal notranslate"><span class="pre">&lt;fo:page-sequence&gt;</span></code> element. Of course, the problem could be solved
by putting the table of contents at the end of the document.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">cleardoublepage</span><span class="p">}</span>
 <span class="p">{}</span> <span class="p">{</span>\<span class="n">cleardoublepage</span><span class="p">}</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
<p>This is another element we have to add, because we do not know how to
express this in xslt-fo: We want a rule just below the page headings.
This produces a box of width zero, with a rule of the width of the page
that will be below the text that follows.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">pagestylehrule</span><span class="p">}</span>
 <span class="p">{}</span> <span class="p">{</span>\<span class="n">hbox</span> <span class="n">to0pt</span><span class="p">{</span>\<span class="n">rule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="n">ex</span><span class="p">]{</span>\<span class="n">textwidth</span><span class="p">}{</span><span class="mf">.03</span><span class="n">cm</span><span class="p">}</span>\<span class="n">hss</span><span class="p">}}</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</section>
<section id="math-and-images">
<h3>5.9 Math and images<a class="headerlink" href="#math-and-images" title="Link to this heading"></a></h3>
<p>There is a PerlScript names extract-math.pl, that tries to convert
MathML into images. The document to be converted is
<a class="reference external" href="raweb1.html#extract-math">here</a>. This converts to 5 images: image
one=<img alt="mathimage 1" class="vc" src="_images/math_image_1.png" />, image two=<img alt="mathimage 2" class="vc" src="_images/math_image_2.png" />, image three=<img alt="mathimage 3" class="vc" src="_images/math_image_3.png" />, image four=<img alt="mathimage 4" class="vc" src="_images/math_image_4.png" />, and image five=<img alt="mathimage 5" class="vc" src="_images/math_image_5.png" />.</p>
<p>The idea is to use some code from latex2html.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">XMLelement</span><span class="p">{</span><span class="n">formula</span><span class="p">}</span>
 <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="nb">id</span><span class="p">}{</span>\<span class="n">XML</span><span class="nd">@formid</span><span class="p">}{</span><span class="n">none</span><span class="p">}}</span>
 <span class="p">{</span>\<span class="nd">@inlinemathA</span><span class="p">{</span>\<span class="n">XML</span><span class="nd">@formid</span><span class="p">}}</span>
 <span class="p">{</span>\<span class="nd">@inlinemathZ</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>There is no need to redefine brackets, because in the current version,
nothing is in display. The argument of this procedure is the number of
the image (the `id’ attribute of the XML element). We open a box,
containing a rule, and the content of the element.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\newbox\sizebox
\def\@inlinemathA#1{%
  \gdef\[{$\displaystyle}\gdef\]{$} % hack...
  \xdef\@mathenv{#1}%
  \adjustnormalsize \newpage\clearpage
  \setbox\sizebox=\hbox\bgroup\kern.05em
  \vrule height1.5ex width0pt }
</pre></div>
</div>
</div>
<p>This is a hack defined by latex2html. Is everything needed?</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">AtBeginDocument</span><span class="p">{</span>
\<span class="n">let</span>\<span class="n">realnormalsize</span><span class="o">=</span>\<span class="n">relax</span>
\<span class="n">def</span>\<span class="n">adjustnormalsize</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">def</span>\<span class="n">normalsize</span><span class="p">{</span>\<span class="n">mathsurround</span><span class="o">=</span><span class="mi">0</span><span class="n">pt</span> \<span class="n">realnormalsize</span>
   \<span class="n">parindent</span><span class="o">=</span><span class="mi">0</span><span class="n">pt</span>\<span class="n">abovedisplayskip</span><span class="o">=</span><span class="mi">0</span><span class="n">pt</span>\<span class="n">belowdisplayskip</span><span class="o">=</span><span class="mi">0</span><span class="n">pt</span><span class="p">}</span><span class="o">%</span>
  \<span class="n">def</span>\<span class="n">phantompar</span><span class="p">{</span>\<span class="n">csname</span> <span class="n">par</span>\<span class="n">endcsname</span><span class="p">}</span><span class="o">%</span>
  \<span class="n">normalsize</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Vertical alignment is done as follows: the baseline is either the bottom
or the center. That is, if the depth of the box is not zero, we add a
vrule with the same height and depth.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="nd">@centerinlinemath</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">dimen1</span><span class="o">=</span>\<span class="n">ifdim</span>\<span class="n">ht</span>\<span class="n">sizebox</span><span class="o">&lt;</span>\<span class="n">dp</span>\<span class="n">sizebox</span> \<span class="n">dp</span>\<span class="n">sizebox</span>\<span class="k">else</span>\<span class="n">ht</span>\<span class="n">sizebox</span>\<span class="n">fi</span>
  \<span class="n">advance</span>\<span class="n">dimen1by</span><span class="mf">.5</span><span class="n">pt</span> \<span class="n">vrule</span> <span class="n">width0pt</span> <span class="n">height</span>\<span class="n">dimen1</span> <span class="n">depth</span>\<span class="n">dimen1</span>
 \<span class="n">dp</span>\<span class="n">sizebox</span><span class="o">=</span>\<span class="n">dimen1</span>\<span class="n">ht</span>\<span class="n">sizebox</span><span class="o">=</span>\<span class="n">dimen1</span>\<span class="n">relax</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>This is done at the end of the math formula. The log file will contain
lines of the form <em>l2hSize :1:8.0pt::8.0pt::94.54239pt</em>. The Perl script
reads these data from the log file, and calls another Perl script:
/usr/bin/perl /usr/local/latex2html/bin/pstoimg -type png -tmp tmpdir
-discard -interlace -antialias -depth 1 -scale 1.4 -geometry 94x16
-margins 62,41 -crop abls -transparent -out math_image_1.png
tmpdir/images001</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="nd">@inlinemathZ</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">egroup</span>\<span class="n">expandafter</span>\<span class="n">ifdim</span>\<span class="n">dp</span>\<span class="n">sizebox</span><span class="o">&gt;</span><span class="mi">0</span><span class="n">pt</span> <span class="o">%</span>
  \<span class="n">expandafter</span>\<span class="nd">@centerinlinemath</span>\<span class="n">fi</span>
  \<span class="n">typeout</span><span class="p">{</span><span class="n">l2hSize</span> <span class="o">%</span>
   <span class="p">:</span>\<span class="nd">@mathenv</span><span class="p">:</span>\<span class="n">the</span>\<span class="n">ht</span>\<span class="n">sizebox</span><span class="p">::</span>\<span class="n">the</span>\<span class="n">dp</span>\<span class="n">sizebox</span><span class="p">::</span>\<span class="n">the</span>\<span class="n">wd</span>\<span class="n">sizebox</span><span class="o">.</span><span class="p">}</span>
  \<span class="n">hbox</span><span class="p">{</span>\<span class="n">vrule</span> <span class="n">width</span><span class="mf">.1</span><span class="n">em</span>\<span class="n">kern</span><span class="o">-</span><span class="mf">.05</span><span class="n">em</span>\<span class="n">vtop</span><span class="p">{</span>\<span class="n">vbox</span><span class="p">{</span><span class="o">%</span>
  \<span class="n">kern</span><span class="mf">.1</span><span class="n">em</span>\<span class="n">kern0</span><span class="mf">.6</span> <span class="n">pt</span>\<span class="n">hbox</span><span class="p">{</span>\<span class="n">hglue</span><span class="mf">.17</span><span class="n">em</span>\<span class="n">copy</span>\<span class="n">sizebox</span>\<span class="n">hglue0</span><span class="mf">.6</span> <span class="n">pt</span><span class="p">}}</span>\<span class="n">kern</span><span class="mf">.3</span><span class="n">pt</span><span class="o">%</span>
  \<span class="n">ifdim</span>\<span class="n">dp</span>\<span class="n">sizebox</span><span class="o">&gt;</span><span class="mi">0</span><span class="n">pt</span>\<span class="n">kern</span><span class="mf">.1</span><span class="n">em</span>\<span class="n">fi</span> \<span class="n">kern0</span><span class="mf">.6</span> <span class="n">pt</span><span class="o">%</span>
  \<span class="n">ifdim</span>\<span class="n">hsize</span><span class="o">&gt;</span>\<span class="n">wd</span>\<span class="n">sizebox</span> \<span class="n">hrule</span> <span class="n">depth1pt</span>\<span class="n">fi</span><span class="p">}}</span><span class="o">%</span>
  \<span class="n">ifdim</span>\<span class="n">ht</span>\<span class="n">sizebox</span><span class="o">&lt;</span>\<span class="n">vsize</span>
      \<span class="n">ifdim</span>\<span class="n">wd</span>\<span class="n">sizebox</span><span class="o">&lt;</span>\<span class="n">hsize</span>\<span class="n">expandafter</span>\<span class="n">hfill</span>\<span class="n">fi</span> \<span class="n">expandafter</span>\<span class="n">vfill</span>
      \<span class="k">else</span>\<span class="n">expandafter</span>\<span class="n">vss</span>\<span class="n">fi</span>
  \<span class="n">clearpage</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Now, sixty lines of hack. Complete code
<a class="reference external" href="raweb3.html#hack-item">here</a>. Translation of <code class="docutils literal notranslate"><span class="pre">fo:list-item-label</span></code>
calls <code class="docutils literal notranslate"><span class="pre">\savebox{\ItemBox}{#1}</span></code> just before <code class="docutils literal notranslate"><span class="pre">\item[#1]</span></code>. This code is
executed again here. I don’t remember why (the <code class="docutils literal notranslate"><span class="pre">\ItemBox</span></code> is only used
here).</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">def</span>\<span class="n">jg</span><span class="nd">@item</span><span class="p">[</span><span class="c1">#1]{%</span>
  \<span class="k">if</span><span class="nd">@noparitem</span>
    \<span class="nd">@donoparitem</span>
  \<span class="k">else</span>
    \<span class="k">if</span><span class="nd">@inlabel</span> <span class="o">...</span>  \<span class="n">fi</span>
    \<span class="n">ifhmode</span> <span class="o">...</span>     \<span class="n">fi</span>
    \<span class="k">if</span><span class="nd">@newlist</span> <span class="o">...</span>    \<span class="n">fi</span>
    \<span class="k">global</span>\<span class="nd">@inlabeltrue</span>
  \<span class="n">fi</span>
  \<span class="k">global</span>\<span class="n">everypar</span><span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
  \<span class="k">if</span><span class="nd">@noitemarg</span> <span class="o">...</span> \<span class="n">fi</span>
  \<span class="n">savebox</span><span class="p">{</span>\<span class="n">ItemBox</span><span class="p">}{</span><span class="c1">#1}% Added JG</span>
  \<span class="n">sbox</span>\<span class="nd">@tempboxa</span><span class="p">{</span>\<span class="n">makelabel</span><span class="p">{</span><span class="c1">#1}}%</span>
  \<span class="k">global</span>\<span class="n">setbox</span>\<span class="nd">@labels</span>\<span class="n">hbox</span><span class="p">{</span> <span class="n">use</span> \<span class="nd">@tempboxa</span> <span class="n">here</span><span class="o">...</span> <span class="p">}</span>
  \<span class="n">ignorespaces</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Last minutes hacks. Some actions must be done after all packages have
been loaded. Some other symbols are defined, or redefined.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">define</span> <span class="n">characters</span>
\<span class="n">AtBeginDocument</span><span class="p">{</span>
  \<span class="nd">@namedef</span><span class="p">{</span><span class="n">Gin</span><span class="nd">@rule</span><span class="o">@.</span><span class="n">eps</span><span class="p">}</span><span class="c1">#1{{eps}{.eps}{#1}}</span>
  \<span class="k">global</span>\<span class="n">let</span>\<span class="n">FOlabel</span>\<span class="n">xFOlabel</span>
  \<span class="n">let</span>\<span class="n">NoTableSetup</span>\<span class="n">myNoTableSetup</span>

  \<span class="n">let</span>\<span class="n">downslopeellipsis</span>\<span class="n">ddots</span>
  \<span class="n">mathchardef</span>\<span class="n">Rightarrow</span><span class="o">=</span><span class="s2">&quot;3229</span>
   <span class="n">more</span> <span class="n">characters</span> <span class="n">here</span>

  \<span class="n">def</span>\<span class="n">truestate</span><span class="p">{</span>\<span class="n">models</span><span class="p">}</span>
  \<span class="n">let</span>\<span class="nd">@texttop</span>\<span class="n">ra</span><span class="nd">@useatxy</span>
  \<span class="n">let</span>\<span class="n">XURL</span>\<span class="n">relax</span>
  \<span class="n">errorcontextlines</span><span class="o">=</span><span class="mi">1000</span>
  \<span class="n">selectlanguage</span><span class="p">{</span><span class="n">english</span><span class="p">}</span>
  \<span class="n">let</span>\<span class="nd">@item</span>\<span class="n">jg</span><span class="nd">@item</span>
  \<span class="n">expandafter</span>\<span class="n">let</span>\<span class="n">csname</span> <span class="n">E</span><span class="o">/</span><span class="p">:</span>\<span class="n">XMLNS</span><span class="nd">@fo</span><span class="p">:</span><span class="n">basic</span><span class="o">-</span><span class="n">link</span>\<span class="n">endcsname</span>\<span class="n">patched</span><span class="nd">@basiclink</span>
<span class="p">}</span>

\<span class="n">def</span>\<span class="n">L</span><span class="nd">@fr</span><span class="p">{</span>\<span class="n">selectlanguage</span><span class="p">{</span><span class="n">french</span><span class="p">}}</span>
\<span class="n">def</span>\<span class="n">L</span><span class="nd">@FR</span><span class="p">{</span>\<span class="n">selectlanguage</span><span class="p">{</span><span class="n">french</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</section>
<section id="the-fotex-cfg-file">
<h3>5.10 The fotex.cfg file<a class="headerlink" href="#the-fotex-cfg-file" title="Link to this heading"></a></h3>
<p>The file looks like this. Some lines are commented: they define
quantities unused by the Raweb. Elements hrule and vfill are obsolete?
useless? (I don’t remember). Switching to french is valid only for a
French document. The two commands <code class="docutils literal notranslate"><span class="pre">\foratheme</span></code> and <code class="docutils literal notranslate"><span class="pre">\foinria</span></code> are
defined in the file raweb-cfg.sty.</p>
<div class="ltx-source docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">frenchspacing</span>
\<span class="n">selectlanguage</span><span class="p">{</span><span class="n">french</span><span class="p">}</span>

\<span class="n">DeclareNamespace</span><span class="p">{</span><span class="n">fo</span><span class="p">}{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">w3</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">1999</span><span class="o">/</span><span class="n">XSL</span><span class="o">/</span><span class="n">Format</span><span class="p">}</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">fo</span><span class="p">:</span><span class="n">RATHEME</span><span class="p">}</span>
  <span class="p">{}</span>
  <span class="p">{</span>\<span class="n">xmlgrab</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">foratheme</span><span class="p">{</span><span class="c1">#1}}</span>

<span class="o">%</span> \<span class="n">XMLelement</span><span class="p">{</span><span class="n">fo</span><span class="p">:</span><span class="n">RRTHEME</span><span class="p">}</span> <span class="o">...</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">fo</span><span class="p">:</span><span class="n">INRIA</span><span class="p">}</span>
  <span class="p">{</span>\<span class="n">XMLattribute</span><span class="p">{</span><span class="n">year</span><span class="p">}{</span>\<span class="n">ra</span><span class="o">@</span><span class="nd">@year</span><span class="p">}{</span><span class="mi">2001</span><span class="p">}}</span>
  <span class="p">{}{</span>\<span class="n">xdef</span>\<span class="n">ra</span><span class="nd">@year</span><span class="p">{</span>\<span class="n">ra</span><span class="o">@</span><span class="nd">@year</span><span class="p">}</span>\<span class="n">foinria</span><span class="p">}</span>

<span class="o">%</span> \<span class="n">XMLelement</span><span class="p">{</span><span class="n">fo</span><span class="p">:</span><span class="n">RRINRIA</span><span class="p">}</span> <span class="o">...</span>

\<span class="n">XMLelement</span><span class="p">{</span><span class="n">hrule</span><span class="p">}</span> <span class="p">{}</span> <span class="p">{</span>\<span class="n">par</span>\<span class="n">hrule</span>\<span class="n">par</span><span class="p">}</span> <span class="p">{}</span>
\<span class="n">XMLelement</span><span class="p">{</span><span class="n">vfill</span><span class="p">}</span> <span class="p">{}</span> <span class="p">{</span>\<span class="n">vfill</span><span class="p">}</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-2020, INRIA and CNRS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>